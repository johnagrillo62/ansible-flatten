~d0.name = Import DebOps global handlers
~d1.ansible.builtin.import_role = 
~d2.name = 'global_handlers'
~d0.name = Import DebOps secret role
~d1.ansible.builtin.import_role = 
~d2.name = 'secret'
~d0.name = Ensure that required packages are installed
~d1.ansible.builtin.package = 
~d2.name = '{{ q("flattened", (root_account__base_packages
~d2.state = 'present'
~d1.register = root_account__register_packages
~d1.until = root_account__register_packages is succeeded
~d1.when = root_account__enabled | bool
~d0.name = Check available SSH key types
~d1.ansible.builtin.shell = ssh -Q key 2>/dev/null || echo "ssh-rsa"
~d1.register = root_account__register_key_types
~d1.changed_when = False
~d1.check_mode = False
~d1.tags = [ 'meta::facts' ]
~d0.name = Check if preferred shell exists
~d1.ansible.builtin.stat = 
~d2.path = '{{ root_account__shell }}'
~d1.register = root_account__register_shell
~d1.when = root_account__enabled | bool and root_account__shell | d(False)
~d0.name = Fail if setting a shell that does not exist
~d1.ansible.builtin.fail = 
~d2.msg = "Trying to set a shell that does not exist, this can lock you out!"
~d1.when = root_account__enabled | bool and root_account__shell | d(False) and not root_account__register_shell.stat.exists and
~d0.name = Enforce root system group
~d1.ansible.builtin.group = 
~d2.name = 'root'
~d2.gid = '0'
~d2.system = True
~d2.state = 'present'
~d1.when = root_account__enabled | bool
~d0.name = Enforce root system account
~d1.ansible.builtin.user = 
~d2.name = 'root'
~d2.state = 'present'
~d2.home = '/root'
~d2.uid = '0'
~d2.groups = ''
~d2.append = False
~d2.system = True
~d2.group = '{{ root_account__group }}'
~d2.generate_ssh_key = '{{ root_account__generate_ssh_key | bool }}'
~d2.ssh_key_bits = '{{ root_account__ssh_key_bits }}'
~d2.ssh_key_type = '{{ root_account__ssh_key_type }}'
~d2.ssh_key_file = '{{ root_account__ssh_key_file }}'
~d2.ssh_key_comment = '{{ root_account__ssh_key_comment }}'
~d2.update_password = '{{ "always" if root_account__password_update | bool else "on_create" }}'
~d2.password = '{{ root_account__password if root_account__password else omit }}'
~d2.shell = '{{ root_account__shell if root_account__shell else omit }}'
~d1.when = root_account__enabled | bool
~d1.no_log = '{{ (debops__no_log | d(True)) if root_account__password else False }}'
~d0.name = Enforce root home permissions
~d1.ansible.builtin.file = 
~d2.path = '/root'
~d2.state = 'directory'
~d2.owner = 'root'
~d2.group = 'root'
~d2.mode = '0700'
~d1.when = root_account__enabled | bool
~d0.name = Configure authorized SSH keys for root account
~d1.ansible.posix.authorized_key = 
~d2.key = "{{ q('flattened', root_account__combined_authorized_keys)
~d2.exclusive = '{{ root_account__authorized_keys_exclusive | bool }}'
~d2.state = 'present'
~d2.user = 'root'
~d2.follow = '{{ root_account__authorized_keys_follow | bool }}'
~d1.when = root_account__enabled | bool and root_account__authorized_keys_state != 'absent'
~d0.name = Remove /root/.ssh/authorized_keys file if requested
~d1.ansible.builtin.file = 
~d2.path = '/root/.ssh/authorized_keys'
~d2.state = 'absent'
~d1.when = root_account__enabled | bool and root_account__authorized_keys_state == 'absent'
~d0.name = Check subuid presence for root account
~d1.ansible.builtin.shell = grep -E '^root:' /etc/subuid || true
~d1.register = root_account__register_subuid
~d1.check_mode = False
~d1.changed_when = False
~d1.when = root_account__enabled | bool and root_account__subuid_enabled | bool
~d0.name = Add subuids and subgids for root account
~d1.ansible.builtin.command = usermod --add-subuids {{ (item | string + "-" + (item | int + root_account__subuid_count | int) | string) }}
~d1.with_items = '{{ root_account__subuid_start }}'
~d1.register = root_account__register_usermod
~d1.changed_when = root_account__register_usermod.changed | bool
~d1.when = root_account__enabled | bool and root_account__subuid_enabled | bool and
~d0.name = Manage root dotfiles
~d1.environment = 
~d2.LC_MESSAGES = 'C'
~d1.ansible.builtin.shell = |
~d1.register = root_account__register_dotfiles
~d1.changed_when = ('Already up to date.' not in root_account__register_dotfiles.stdout_lines | regex_replace('-', ' '))
~d1.when = ((ansible_local | d() and ansible_local.yadm | d() and (ansible_local.yadm.installed | d()) | bool) and
~d1.check_mode = False
~d0.name = Make sure Ansible fact directory exists
~d1.ansible.builtin.file = 
~d2.path = '/etc/ansible/facts.d'
~d2.state = 'directory'
~d2.owner = 'root'
~d2.group = 'root'
~d2.mode = '0755'
~d0.name = Setup root account local facts
~d1.ansible.builtin.template = 
~d2.src = 'etc/ansible/facts.d/root_account.fact.j2'
~d2.dest = '/etc/ansible/facts.d/root_account.fact'
~d2.owner = 'root'
~d2.group = 'root'
~d2.mode = '0755'
~d1.notify = [ 'Refresh host facts' ]
~d1.tags = [ 'meta::facts' ]
~d0.name = Reload facts if they were modified
~d1.ansible.builtin.meta = 'flush_handlers'
