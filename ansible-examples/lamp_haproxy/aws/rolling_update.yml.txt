[0].hosts = tag_ansible_group_monitoring
[1].hosts = tag_ansible_group_webservers
[1].serial = 1
[1].pre_tasks[0].name = disable nagios alerts for this host webserver service
[1].pre_tasks[0].nagios = action=disable_alerts host={{ inventory_hostname }} services=webserver
[1].pre_tasks[0].delegate_to = {{ item }}
[1].pre_tasks[0].with_items = {{ groups.tag_ansible_group_monitoring }}
[1].pre_tasks[1].name = disable the server in haproxy
[1].pre_tasks[1].haproxy = state=disabled backend=myapplb host={{ inventory_hostname }} socket=/var/lib/haproxy/stats
[1].pre_tasks[1].delegate_to = {{ item }}
[1].pre_tasks[1].with_items = {{ groups.tag_ansible_group_lbservers }}
[1].roles[0] = web
[1].post_tasks[0].name = wait for webserver to come up
[1].post_tasks[0].wait_for = host={{ inventory_hostname }} port=80 state=started timeout=80
[1].post_tasks[1].name = enable the server in haproxy
[1].post_tasks[1].haproxy = state=enabled backend=myapplb host={{ inventory_hostname }} socket=/var/lib/haproxy/stats
[1].post_tasks[1].delegate_to = {{ item }}
[1].post_tasks[1].with_items = {{ groups.tag_ansible_group_lbservers }}
[1].post_tasks[2].name = re-enable nagios alerts
[1].post_tasks[2].nagios = action=enable_alerts host={{ inventory_hostname }} services=webserver
[1].post_tasks[2].delegate_to = {{ item }}
[1].post_tasks[2].with_items = {{ groups.tag_ansible_group_monitoring }}
