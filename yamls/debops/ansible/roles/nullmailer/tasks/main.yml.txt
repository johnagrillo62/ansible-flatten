[0].name = Import DebOps global handlers
[0]["ansible.builtin.import_role"].name = global_handlers
[1].name = Import DebOps secret role
[1]["ansible.builtin.import_role"].name = secret
[2].name = Install required packages
[2]["ansible.builtin.package"].name = {{ q("flattened", (nullmailer__base_packages
                              + nullmailer__smtpd_packages
                              + nullmailer__packages)) }}
[2]["ansible.builtin.package"].state = present
[2].register = nullmailer__register_packages
[2].until = nullmailer__register_packages is succeeded
[2].when = nullmailer__deploy_state | d('present') != 'absent'
[3].name = Purge other SMTP servers
[3]["ansible.builtin.apt"].name = {{ nullmailer__purge_mta_packages | flatten }}
[3]["ansible.builtin.apt"].state = absent
[3]["ansible.builtin.apt"].purge = True
[3].when = (nullmailer__deploy_state | d('present') != 'absent' and nullmailer__purge_mta_packages)
[4].name = Generate configuration files
[4]["ansible.builtin.copy"].dest = {{ item.dest }}
[4]["ansible.builtin.copy"].content = {{ (item.content + '\n') if item.content | d() else ('' if item.content is defined else omit) }}
[4]["ansible.builtin.copy"].src = {{ item.src | d(omit) }}
[4]["ansible.builtin.copy"].owner = {{ item.owner | d(omit) }}
[4]["ansible.builtin.copy"].group = {{ item.group | d(omit) }}
[4]["ansible.builtin.copy"].mode = {{ item.mode | d(omit) }}
[4].loop = {{ q("flattened", nullmailer__configuration_files) }}
[4].notify[0] = Restart nullmailer
[4].when = (nullmailer__deploy_state | d('present') != 'absent' and (item.dest | d() and (item.src | d() or item.content is defined) and item.state | d('present') != 'absent'))
[5].name = Generate private configuration files
[5]["ansible.builtin.copy"].dest = {{ item.dest }}
[5]["ansible.builtin.copy"].content = {{ (item.content + '\n') if item.content | d() else omit }}
[5]["ansible.builtin.copy"].src = {{ item.src | d(omit) }}
[5]["ansible.builtin.copy"].owner = {{ item.owner | d(omit) }}
[5]["ansible.builtin.copy"].group = {{ item.group | d(omit) }}
[5]["ansible.builtin.copy"].mode = {{ item.mode | d(omit) }}
[5].loop = {{ q("flattened", nullmailer__private_configuration_files) }}
[5].notify[0] = Restart nullmailer
[5].when = (nullmailer__deploy_state | d('present') != 'absent' and (item.dest | d() and (item.src | d() or item.content | d()) and item.state | d('present') != 'absent'))
[5].no_log = {{ debops__no_log | d(True) }}
[6].name = Remove configuration files if requested
[6]["ansible.builtin.file"].path = {{ item.dest }}
[6]["ansible.builtin.file"].state = absent
[6].loop = {{ q("flattened", nullmailer__configuration_files) }}
[6].notify[0] = Restart nullmailer
[6].when = (nullmailer__deploy_state | d('present') != 'absent' and (item.dest | d() and (item.src | d() or item.content is defined) and item.state | d('present') == 'absent'))
[7].name = Remove private configuration files if requested
[7]["ansible.builtin.file"].path = {{ item.dest }}
[7]["ansible.builtin.file"].state = absent
[7].loop = {{ q("flattened", nullmailer__private_configuration_files) }}
[7].notify[0] = Restart nullmailer
[7].when = (nullmailer__deploy_state | d('present') != 'absent' and (item.dest | d() and (item.src | d() or item.content is defined) and item.state | d('present') == 'absent'))
[7].no_log = {{ debops__no_log | d(True) }}
[8].name = Configure nullmailer services in xinetd
[8]["ansible.builtin.template"].src = etc/xinetd.d/{{ item }}.j2
[8]["ansible.builtin.template"].dest = /etc/xinetd.d/{{ item }}
[8]["ansible.builtin.template"].owner = root
[8]["ansible.builtin.template"].group = root
[8]["ansible.builtin.template"].mode = 0644
[8].loop[0] = nullmailer-smtpd
[8].loop[1] = nullmailer-smtpd6
[8].notify[0] = Reload xinetd
[8].when = (nullmailer__deploy_state | d('present') != 'absent' and nullmailer__smtpd | bool)
[9].name = Disable nullmailer-smtpd service in xinetd
[9]["ansible.builtin.file"].path = /etc/xinetd.d/{{ item }}
[9]["ansible.builtin.file"].state = absent
[9].loop[0] = nullmailer-smtpd
[9].loop[1] = nullmailer-smtpd6
[9].notify[0] = Reload xinetd
[9].when = ((nullmailer__deploy_state | d() and nullmailer__deploy_state == 'absent') or not nullmailer__smtpd | bool)
[10].name = Remove old dpkg cleanup hook and script
[10]["ansible.builtin.file"].path = {{ item }}
[10]["ansible.builtin.file"].state = absent
[10].loop[0] = /etc/dpkg/dpkg.cfg.d/debops-nullmailer
[10].loop[1] = /usr/local/lib/debops-nullmailer-dpkg-cleanup
[10].when = nullmailer__deploy_state | d('present') != 'absent'
[11].name = Prepare cleanup during package removal
[11]["ansible.builtin.import_role"].name = dpkg_cleanup
[11].vars.dpkg_cleanup__dependent_packages[0] = {{ nullmailer__dpkg_cleanup__dependent_packages }}
[11].when = nullmailer__deploy_state | d('present') != 'absent'
[11].tags[0] = role::dpkg_cleanup
[11].tags[1] = skip::dpkg_cleanup
[11].tags[2] = role::nullmailer:dpkg_cleanup
