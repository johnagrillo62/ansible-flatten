[0].name = Import custom Ansible plugins
[0]["ansible.builtin.import_role"].name = ansible_plugins
[1].name = Import DebOps global handlers
[1]["ansible.builtin.import_role"].name = global_handlers
[2].name = Import DebOps secret role
[2]["ansible.builtin.import_role"].name = secret
[3].name = Install rspamd packages
[3]["ansible.builtin.package"].name = {{ q("flattened", (rspamd__base_packages
                              + rspamd__packages)) }}
[3]["ansible.builtin.package"].state = present
[3].register = rspamd__register_packages
[3].until = rspamd__register_packages is succeeded
[3].tags[0] = role::rspamd:pkg
[4].name = Make sure that the Ansible local facts directory exists
[4]["ansible.builtin.file"].path = /etc/ansible/facts.d
[4]["ansible.builtin.file"].state = directory
[4]["ansible.builtin.file"].mode = 0755
[5].name = Save rspamd local facts
[5]["ansible.builtin.template"].src = etc/ansible/facts.d/rspamd.fact.j2
[5]["ansible.builtin.template"].dest = /etc/ansible/facts.d/rspamd.fact
[5]["ansible.builtin.template"].mode = 0755
[5].notify[0] = Refresh host facts
[5].tags[0] = meta::facts
[6].name = Create configuration directories and files
[6]["ansible.builtin.include_tasks"] = main_cfgdir.yml
[6].loop[0].path = /etc/rspamd/local.d
[6].loop[0].config = {{ rspamd__combined_local_configuration
                       | debops.debops.parse_kv_items(name="file") }}
[6].loop[1].path = /etc/rspamd/override.d
[6].loop[1].config = {{ rspamd__combined_override_configuration
                       | debops.debops.parse_kv_items(name="file") }}
[6].loop_control.loop_var = cfgdir
[6].loop_control.label = {{ cfgdir.path }}
[7].name = Handle DKIM configuration
[7]["ansible.builtin.include_tasks"] = main_dkim.yml
[8].name = Update Ansible facts and restart Rspamd if necessary
[8]["ansible.builtin.meta"] = flush_handlers
