[0].name = Install required packages
[0]["ansible.builtin.apt"].name = {{ (unattended_upgrades__base_packages
             + unattended_upgrades__packages)
             | flatten }}
[0]["ansible.builtin.apt"].state = present
[0]["ansible.builtin.apt"].install_recommends = False
[0].register = unattended_upgrades__register_packages
[0].until = unattended_upgrades__register_packages is succeeded
[0].when = unattended_upgrades__enabled | bool
[1].name = Configure debconf answer
[1]["ansible.builtin.debconf"].name = unattended-upgrades
[1]["ansible.builtin.debconf"].question = unattended-upgrades/enable_auto_updates
[1]["ansible.builtin.debconf"].vtype = boolean
[1]["ansible.builtin.debconf"].value = {{ "true" if unattended_upgrades__enabled | bool else "false" }}
[2].name = Configure periodic APT updates
[2]["ansible.builtin.template"].src = etc/apt/apt.conf.d/20periodic.j2
[2]["ansible.builtin.template"].dest = /etc/apt/apt.conf.d/20periodic
[2]["ansible.builtin.template"].owner = root
[2]["ansible.builtin.template"].group = root
[2]["ansible.builtin.template"].mode = 0644
[2].when = ((unattended_upgrades__periodic | bool) or (ansible_local | d() and ansible_local.unattended_upgrades | d() and ansible_local.unattended_upgrades.periodic | bool))
[3].name = Configure periodic APT upgrades
[3]["ansible.builtin.template"].src = etc/apt/apt.conf.d/20auto-upgrades.j2
[3]["ansible.builtin.template"].dest = /etc/apt/apt.conf.d/20auto-upgrades
[3]["ansible.builtin.template"].owner = root
[3]["ansible.builtin.template"].group = root
[3]["ansible.builtin.template"].mode = 0644
[3].when = ((unattended_upgrades__enabled | bool) or (ansible_local | d() and ansible_local.unattended_upgrades | d() and ansible_local.unattended_upgrades.enabled | bool))
[4].name = Add/remove diversion of unattended-upgrades configuration
[4]["debops.debops.dpkg_divert"].path = /etc/apt/apt.conf.d/50unattended-upgrades
[4]["debops.debops.dpkg_divert"].state = {{ "present" if unattended_upgrades__enabled | bool else "absent" }}
[4]["debops.debops.dpkg_divert"].delete = True
[5].name = Configure unattended-upgrades
[5]["ansible.builtin.template"].src = etc/apt/apt.conf.d/50unattended-upgrades.j2
[5]["ansible.builtin.template"].dest = /etc/apt/apt.conf.d/50unattended-upgrades
[5]["ansible.builtin.template"].owner = root
[5]["ansible.builtin.template"].group = root
[5]["ansible.builtin.template"].mode = 0644
[5].when = unattended_upgrades__enabled | bool
[6].name = Make sure that Ansible local fact directory exists
[6]["ansible.builtin.file"].path = /etc/ansible/facts.d
[6]["ansible.builtin.file"].state = directory
[6]["ansible.builtin.file"].owner = root
[6]["ansible.builtin.file"].group = root
[6]["ansible.builtin.file"].mode = 0755
[7].name = Save Ansible local facts
[7]["ansible.builtin.template"].src = etc/ansible/facts.d/unattended_upgrades.fact.j2
[7]["ansible.builtin.template"].dest = /etc/ansible/facts.d/unattended_upgrades.fact
[7]["ansible.builtin.template"].owner = root
[7]["ansible.builtin.template"].group = root
[7]["ansible.builtin.template"].mode = 0644
[7].tags[0] = meta::facts
