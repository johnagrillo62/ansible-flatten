[0].name = Set os_family fact for other redhat-based operating systems
[0].set_fact.ansible_os_family = RedHat
[0].set_fact.ansible_distribution_major_version = 8
[0].when = ansible_distribution in redhat_os_family_extensions
[0].tags[0] = facts
[1].name = Check resolvconf
[1].command = which resolvconf
[1].register = resolvconf
[1].failed_when = false
[1].changed_when = false
[1].check_mode = false
[2].name = Check existence of /etc/resolvconf/resolv.conf.d
[2].stat.path = /etc/resolvconf/resolv.conf.d
[2].stat.get_attributes = false
[2].stat.get_checksum = false
[2].stat.get_mime = false
[2].failed_when = false
[2].register = resolvconfd_path
[3].name = Check status of /etc/resolv.conf
[3].stat.path = /etc/resolv.conf
[3].stat.follow = false
[3].stat.get_attributes = false
[3].stat.get_checksum = false
[3].stat.get_mime = false
[3].failed_when = false
[3].register = resolvconf_stat
[4].name = Fetch resolv.conf
[4].when = resolvconf_stat.stat.exists
[4].slurp.src = /etc/resolv.conf
[4].register = resolvconf_slurp
[5].name = NetworkManager | Check if host has NetworkManager
[5].command = systemctl is-active --quiet NetworkManager.service
[5].register = networkmanager_enabled
[5].failed_when = false
[5].changed_when = false
[5].check_mode = false
[6].name = Check systemd-resolved
[6].command = systemctl is-active systemd-resolved
[6].register = systemd_resolved_enabled
[6].failed_when = false
[6].changed_when = false
[6].check_mode = false
[7].name = Set default dns if remove_default_searchdomains is false
[7].set_fact.default_searchdomains[0] = default.svc.{{ dns_domain }}
[7].set_fact.default_searchdomains[1] = svc.{{ dns_domain }}
[7].when = not remove_default_searchdomains | default() | bool or (remove_default_searchdomains | default() | bool and searchdomains | length == 0)
[8].name = Set dns facts
[8].set_fact.resolvconf = {%- if resolvconf.rc == 0 and resolvconfd_path.stat.isdir is defined and resolvconfd_path.stat.isdir -%}true{%- else -%}false{%- endif -%}
[9].name = Check if kubelet is configured
[9].stat.path = {{ kube_config_dir }}/kubelet.env
[9].stat.get_attributes = false
[9].stat.get_checksum = false
[9].stat.get_mime = false
[9].register = kubelet_configured
[9].changed_when = false
[10].name = Check if early DNS configuration stage
[10].set_fact.dns_early = {{ not kubelet_configured.stat.exists }}
[11].name = Target resolv.conf files
[11].set_fact.resolvconffile = /etc/resolv.conf
[11].set_fact.base = {%- if resolvconf | bool -%}/etc/resolvconf/resolv.conf.d/base{%- endif -%}
[11].set_fact.head = {%- if resolvconf | bool -%}/etc/resolvconf/resolv.conf.d/head{%- endif -%}
[11].when = not ansible_os_family in ["Flatcar", "Flatcar Container Linux by Kinvolk"] and not is_fedora_coreos
[12].name = Target temporary resolvconf cloud init file (Flatcar Container Linux by Kinvolk / Fedora CoreOS)
[12].set_fact.resolvconffile = /tmp/resolveconf_cloud_init_conf
[12].when = ansible_os_family in ["Flatcar", "Flatcar Container Linux by Kinvolk"] or is_fedora_coreos
[13].name = Check if /etc/dhclient.conf exists
[13].stat.path = /etc/dhclient.conf
[13].stat.get_attributes = false
[13].stat.get_checksum = false
[13].stat.get_mime = false
[13].register = dhclient_stat
[14].name = Target dhclient conf file for /etc/dhclient.conf
[14].set_fact.dhclientconffile = /etc/dhclient.conf
[14].when = dhclient_stat.stat.exists
[15].name = Check if /etc/dhcp/dhclient.conf exists
[15].stat.path = /etc/dhcp/dhclient.conf
[15].stat.get_attributes = false
[15].stat.get_checksum = false
[15].stat.get_mime = false
[15].register = dhcp_dhclient_stat
[16].name = Target dhclient conf file for /etc/dhcp/dhclient.conf
[16].set_fact.dhclientconffile = /etc/dhcp/dhclient.conf
[16].when = dhcp_dhclient_stat.stat.exists
[17].name = Target dhclient hook file for Red Hat family
[17].set_fact.dhclienthookfile = /etc/dhcp/dhclient.d/zdnsupdate.sh
[17].when = ansible_os_family == "RedHat"
[18].name = Target dhclient hook file for Debian family
[18].set_fact.dhclienthookfile = /etc/dhcp/dhclient-exit-hooks.d/zdnsupdate
[18].when = ansible_os_family == "Debian"
[19].name = Set etcd vars if using kubeadm mode
[19].set_fact.etcd_cert_dir = {{ kube_cert_dir }}
[19].set_fact.kube_etcd_cacert_file = etcd/ca.crt
[19].set_fact.kube_etcd_cert_file = apiserver-etcd-client.crt
[19].set_fact.kube_etcd_key_file = apiserver-etcd-client.key
[19].when[0] = etcd_deployment_type == "kubeadm"
[20].name = Check /usr readonly
[20].stat.path = /usr
[20].stat.get_attributes = false
[20].stat.get_checksum = false
[20].stat.get_mime = false
[20].register = usr
[21].name = Set alternate flexvolume path
[21].set_fact.kubelet_flexvolumes_plugins_dir = /var/lib/kubelet/volumeplugins
[21].when = not usr.stat.writeable
