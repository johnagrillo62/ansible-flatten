[0].name = Generate a test ID
[0].set_fact.test_id = {{ lookup('password', '/dev/null chars=ascii_letters length=16') }}
[0].when = test_id is not defined
[1].name = Generate names
[1].set_fact.group_name1 = AWX-Collection-tests-group-group1-{{ test_id }}
[1].set_fact.group_name2 = AWX-Collection-tests-group-group2-{{ test_id }}
[1].set_fact.group_name3 = AWX-Collection-tests-group-group3-{{ test_id }}
[1].set_fact.group_name4 = AWX-Collection-tests-group-group4-{{ test_id }}
[1].set_fact.inv_name = AWX-Collection-tests-group-inv-{{ test_id }}
[1].set_fact.host_name1 = AWX-Collection-tests-group-host1-{{ test_id }}
[1].set_fact.host_name2 = AWX-Collection-tests-group-host2-{{ test_id }}
[1].set_fact.host_name3 = AWX-Collection-tests-group-host3-{{ test_id }}
[1].set_fact.host_name4 = AWX-Collection-tests-group-host4-{{ test_id }}
[2].name = Create an Inventory
[2].inventory.name = {{ inv_name }}
[2].inventory.organization = Default
[2].inventory.state = present
[2].register = inv_result
[3].name = Create a Host
[3].host.name = {{ host_name4 }}
[3].host.inventory = {{ inv_name }}
[3].host.state = present
[3].register = host_result
[4].name = Add Host to Group
[4].group.name = {{ group_name1 }}
[4].group.inventory = {{ inv_name }}
[4].group.hosts[0] = {{ host_name4 }}
[4].group.preserve_existing_hosts = true
[4].register = group_result
[5].assert.that[0] = inv_result is changed
[5].assert.that[1] = host_result is changed
[5].assert.that[2] = group_result is changed
[6].name = Create Group 1
[6].group.name = {{ group_name1 }}
[6].group.inventory = {{ inv_result.id }}
[6].group.state = present
[6].group.variables.foo = bar
[6].register = result
[7].assert.that[0] = result is changed
[8].name = Create Group 1 with exists
[8].group.name = {{ group_name1 }}
[8].group.inventory = {{ inv_name }}
[8].group.state = exists
[8].group.variables.foo = bar
[8].register = result
[9].assert.that[0] = result is not changed
[10].name = Delete Group 1
[10].group.name = {{ group_name1 }}
[10].group.inventory = {{ inv_name }}
[10].group.state = absent
[10].group.variables.foo = bar
[10].register = result
[11].assert.that[0] = result is changed
[12].name = Create Group 1 with exists
[12].group.name = {{ group_name1 }}
[12].group.inventory = {{ inv_name }}
[12].group.state = exists
[12].group.variables.foo = bar
[12].register = result
[13].assert.that[0] = result is changed
[14].name = Create Group 2
[14].group.name = {{ group_name2 }}
[14].group.inventory = {{ inv_name }}
[14].group.state = present
[14].group.variables.foo = bar
[14].register = result
[15].assert.that[0] = result is changed
[16].name = Create Group 3
[16].group.name = {{ group_name3 }}
[16].group.inventory = {{ inv_name }}
[16].group.state = present
[16].group.variables.foo = bar
[16].register = result
[17].assert.that[0] = result is changed
[18].name = add hosts
[18].host.name = {{ item }}
[18].host.inventory = {{ inv_name }}
[18].loop[0] = {{ host_name1 }}
[18].loop[1] = {{ host_name2 }}
[18].loop[2] = {{ host_name3 }}
[19].name = Create Group 1 with hosts and sub group of Group 2
[19].group.name = {{ group_name1 }}
[19].group.inventory = {{ inv_name }}
[19].group.hosts[0] = {{ host_name1 }}
[19].group.hosts[1] = {{ host_name2 }}
[19].group.children[0] = {{ group_name2 }}
[19].group.state = present
[19].group.variables.foo = bar
[19].register = result
[20].name = Create Group 1 with hosts and sub group
[20].group.name = {{ group_name1 }}
[20].group.inventory = {{ inv_name }}
[20].group.hosts[0] = {{ host_name3 }}
[20].group.children[0] = {{ group_name3 }}
[20].group.state = present
[20].group.preserve_existing_hosts = true
[20].group.preserve_existing_children = true
[20].register = result
[21].name = Find number of hosts in {{ group_name1 }}
[21].set_fact.group1_host_count = {{ lookup('awx.awx.controller_api', 'groups/' + result.id | string + '/all_hosts/') | length }}
[22].assert.that[0] = group1_host_count == 3
[23].name = Delete Group 3
[23].group.name = {{ group_name3 }}
[23].group.inventory = {{ inv_name }}
[23].group.state = absent
[23].register = result
[24].assert.that[0] = result is changed
[25].name = Delete Group 1
[25].group.name = {{ group_name1 }}
[25].group.inventory = {{ inv_name }}
[25].group.state = absent
[25].register = result
[26].assert.that[0] = result is changed
[27].name = Delete Group 2
[27].group.name = {{ group_name2 }}
[27].group.inventory = {{ inv_name }}
[27].group.state = absent
[27].register = result
[28].assert.that[0] = result is not changed
[29].name = Check module fails with correct msg
[29].group.name = test-group
[29].group.description = Group Description
[29].group.inventory = test-non-existing-inventory
[29].group.state = present
[29].register = result
[29].ignore_errors = yes
[30].assert.that[0] = result is failed
[30].assert.that[1] = result is not changed
[30].assert.that[2] = 'test-non-existing-inventory' in result.msg
[30].assert.that[3] = result.total_results == 0
[31].name = add hosts
[31].host.name = {{ item }}
[31].host.inventory = {{ inv_name }}
[31].loop[0] = {{ host_name1 }}
[31].loop[1] = {{ host_name2 }}
[31].loop[2] = {{ host_name3 }}
[32].name = add mid level group
[32].group.name = {{ group_name2 }}
[32].group.inventory = {{ inv_name }}
[32].group.hosts[0] = {{ host_name3 }}
[33].name = add top group
[33].group.name = {{ group_name3 }}
[33].group.inventory = {{ inv_name }}
[33].group.hosts[0] = {{ host_name1 }}
[33].group.hosts[1] = {{ host_name2 }}
[33].group.children[0] = {{ group_name2 }}
[34].name = Delete the parent group
[34].group.name = {{ group_name3 }}
[34].group.inventory = {{ inv_name }}
[34].group.state = absent
[35].name = Delete the child group
[35].group.name = {{ group_name2 }}
[35].group.inventory = {{ inv_name }}
[35].group.state = absent
[36].name = Delete an Inventory
[36].inventory.name = {{ inv_name }}
[36].inventory.organization = Default
[36].inventory.state = absent
