gitlab_runner__apt_upstream = True
gitlab_runner__apt_key = F6403F6544A38863DAA0B6E03F01618A51312F3F
gitlab_runner__apt_repo = deb https://packages.gitlab.com/runner/gitlab-runner/{{ ansible_distribution | lower }}/ {{ ansible_distribution_release }} main
gitlab_runner__base_packages[0] = gitlab-runner
gitlab_runner__base_packages[1] = {{ ["vagrant-libvirt", "libguestfs-tools", "busybox", "patch"]
        if gitlab_runner__vagrant_libvirt | bool
        else [] }}

gitlab_runner__base_packages[2] = {{ "vagrant-lxc" if gitlab_runner__vagrant_lxc | bool else [] }}
gitlab_runner__user = gitlab-runner
gitlab_runner__group = gitlab-runner
gitlab_runner__system = True
gitlab_runner__home = {{ (ansible_local.fhs.home | d("/var/local"))
	                 + "/" + gitlab_runner__user }} 
gitlab_runner__comment = GitLab Runner
gitlab_runner__shell = /bin/bash
gitlab_runner__concurrent = {{ ansible_processor_vcpus
                               if (ansible_local | d() and
                                   ansible_local.docker_server | d() and
                                   (ansible_local.docker_server.installed | d()) | bool)
                               else "1" }}

gitlab_runner__domain = {{ ansible_domain }}
gitlab_runner__fqdn = {{ ansible_fqdn }}
gitlab_runner__gitlab_srv_rr = {{ q("debops.debops.dig_srv", "_gitlab._tcp." + gitlab_runner__domain,
                                    ansible_fqdn
                                    if (ansible_local | d() and ansible_local.gitlab | d() and
                                       (ansible_local.gitlab.installed | d()) | bool)
                                    else ("code." + gitlab_runner__domain), 443) }}

gitlab_runner__api_fqdn = {{ gitlab_runner__gitlab_srv_rr[0]["target"] }}
gitlab_runner__api_url = https://{{ gitlab_runner__api_fqdn }}/
gitlab_runner__api_token = {{ lookup("env", "GITLAB_API_TOKEN") }}
gitlab_runner__runner_type = instance_type
gitlab_runner__group_id = null
gitlab_runner__project_id = null
gitlab_runner__executor = shell
gitlab_runner__metrics_server = 
gitlab_runner__shell_tags = {{ lookup("template",
                               "lookup/gitlab_runner__shell_tags.j2") }} 
gitlab_runner__default_tags[0] = managed-by-debops
gitlab_runner__combined_tags = {{ gitlab_runner__default_tags
                                  + gitlab_runner__tags
                                  + gitlab_runner__group_tags
                                  + gitlab_runner__host_tags }}

gitlab_runner__default_instances[0].name = {{ ansible_hostname + "-shell" }}
gitlab_runner__default_instances[0].executor = shell
gitlab_runner__default_instances[0].run_untagged = False
gitlab_runner__default_instances[0].state = {{ "absent"
               if (ansible_local | d() and ansible_local.docker_server | d() and
                   (ansible_local.docker_server.installed | d()) | bool)
               else "present" }}

gitlab_runner__default_instances[1].name = {{ ansible_hostname + "-docker" }}
gitlab_runner__default_instances[1].executor = docker
gitlab_runner__default_instances[1].tags[0] = docker
gitlab_runner__default_instances[1].state = {{ "present"
               if (ansible_local | d() and ansible_local.docker_server | d() and
                   (ansible_local.docker_server.installed | d()) | bool)
               else "absent" }}

gitlab_runner__default_instances[2].name = {{ ansible_hostname + "-docker-root" }}
gitlab_runner__default_instances[2].executor = docker
gitlab_runner__default_instances[2].concurrent = {{ ansible_processor_vcpus }}
gitlab_runner__default_instances[2].docker_privileged = True
gitlab_runner__default_instances[2].run_untagged = False
gitlab_runner__default_instances[2].tags[0] = docker-privileged
gitlab_runner__default_instances[2].state = {{ "present"
               if (ansible_local | d() and ansible_local.docker_server | d() and
                   (ansible_local.docker_server.installed | d()) | bool)
               else "absent" }}

gitlab_runner__vagrant_libvirt = {{ True
                                    if (ansible_local | d() and ansible_local.libvirtd | d() and
                                        (ansible_local.libvirtd.installed | d()) | bool and
                                        (ansible_distribution_release not in
                                         ["trusty"]))
                                    else False }}

gitlab_runner__vagrant_libvirt_patch = {{ True
                                          if (gitlab_runner__vagrant_libvirt | bool and
                                              ansible_distribution_release in
                                              ["stretch", "buster"])
                                          else False }}

gitlab_runner__vagrant_libvirt_patch_state = present
gitlab_runner__vagrant_lxc = {{ True
                                if (ansible_local | d() and ansible_local.lxc | d() and
                                    (ansible_local.lxc.installed | d()) | bool and
                                    (ansible_distribution_release not in
                                     ["trusty"]))
                                else False }}

gitlab_runner__ssh_generate = False
gitlab_runner__ssh_generate_bits = 4096
gitlab_runner__ssh_known_hosts[0] = {{ gitlab_runner__fqdn }}
gitlab_runner__ssh_host = 
gitlab_runner__ssh_port = 22
gitlab_runner__ssh_user = 
gitlab_runner__ssh_identity_file = 
gitlab_runner__ssh_password = 
gitlab_runner__docker_host = 
gitlab_runner__docker_tls_cert_path = 
gitlab_runner__docker_image = debian
gitlab_runner__docker_privileged = False
gitlab_runner__docker_disable_cache = False
gitlab_runner__docker_cache_dir = 
gitlab_runner__docker_cap_drop[0] = NET_ADMIN
gitlab_runner__docker_cap_drop[1] = SYS_ADMIN
gitlab_runner__docker_cap_drop[2] = DAC_OVERRIDE
gitlab_runner__machine_idle_count = {{ ansible_processor_cores }}
gitlab_runner__machine_idle_time = 600
gitlab_runner__machine_max_builds = 100
gitlab_runner__machine_name = auto-scale-%s.{{ gitlab_runner__domain }}
gitlab_runner__machine_driver = generic
gitlab_runner__machine_offpeakperiods[0] = * * 0-7,19-23 * * mon-fri *
gitlab_runner__machine_offpeakperiods[1] = * * * * * sat,sun *
gitlab_runner__machine_offpeakidlecount = 0
gitlab_runner__machine_offpeakidletime = 1200
gitlab_runner__cache = False
gitlab_runner__cache_type = s3
gitlab_runner__cache_server_address = 
gitlab_runner__cache_access_key = 
gitlab_runner__cache_secret_key = 
gitlab_runner__cache_bucket_name = 
gitlab_runner__cache_bucket_location = 
gitlab_runner__cache_insecure = False
gitlab_runner__cache_shared = False
gitlab_runner__run_untagged = True
gitlab_runner__keyring__dependent_apt_keys[0].id = {{ gitlab_runner__apt_key }}
gitlab_runner__keyring__dependent_apt_keys[0].repo = {{ gitlab_runner__apt_repo }}
gitlab_runner__keyring__dependent_apt_keys[0].state = {{ "present" if gitlab_runner__apt_upstream | bool else "absent" }}
