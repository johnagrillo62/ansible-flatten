[0].name = Generate a random string for test
[0].set_fact.test_id = {{ lookup('password', '/dev/null chars=ascii_letters length=16') }}
[0].when = test_id is not defined
[1].name = Generate names
[1].set_fact.org_name1 = AWX-Collection-tests-export-organization-{{ test_id }}
[1].set_fact.org_name2 = AWX-Collection-tests-export-organization2-{{ test_id }}
[1].set_fact.inventory_name1 = AWX-Collection-tests-export-inv1-{{ test_id }}
[2].block[0].name = Create some organizations
[2].block[0].organization.name = {{ item }}
[2].block[0].loop[0] = {{ org_name1 }}
[2].block[0].loop[1] = {{ org_name2 }}
[2].block[1].name = Create an inventory
[2].block[1].inventory.name = {{ inventory_name1 }}
[2].block[1].inventory.organization = {{ org_name1 }}
[2].block[2].name = Export all assets
[2].block[2].export.all = true
[2].block[2].register = all_assets
[2].block[3].assert.that[0] = all_assets is not changed
[2].block[3].assert.that[1] = all_assets is successful
[2].block[3].assert.that[2] = all_assets['assets']['organizations'] | length() >= 2
[2].block[4].name = Export all inventories
[2].block[4].export.inventory = all
[2].block[4].register = inventory_export
[2].block[5].assert.that[0] = inventory_export is successful
[2].block[5].assert.that[1] = inventory_export is not changed
[2].block[5].assert.that[2] = inventory_export['assets']['inventory'] | length() >= 1
[2].block[5].assert.that[3] = 'organizations' not in inventory_export['assets']
[2].block[6].name = Export an all and a specific
[2].block[6].export.inventory = all
[2].block[6].export.organizations = {{ org_name1 }}
[2].block[6].register = mixed_export
[2].block[7].assert.that[0] = mixed_export is successful
[2].block[7].assert.that[1] = mixed_export is not changed
[2].block[7].assert.that[2] = mixed_export['assets']['inventory'] | length() >= 1
[2].block[7].assert.that[3] = mixed_export['assets']['organizations'] | length() == 1
[2].block[7].assert.that[4] = 'workflow_job_templates' not in mixed_export['assets']
[2].block[8].name = Export list of organizations
[2].block[8].export.organizations = {{[org_name1, org_name2]}}
[2].block[8].register = list_asserts
[2].block[9].assert.that[0] = list_asserts is not changed
[2].block[9].assert.that[1] = list_asserts is successful
[2].block[9].assert.that[2] = list_asserts['assets']['organizations'] | length() >= 2
[2].block[10].name = Export list with one organization
[2].block[10].export.organizations = {{[org_name1]}}
[2].block[10].register = list_asserts
[2].block[11].assert.that[0] = list_asserts is not changed
[2].block[11].assert.that[1] = list_asserts is successful
[2].block[11].assert.that[2] = list_asserts['assets']['organizations'] | length() >= 1
[2].block[11].assert.that[3] = org_name1 in (list_asserts['assets']['organizations'] | map(attribute='name') )
[2].block[12].name = Export one organization as string
[2].block[12].export.organizations = {{org_name2}}
[2].block[12].register = string_asserts
[2].block[13].assert.that[0] = string_asserts is not changed
[2].block[13].assert.that[1] = string_asserts is successful
[2].block[13].assert.that[2] = string_asserts['assets']['organizations'] | length() >= 1
[2].block[13].assert.that[3] = org_name2 in (string_asserts['assets']['organizations'] | map(attribute='name') )
[2].always[0].name = Remove our inventory
[2].always[0].inventory.name = {{ inventory_name1 }}
[2].always[0].inventory.organization = {{ org_name1 }}
[2].always[0].inventory.state = absent
[2].always[1].name = Remove test organizations
[2].always[1].organization.name = {{ item }}
[2].always[1].organization.state = absent
[2].always[1].loop[0] = {{ org_name1 }}
[2].always[1].loop[1] = {{ org_name2 }}
