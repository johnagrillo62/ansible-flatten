[0].name = Generate a random string for test
[0].set_fact.test_id = {{ lookup('password', '/dev/null chars=ascii_letters length=16') }}
[0].when = test_id is not defined
[1].name = generate random string for project
[1].set_fact.org_name = AWX-Collection-tests-organization-org-{{ test_id }}
[1].set_fact.cred1 = AWX-Collection-tests-job_template-cred1-{{ test_id }}
[1].set_fact.cred2 = AWX-Collection-tests-job_template-cred2-{{ test_id }}
[1].set_fact.cred3 = AWX-Collection-tests-job_template-cred3-{{ test_id }}
[1].set_fact.inv1 = AWX-Collection-tests-job_template-inv-{{ test_id }}
[1].set_fact.proj1 = AWX-Collection-tests-job_template-proj-{{ test_id }}
[1].set_fact.jt1 = AWX-Collection-tests-job_template-jt1-{{ test_id }}
[1].set_fact.jt2 = AWX-Collection-tests-job_template-jt2-{{ test_id }}
[1].set_fact.lab1 = AWX-Collection-tests-job_template-lab1-{{ test_id }}
[1].set_fact.email_not = AWX-Collection-tests-job_template-email-not-{{ test_id }}
[1].set_fact.webhook_not = AWX-Collection-tests-notification_template-wehbook-not-{{ test_id }}
[1].set_fact.group_name1 = AWX-Collection-tests-instance_group-group1-{{ test_id }}
[2].name = Create a new organization
[2].organization.name = {{ org_name }}
[2].organization.galaxy_credentials[0] = Ansible Galaxy
[2].register = result
[3].name = Create an inventory
[3].inventory.name = {{ inv1 }}
[3].inventory.organization = {{ org_name }}
[4].name = Create a Demo Project
[4].project.name = {{ proj1 }}
[4].project.organization = Default
[4].project.state = present
[4].project.scm_type = git
[4].project.scm_url = https://github.com/ansible/ansible-tower-samples.git
[4].register = proj_result
[5].name = Create Credential1
[5].credential.name = {{ cred1 }}
[5].credential.organization = Default
[5].credential.credential_type = Red Hat Ansible Automation Platform
[5].register = cred1_result
[6].name = Create Credential2
[6].credential.name = {{ cred2 }}
[6].credential.organization = Default
[6].credential.credential_type = Machine
[7].name = Create Credential3
[7].credential.name = {{ cred3 }}
[7].credential.organization = Default
[7].credential.credential_type = Machine
[8].name = Create Labels
[8].label.name = {{ lab1 }}
[8].label.organization = {{ item }}
[8].loop[0] = Default
[8].loop[1] = {{ org_name }}
[9].name = Create an Instance Group
[9].instance_group.name = {{ group_name1 }}
[9].instance_group.state = present
[9].register = result
[10].assert.that[0] = result is changed
[11].name = Add email notification
[11].notification_template.name = {{ email_not }}
[11].notification_template.organization = Default
[11].notification_template.notification_type = email
[11].notification_template.notification_configuration.username = user
[11].notification_template.notification_configuration.password = s3cr3t
[11].notification_template.notification_configuration.sender = tower@example.com
[11].notification_template.notification_configuration.recipients[0] = user1@example.com
[11].notification_template.notification_configuration.host = smtp.example.com
[11].notification_template.notification_configuration.port = 25
[11].notification_template.notification_configuration.use_tls = false
[11].notification_template.notification_configuration.use_ssl = false
[11].notification_template.state = present
[12].name = Add webhook notification
[12].notification_template.name = {{ webhook_not }}
[12].notification_template.organization = Default
[12].notification_template.notification_type = webhook
[12].notification_template.notification_configuration.url = http://www.example.com/hook
[12].notification_template.notification_configuration.headers.X-Custom-Header = value123
[12].notification_template.state = present
[12].register = result
[13].name = Create Job Template 1
[13].job_template.name = {{ jt1 }}
[13].job_template.project = {{ proj1 }}
[13].job_template.inventory = {{ inv1 }}
[13].job_template.playbook = hello_world.yml
[13].job_template.credentials[0] = {{ cred1 }}
[13].job_template.credentials[1] = {{ cred2 }}
[13].job_template.instance_groups[0] = {{ group_name1 }}
[13].job_template.job_type = run
[13].job_template.state = present
[13].register = jt1_result
[14].assert.that[0] = jt1_result is changed
[15].name = Create Job Template 1 with exists
[15].job_template.name = {{ jt1 }}
[15].job_template.project = {{ proj1 }}
[15].job_template.inventory = {{ inv1 }}
[15].job_template.playbook = hello_world.yml
[15].job_template.credentials[0] = {{ cred1 }}
[15].job_template.credentials[1] = {{ cred2 }}
[15].job_template.instance_groups[0] = {{ group_name1 }}
[15].job_template.job_type = run
[15].job_template.state = exists
[15].register = jt1_result
[16].assert.that[0] = jt1_result is not changed
[17].name = Delete Job Template 1
[17].job_template.name = {{ jt1 }}
[17].job_template.project = {{ proj1 }}
[17].job_template.inventory = {{ inv1 }}
[17].job_template.playbook = hello_world.yml
[17].job_template.credentials[0] = {{ cred1 }}
[17].job_template.credentials[1] = {{ cred2 }}
[17].job_template.instance_groups[0] = {{ group_name1 }}
[17].job_template.job_type = run
[17].job_template.state = absent
[17].register = jt1_result
[18].assert.that[0] = jt1_result is changed
[19].name = Create Job Template 1 with exists
[19].job_template.name = {{ jt1 }}
[19].job_template.project = {{ proj1 }}
[19].job_template.inventory = {{ inv1 }}
[19].job_template.playbook = hello_world.yml
[19].job_template.credentials[0] = {{ cred1 }}
[19].job_template.credentials[1] = {{ cred2 }}
[19].job_template.instance_groups[0] = {{ group_name1 }}
[19].job_template.job_type = run
[19].job_template.state = exists
[19].register = jt1_result
[20].assert.that[0] = jt1_result is changed
[21].name = Add a credential to this JT
[21].job_template.name = {{ jt1 }}
[21].job_template.project = {{ proj_result.id }}
[21].job_template.playbook = hello_world.yml
[21].job_template.credentials[0] = {{ cred1_result.id }}
[21].register = result
[22].assert.that[0] = result is changed
[23].name = Try to add the same credential to this JT
[23].job_template.name = {{ jt1_result.id }}
[23].job_template.project = {{ proj1 }}
[23].job_template.playbook = hello_world.yml
[23].job_template.credentials[0] = {{ cred1 }}
[23].register = result
[24].assert.that[0] = result is not changed
[25].name = Add another credential to this JT
[25].job_template.name = {{ jt1 }}
[25].job_template.project = {{ proj1 }}
[25].job_template.playbook = hello_world.yml
[25].job_template.credentials[0] = {{ cred1 }}
[25].job_template.credentials[1] = {{ cred2 }}
[25].register = result
[26].assert.that[0] = result is changed
[27].name = Remove a credential for this JT
[27].job_template.name = {{ jt1 }}
[27].job_template.project = {{ proj1 }}
[27].job_template.playbook = hello_world.yml
[27].job_template.credentials[0] = {{ cred1 }}
[27].register = result
[28].assert.that[0] = result is changed
[29].name = Remove all credentials from this JT
[29].job_template.name = {{ jt1 }}
[29].job_template.project = {{ proj1 }}
[29].job_template.playbook = hello_world.yml
[29].register = result
[30].assert.that[0] = result is changed
[31].name = Copy Job Template
[31].job_template.name = copy_{{ jt1 }}
[31].job_template.copy_from = {{ jt1 }}
[31].job_template.state = present
[32].name = Delete copied Job Template
[32].job_template.name = copy_{{ jt1 }}
[32].job_template.job_type = run
[32].job_template.state = absent
[32].register = result
[33].name = Delete Job Template 1
[33].job_template.name = {{ jt1 }}
[33].job_template.playbook = hello_world.yml
[33].job_template.job_type = run
[33].job_template.project = Does Not Exist
[33].job_template.inventory = Does Not Exist
[33].job_template.webhook_credential = Does Not Exist
[33].job_template.state = absent
[33].register = result
[34].assert.that[0] = result is changed
[35].name = Create Job Template 2
[35].job_template.name = {{ jt2 }}
[35].job_template.organization = Default
[35].job_template.project = {{ proj1 }}
[35].job_template.inventory = {{ inv1 }}
[35].job_template.playbook = hello_world.yml
[35].job_template.credential = {{ cred3 }}
[35].job_template.job_type = run
[35].job_template.labels[0] = {{ lab1 }}
[35].job_template.state = present
[35].register = result
[36].assert.that[0] = result is changed
[37].name = add bad label to Job Template 2
[37].job_template.name = {{ jt2 }}
[37].job_template.organization = Default
[37].job_template.project = {{ proj1 }}
[37].job_template.inventory = {{ inv1 }}
[37].job_template.playbook = hello_world.yml
[37].job_template.credential = {{ cred3 }}
[37].job_template.job_type = run
[37].job_template.labels[0] = label_bad
[37].job_template.state = present
[37].register = bad_label_results
[37].ignore_errors = yes
[38].assert.that[0] = bad_label_results is defined
[38].assert.that[1] = not (bad_label_results.failed | default(false)) or ('msg' in bad_label_results)
[39].name = Add survey to Job Template 2
[39].job_template.name = {{ jt2 }}
[39].job_template.survey_enabled = true
[39].job_template.survey_spec.name = 
[39].job_template.survey_spec.description = 
[39].job_template.survey_spec.spec[0].question_name = Q1
[39].job_template.survey_spec.spec[0].question_description = The first question
[39].job_template.survey_spec.spec[0].required = true
[39].job_template.survey_spec.spec[0].type = text
[39].job_template.survey_spec.spec[0].variable = q1
[39].job_template.survey_spec.spec[0].min = 5
[39].job_template.survey_spec.spec[0].max = 15
[39].job_template.survey_spec.spec[0].default = hello
[39].register = result
[40].assert.that[0] = result is changed
[41].name = Re Add survey to Job Template 2
[41].job_template.name = {{ jt2 }}
[41].job_template.survey_enabled = true
[41].job_template.survey_spec.name = 
[41].job_template.survey_spec.description = 
[41].job_template.survey_spec.spec[0].question_name = Q1
[41].job_template.survey_spec.spec[0].question_description = The first question
[41].job_template.survey_spec.spec[0].required = true
[41].job_template.survey_spec.spec[0].type = text
[41].job_template.survey_spec.spec[0].variable = q1
[41].job_template.survey_spec.spec[0].min = 5
[41].job_template.survey_spec.spec[0].max = 15
[41].job_template.survey_spec.spec[0].default = hello
[41].register = result
[42].assert.that[0] = result is not changed
[43].name = Add question to survey to Job Template 2
[43].job_template.name = {{ jt2 }}
[43].job_template.survey_enabled = true
[43].job_template.survey_spec.name = 
[43].job_template.survey_spec.description = 
[43].job_template.survey_spec.spec[0].question_name = Q1
[43].job_template.survey_spec.spec[0].question_description = The first question
[43].job_template.survey_spec.spec[0].required = true
[43].job_template.survey_spec.spec[0].type = text
[43].job_template.survey_spec.spec[0].variable = q1
[43].job_template.survey_spec.spec[0].min = 5
[43].job_template.survey_spec.spec[0].max = 15
[43].job_template.survey_spec.spec[0].default = hello
[43].job_template.survey_spec.spec[0].choices = 
[43].job_template.survey_spec.spec[1].question_name = Q2
[43].job_template.survey_spec.spec[1].type = text
[43].job_template.survey_spec.spec[1].variable = q2
[43].job_template.survey_spec.spec[1].required = false
[43].register = result
[44].assert.that[0] = result is changed
[45].name = Remove survey from Job Template 2
[45].job_template.name = {{ jt2 }}
[45].job_template.survey_enabled = false
[45].register = result
[46].assert.that[0] = result is changed
[47].name = Add started notifications to Job Template 2
[47].job_template.name = {{ jt2 }}
[47].job_template.notification_templates_started[0] = {{ email_not }}
[47].job_template.notification_templates_started[1] = {{ webhook_not }}
[47].register = result
[48].assert.that[0] = result is changed
[49].name = Re Add started notifications to Job Template 2
[49].job_template.name = {{ jt2 }}
[49].job_template.notification_templates_started[0] = {{ email_not }}
[49].job_template.notification_templates_started[1] = {{ webhook_not }}
[49].register = result
[50].assert.that[0] = result is not changed
[51].name = Add success notifications to Job Template 2
[51].job_template.name = {{ jt2 }}
[51].job_template.notification_templates_success[0] = {{ email_not }}
[51].job_template.notification_templates_success[1] = {{ webhook_not }}
[51].register = result
[52].assert.that[0] = result is changed
[53].name = Remove "on start" webhook notification from Job Template 2
[53].job_template.name = {{ jt2 }}
[53].job_template.notification_templates_started[0] = {{ email_not }}
[53].register = result
[54].assert.that[0] = result is changed
[55].name = Delete Job Template 2
[55].job_template.name = {{ jt2 }}
[55].job_template.project = {{ proj1 }}
[55].job_template.inventory = {{ inv1 }}
[55].job_template.playbook = hello_world.yml
[55].job_template.credential = {{ cred3 }}
[55].job_template.job_type = run
[55].job_template.state = absent
[55].register = del_res
[55].until = del_res is succeeded
[55].retries = 5
[55].delay = 3
[56].assert.that[0] = del_res is changed
[57].name = Delete the Demo Project
[57].project.name = {{ proj1 }}
[57].project.organization = Default
[57].project.state = absent
[57].project.scm_type = git
[57].project.scm_url = https://github.com/ansible/ansible-tower-samples.git
[58].name = Delete Credential1
[58].credential.name = {{ cred1 }}
[58].credential.organization = Default
[58].credential.credential_type = Red Hat Ansible Automation Platform
[58].credential.state = absent
[59].name = Delete Credential2
[59].credential.name = {{ cred2 }}
[59].credential.organization = Default
[59].credential.credential_type = Machine
[59].credential.state = absent
[60].name = Delete Credential3
[60].credential.name = {{ cred3 }}
[60].credential.organization = Default
[60].credential.credential_type = Machine
[60].credential.state = absent
[61].name = Delete email notification
[61].notification_template.name = {{ email_not }}
[61].notification_template.organization = Default
[61].notification_template.state = absent
[62].name = Delete the instance groups
[62].instance_group.name = {{ group_name1 }}
[62].instance_group.state = absent
[63].name = Delete webhook notification
[63].notification_template.name = {{ webhook_not }}
[63].notification_template.organization = Default
[63].notification_template.state = absent
[64].name = Delete an inventory
[64].inventory.name = {{ inv1 }}
[64].inventory.organization = {{ org_name }}
[64].inventory.state = absent
[65].name = Remove the organization
[65].organization.name = {{ org_name }}
[65].organization.state = absent
