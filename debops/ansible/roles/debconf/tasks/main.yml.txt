[0].name = Import DebOps global handlers
[0]["ansible.builtin.import_role"].name = global_handlers
[1].name = Import DebOps secret role
[1]["ansible.builtin.import_role"].name = secret
[2].name = Refresh APT cache when needed
[2]["ansible.builtin.apt"].update_cache = True
[2]["ansible.builtin.apt"].cache_valid_time = {{ debconf__cache_valid_time }}
[2].register = debconf__register_apt_update
[2].until = debconf__register_apt_update is succeeded
[3].name = Install debconf module dependencies
[3]["ansible.builtin.apt"].name[0] = debconf
[3]["ansible.builtin.apt"].name[1] = debconf-utils
[3]["ansible.builtin.apt"].state = present
[3].register = debconf__register_debconf_packages
[3].until = debconf__register_debconf_packages is succeeded
[4].name = Apply requested package configuration in debconf
[4]["ansible.builtin.debconf"].name = {{ item.name }}
[4]["ansible.builtin.debconf"].question = {{ item.question | d(omit) }}
[4]["ansible.builtin.debconf"].unseen = {{ item.unseen | d(omit) }}
[4]["ansible.builtin.debconf"].value = {{ item.value | d(omit) }}
[4]["ansible.builtin.debconf"].vtype = {{ item.vtype | d(omit) }}
[4].loop = {{ debconf__filtered_entries }}
[4].register = debconf__register_entries
[4].when = item.state | d('present') not in [ 'init', 'ignore' ]
[4].no_log = {{ debops__no_log | d(True
                                 if (item.vtype == "password")
                                 else False) }}
[5].name = Detect packages which need to be reconfigured
[5]["ansible.builtin.set_fact"].debconf__fact_reconfigure_packages = {{ lookup("template", "lookup/debconf__fact_reconfigure_packages.j2",
                                                   convert_data=False) | from_yaml | flatten }}
[6].name = Install requested APT packages
[6]["ansible.builtin.apt"].name = {{ q("flattened", debconf__packages
                             + debconf__group_packages
                             + debconf__host_packages) }}
[6]["ansible.builtin.apt"].state = {{ debconf__apt_state }}
[6].register = debconf__register_packages
[6].until = debconf__register_packages is succeeded
[7].name = Reconfigure packages using debconf
[7]["ansible.builtin.command"] = dpkg-reconfigure --frontend noninteractive {{ item }}
[7].loop = {{ debconf__fact_reconfigure_packages }}
[7].register = debconf__register_reconfigure
[7].when = item is defined
[7].changed_when = debconf__register_reconfigure.rc == 0
[8].name = Configure alternative symlinks
[8]["community.general.alternatives"].name = {{ item.name }}
[8]["community.general.alternatives"].path = {{ item.path }}
[8]["community.general.alternatives"].link = {{ item.link | d(omit) }}
[8]["community.general.alternatives"].priority = {{ item.priority | d(omit) }}
[8].loop = {{ q("flattened", debconf__default_alternatives
                           + debconf__alternatives
                           + debconf__group_alternatives
                           + debconf__host_alternatives) }}
[8].when = item.name | d() and item.path | d()
[9].name = Configure automatic alternatives
[9]["ansible.builtin.command"] = update-alternatives --auto {{ item.name }}
[9].register = debconf__register_alternatives
[9].loop = {{ q("flattened", debconf__alternatives
                           + debconf__group_alternatives
                           + debconf__host_alternatives) }}
[9].when = item.name | d() and not item.path | d()
[9].changed_when = debconf__register_alternatives.stdout | d()
[10].name = Execute shell commands
[10]["ansible.builtin.include_tasks"] = shell_commands.yml
[10].loop = {{ q("flattened", debconf__combined_commands) | debops.debops.parse_kv_items }}
[10].loop_control.label = {{ {"name": item.name} }}
[10].when = item.name | d() and item.state | d('present') not in [ 'absent', 'ignore' ]
[10].no_log = {{ debops__no_log | d(item.no_log) | d(False) }}
[10].tags[0] = role::debconf:commands
