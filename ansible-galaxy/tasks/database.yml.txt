[0].name = Manage Galaxy database
[0].block[0].name = Get current Galaxy DB version
[0].block[0].command = {{ galaxy_venv_dir }}/bin/python {{ galaxy_server_dir }}/scripts/manage_db.py -c {{ galaxy_config_file }} db_version
[0].block[0].args.chdir = {{ galaxy_server_dir }}
[0].block[0].register = current_db_version
[0].block[0].changed_when = no
[0].block[0].failed_when[0] = current_db_version.rc != 0
[0].block[0].failed_when[1] = 'migrate.exceptions.DatabaseNotControlledError' not in current_db_version.stderr
[0].block[0].failed_when[2] = 'galaxy.model.migrations.NoVersionTableError' not in current_db_version.stderr
[0].block[0].failed_when[3] = 'galaxy.model.migrations.exceptions.NoVersionTableError' not in current_db_version.stderr
[0].block[0].when = not ansible_check_mode
[0].block[1].name = Get maximum Galaxy DB version
[0].block[1].command = {{ galaxy_venv_dir }}/bin/python {{ galaxy_server_dir }}/scripts/manage_db.py -c {{ galaxy_config_file }} version
[0].block[1].args.chdir = {{ galaxy_server_dir }}
[0].block[1].register = max_db_version
[0].block[1].changed_when = no
[0].block[1].when = not ansible_check_mode
[0].block[2].name = Report current and max Galaxy database
[0].block[2].debug.msg = Current database version is {{ current_db_version.stdout }} and the maximum version is {{ max_db_version.stdout }}.
[0].block[2].changed_when = True
[0].block[2].when[0] = not ansible_check_mode
[0].block[2].when[1] = current_db_version.stdout != max_db_version.stdout
[0].block[2].when[2] = 'migrate.exceptions.DatabaseNotControlledError' not in current_db_version.stderr
[0].block[2].when[3] = 'galaxy.model.migrations.NoVersionTableError' not in current_db_version.stderr
[0].block[2].when[4] = 'galaxy.model.migrations.exceptions.NoVersionTableError' not in current_db_version.stderr
[0].block[3].name = Upgrade Galaxy DB
[0].block[3].command = {{ galaxy_venv_dir }}/bin/python {{ galaxy_server_dir }}/scripts/manage_db.py -c {{ galaxy_config_file }} upgrade
[0].block[3].args.chdir = {{ galaxy_server_dir }}
[0].block[3].when[0] = not ansible_check_mode
[0].block[3].when[1] = current_db_version.stdout != max_db_version.stdout
[0].block[3].when[2] = 'migrate.exceptions.DatabaseNotControlledError' not in current_db_version.stderr
[0].block[3].when[3] = 'galaxy.model.migrations.NoVersionTableError' not in current_db_version.stderr
[0].block[3].when[4] = 'galaxy.model.migrations.exceptions.NoVersionTableError' not in current_db_version.stderr
[0].remote_user = {{ galaxy_remote_users.galaxy | default(__galaxy_remote_user) }}
[0].become = {{ true if galaxy_become_users.galaxy is defined else __galaxy_become }}
[0].become_user = {{ galaxy_become_users.galaxy | default(__galaxy_become_user) }}
