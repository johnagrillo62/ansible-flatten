[0].name = Generate a test ID
[0].set_fact.test_id = {{ lookup('password', '/dev/null chars=ascii_letters length=16') }}
[0].when = test_id is not defined
[1].name = Generate names
[1].set_fact.project_name1 = AWX-Collection-tests-project-project1-{{ test_id }}
[1].set_fact.project_name2 = AWX-Collection-tests-project-project2-{{ test_id }}
[1].set_fact.project_name3 = AWX-Collection-tests-project-project3-{{ test_id }}
[1].set_fact.jt1 = AWX-Collection-tests-project-jt1-{{ test_id }}
[1].set_fact.scm_cred_name = AWX-Collection-tests-project-scm-cred-{{ test_id }}
[1].set_fact.org_name = AWX-Collection-tests-project-org-{{ test_id }}
[1].set_fact.cred_name = AWX-Collection-tests-project-cred-{{ test_id }}
[2].block[0].name = Create an SCM Credential
[2].block[0].credential.name = {{ scm_cred_name }}
[2].block[0].credential.organization = Default
[2].block[0].credential.credential_type = Source Control
[2].block[0].register = result
[2].block[1].assert.that[0] = result is changed
[2].block[2].name = Create a git project without credentials and wait
[2].block[2].project.name = {{ project_name1 }}
[2].block[2].project.organization = Default
[2].block[2].project.scm_type = git
[2].block[2].project.scm_url = https://github.com/ansible/ansible-tower-samples
[2].block[2].project.wait = true
[2].block[2].register = result
[2].block[3].assert.that[0] = result is changed
[2].block[4].name = Create a git project without credentials and wait with exists
[2].block[4].project.name = {{ project_name1 }}
[2].block[4].project.organization = Default
[2].block[4].project.scm_type = git
[2].block[4].project.scm_url = https://github.com/ansible/ansible-tower-samples
[2].block[4].project.wait = true
[2].block[4].project.state = exists
[2].block[4].register = result
[2].block[5].assert.that[0] = result is not changed
[2].block[6].name = Create a git project and wait with short request timeout.
[2].block[6].project.name = {{ project_name1 }}
[2].block[6].project.organization = Default
[2].block[6].project.scm_type = git
[2].block[6].project.scm_url = https://github.com/ansible/ansible-tower-samples
[2].block[6].project.wait = true
[2].block[6].project.state = exists
[2].block[6].project.request_timeout = .001
[2].block[6].register = result
[2].block[6].ignore_errors = yes
[2].block[7].assert.that[0] = result is failed
[2].block[7].assert.that[1] = 'timed out' in result.msg
[2].block[8].name = Delete a git project without credentials and wait
[2].block[8].project.name = {{ project_name1 }}
[2].block[8].project.organization = Default
[2].block[8].project.scm_type = git
[2].block[8].project.scm_url = https://github.com/ansible/ansible-tower-samples
[2].block[8].project.wait = true
[2].block[8].project.state = absent
[2].block[8].register = result
[2].block[9].assert.that[0] = result is changed
[2].block[10].name = Create a git project without credentials and wait with exists
[2].block[10].project.name = {{ project_name1 }}
[2].block[10].project.organization = Default
[2].block[10].project.scm_type = git
[2].block[10].project.scm_url = https://github.com/ansible/ansible-tower-samples
[2].block[10].project.wait = true
[2].block[10].project.state = exists
[2].block[10].register = result
[2].block[11].assert.that[0] = result is changed
[2].block[12].name = Recreate the project to validate not changed
[2].block[12].project.name = {{ project_name1 }}
[2].block[12].project.organization = Default
[2].block[12].project.scm_type = git
[2].block[12].project.scm_url = https://github.com/ansible/ansible-tower-samples
[2].block[12].project.wait = false
[2].block[12].register = result
[2].block[12].ignore_errors = yes
[2].block[13].assert.that[0] = result is not changed
[2].block[14].name = Create organizations
[2].block[14].organization.name = {{ org_name }}
[2].block[14].register = result
[2].block[15].assert.that[0] = result is changed
[2].block[16].name = Create credential
[2].block[16].credential.credential_type = Source Control
[2].block[16].credential.name = {{ cred_name }}
[2].block[16].credential.organization = {{ org_name }}
[2].block[16].register = result
[2].block[17].assert.that[0] = result is changed
[2].block[18].name = Create a new test project in check_mode
[2].block[18].project.name = {{ project_name2 }}
[2].block[18].project.organization = {{ org_name }}
[2].block[18].project.scm_type = git
[2].block[18].project.scm_url = https://github.com/ansible/ansible-tower-samples
[2].block[18].project.scm_credential = {{ cred_name }}
[2].block[18].check_mode = true
[2].block[19].name = Copy project from {{ project_name1 }}
[2].block[19].project.name = {{ project_name2 }}
[2].block[19].project.copy_from = {{ project_name1 }}
[2].block[19].project.organization = {{ org_name }}
[2].block[19].project.scm_type = git
[2].block[19].project.scm_credential = {{ cred_name }}
[2].block[19].project.state = present
[2].block[19].register = result
[2].block[20].assert.that[0] = result.copied
[2].block[21].name = Check module fails with correct msg when given non-existing org as param
[2].block[21].project.name = {{ project_name2 }}
[2].block[21].project.organization = Non_Existing_Org
[2].block[21].project.scm_type = git
[2].block[21].project.scm_url = https://github.com/ansible/ansible-tower-samples
[2].block[21].project.scm_credential = {{ cred_name }}
[2].block[21].register = result
[2].block[21].ignore_errors = yes
[2].block[22].assert.that[0] = result is failed
[2].block[22].assert.that[1] = result is not changed
[2].block[22].assert.that[2] = 'Non_Existing_Org' in result.msg
[2].block[22].assert.that[3] = result.total_results == 0
[2].block[23].name = Check module fails with correct msg when given non-existing credential as param
[2].block[23].project.name = {{ project_name2 }}
[2].block[23].project.organization = {{ org_name }}
[2].block[23].project.scm_type = git
[2].block[23].project.scm_url = https://github.com/ansible/ansible-tower-samples
[2].block[23].project.scm_credential = Non_Existing_Credential
[2].block[23].register = result
[2].block[23].ignore_errors = yes
[2].block[24].assert.that[0] = result is failed
[2].block[24].assert.that[1] = result is not changed
[2].block[24].assert.that[2] = 'Non_Existing_Credential' in result.msg
[2].block[24].assert.that[3] = result.total_results == 0
[2].block[25].name = Create a git project using a branch and allowing branch override
[2].block[25].project.name = {{ project_name3 }}
[2].block[25].project.organization = Default
[2].block[25].project.scm_type = git
[2].block[25].project.scm_branch = empty_branch
[2].block[25].project.scm_url = https://github.com/ansible/test-playbooks
[2].block[25].project.allow_override = true
[2].block[25].register = result
[2].block[26].assert.that[0] = result is changed
[2].block[27].name = Update the project and wait. Verify not changed as no change made to repo and refspec not changed
[2].block[27].project.name = {{ project_name3 }}
[2].block[27].project.organization = Default
[2].block[27].project.scm_type = git
[2].block[27].project.scm_branch = empty_branch
[2].block[27].project.scm_url = https://github.com/ansible/test-playbooks
[2].block[27].project.allow_override = true
[2].block[27].project.wait = true
[2].block[27].project.update_project = true
[2].block[27].register = result
[2].block[28].assert.that[0] = result is not changed
[2].block[29].name = Create a job template that overrides the project scm_branch
[2].block[29].job_template.name = {{ jt1 }}
[2].block[29].job_template.project = {{ project_name3 }}
[2].block[29].job_template.inventory = Demo Inventory
[2].block[29].job_template.scm_branch = master
[2].block[29].job_template.playbook = debug.yml
[2].block[30].name = Launch "{{ jt1 }}"
[2].block[30].job_launch.job_template = {{ jt1 }}
[2].block[30].register = result
[2].block[31].assert.that[0] = result is changed
[2].block[32].name = wait for job {{ result.id }}
[2].block[32].job_wait.job_id = {{ result.id }}
[2].block[32].register = job
[2].block[33].assert.that[0] = job is successful
[2].block[34].name = Rename an inventory
[2].block[34].project.name = {{ project_name3 }}
[2].block[34].project.new_name = {{ project_name3 }}a
[2].block[34].project.organization = Default
[2].block[34].project.state = present
[2].block[34].register = result
[2].block[35].assert.that[0] = result.changed
[2].block[36].name = Set project to remote archive and test that it updates correctly.
[2].block[36].project.name = {{ project_name3 }}
[2].block[36].project.organization = Default
[2].block[36].project.scm_type = archive
[2].block[36].project.scm_url = https://github.com/ansible/test-playbooks/archive/refs/tags/1.0.0.tar.gz
[2].block[36].project.wait = true
[2].block[36].project.update_project = true
[2].block[36].register = result
[2].block[37].assert.that[0] = result is changed
[2].always[0].name = Delete the test job_template
[2].always[0].job_template.name = {{ jt1 }}
[2].always[0].job_template.project = {{ project_name3 }}
[2].always[0].job_template.inventory = Demo Inventory
[2].always[0].job_template.state = absent
[2].always[1].name = Delete the test project 3
[2].always[1].project.name = {{ project_name3 }}
[2].always[1].project.organization = Default
[2].always[1].project.state = absent
[2].always[2].name = Delete the test project 3a
[2].always[2].project.name = {{ project_name3 }}a
[2].always[2].project.organization = Default
[2].always[2].project.state = absent
[2].always[3].name = Delete the test project 2
[2].always[3].project.name = {{ project_name2 }}
[2].always[3].project.organization = {{ org_name }}
[2].always[3].project.state = absent
[2].always[4].name = Delete the SCM Credential
[2].always[4].credential.name = {{ scm_cred_name }}
[2].always[4].credential.organization = Default
[2].always[4].credential.credential_type = Source Control
[2].always[4].credential.state = absent
[2].always[4].register = result
[2].always[5].assert.that[0] = result is changed
[2].always[6].name = Delete the test project 1
[2].always[6].project.name = {{ project_name1 }}
[2].always[6].project.organization = Default
[2].always[6].project.state = absent
[2].always[6].register = result
[2].always[7].assert.that[0] = result is changed
[2].always[8].name = Delete credential
[2].always[8].credential.credential_type = Source Control
[2].always[8].credential.name = {{ cred_name }}
[2].always[8].credential.organization = {{ org_name }}
[2].always[8].credential.state = absent
[2].always[8].register = result
[2].always[9].assert.that[0] = result is changed
[2].always[10].name = Delete the organization
[2].always[10].organization.name = {{ org_name }}
[2].always[10].organization.state = absent
[2].always[10].register = result
[2].always[11].assert.that[0] = result is changed
