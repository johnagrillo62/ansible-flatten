~d0.name = Query Azure VMs IPs
~d1.command = az vm list-ip-addresses -o json --resource-group {{ azure_resource_group }}
~d1.register = vm_ip_list_cmd
~d0.name = Query Azure VMs Roles
~d1.command = az vm list -o json --resource-group {{ azure_resource_group }}
~d1.register = vm_list_cmd
~d0.name = Query Azure Load Balancer Public IP
~d1.command = az network public-ip show -o json -g {{ azure_resource_group }} -n kubernetes-api-pubip
~d1.register = lb_pubip_cmd
~d0.name = Set VM IP, roles lists and load balancer public IP
~d1.set_fact = 
~d2.vm_ip_list = "{{ vm_ip_list_cmd.stdout }}"
~d2.vm_roles_list = "{{ vm_list_cmd.stdout }}"
~d2.lb_pubip = "{{ lb_pubip_cmd.stdout }}"
~d0.name = Generate inventory
~d1.template = 
~d2.src = inventory.j2
~d2.dest = "{{ playbook_dir }}/inventory"
~d2.mode = "0644"
~d0.name = Generate Load Balancer variables
~d1.template = 
~d2.src = loadbalancer_vars.j2
~d2.dest = "{{ playbook_dir }}/loadbalancer_vars.yml"
~d2.mode = "0644"
