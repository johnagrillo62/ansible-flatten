[0].name = Import custom Ansible plugins
[0]["ansible.builtin.import_role"].name = ansible_plugins
[1].name = Import DebOps global handlers
[1]["ansible.builtin.import_role"].name = global_handlers
[2].name = Import DebOps secret role
[2]["ansible.builtin.import_role"].name = secret
[3].name = Check if the dependent recipients file exists
[3]["ansible.builtin.stat"].path = {{ secret + "/etc_aliases/dependent_config/" + inventory_hostname + "/recipients.json" }}
[3].register = etc_aliases__register_dependent_recipients_file
[3].become = False
[3].delegate_to = localhost
[3].when = (ansible_local | d() and ansible_local.etc_aliases | d() and ansible_local.etc_aliases.configured is defined and ansible_local.etc_aliases.configured | bool)
[4].name = Load the dependent recipients from Ansible Controller
[4]["ansible.builtin.slurp"].src = {{ secret + "/etc_aliases/dependent_config/" + inventory_hostname + "/recipients.json" }}
[4].register = etc_aliases__register_dependent_recipients
[4].become = False
[4].delegate_to = localhost
[4].when = (ansible_local | d() and ansible_local.etc_aliases | d() and ansible_local.etc_aliases.configured is defined and ansible_local.etc_aliases.configured | bool and etc_aliases__register_dependent_recipients_file.stat.exists | bool)
[5].name = Make sure that Ansible local facts directory exists
[5]["ansible.builtin.file"].path = /etc/ansible/facts.d
[5]["ansible.builtin.file"].state = directory
[5]["ansible.builtin.file"].owner = root
[5]["ansible.builtin.file"].group = root
[5]["ansible.builtin.file"].mode = 0755
[6].name = Save etc_aliases local facts
[6]["ansible.builtin.template"].src = etc/ansible/facts.d/etc_aliases.fact.j2
[6]["ansible.builtin.template"].dest = /etc/ansible/facts.d/etc_aliases.fact
[6]["ansible.builtin.template"].owner = root
[6]["ansible.builtin.template"].group = root
[6]["ansible.builtin.template"].mode = 0755
[6].notify[0] = Refresh host facts
[6].tags[0] = meta::facts
[7].name = Update Ansible facts if they were modified
[7]["ansible.builtin.meta"] = flush_handlers
[8].name = Generate the /etc/aliases file
[8]["ansible.builtin.template"].src = etc/aliases.j2
[8]["ansible.builtin.template"].dest = /etc/aliases
[8]["ansible.builtin.template"].owner = root
[8]["ansible.builtin.template"].group = root
[8]["ansible.builtin.template"].mode = 0644
[8].notify[0] = Update /etc/aliases.db database
[9].name = Save etc_aliases dependent recipients on Ansible Controller
[9]["ansible.builtin.template"].src = secret/etc_aliases/dependent_config/inventory_hostname/recipients.json.j2
[9]["ansible.builtin.template"].dest = {{ secret + "/etc_aliases/dependent_config/" + inventory_hostname + "/recipients.json" }}
[9]["ansible.builtin.template"].mode = 0644
[9].become = False
[9].delegate_to = localhost
[9].when = etc_aliases__dependent_recipients | length > 0
