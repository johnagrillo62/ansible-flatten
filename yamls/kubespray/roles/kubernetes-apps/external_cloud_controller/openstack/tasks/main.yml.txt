[0].name = External OpenStack Cloud Controller | Check OpenStack credentials
[0].include_tasks = openstack-credential-check.yml
[0].tags = external-openstack
[1].name = External OpenStack Cloud Controller | Get base64 cacert
[1].slurp.src = {{ external_openstack_cacert }}
[1].register = external_openstack_cacert_b64
[1].when[0] = inventory_hostname == groups['kube_control_plane'][0]
[1].when[1] = external_openstack_cacert is defined
[1].when[2] = external_openstack_cacert | length > 0
[1].tags = external-openstack
[2].name = External OpenStack Cloud Controller | Get base64 cloud-config
[2].set_fact.external_openstack_cloud_config_secret = {{ lookup('template', 'external-openstack-cloud-config.j2') | b64encode }}
[2].when = inventory_hostname == groups['kube_control_plane'][0]
[2].tags = external-openstack
[3].name = External OpenStack Cloud Controller | Generate Manifests
[3].template.src = {{ item.file }}.j2
[3].template.dest = {{ kube_config_dir }}/{{ item.file }}
[3].template.group = {{ kube_cert_group }}
[3].template.mode = 0640
[3].with_items[0].name = external-openstack-cloud-config-secret
[3].with_items[0].file = external-openstack-cloud-config-secret.yml
[3].with_items[1].name = external-openstack-cloud-controller-manager-roles
[3].with_items[1].file = external-openstack-cloud-controller-manager-roles.yml
[3].with_items[2].name = external-openstack-cloud-controller-manager-role-bindings
[3].with_items[2].file = external-openstack-cloud-controller-manager-role-bindings.yml
[3].with_items[3].name = external-openstack-cloud-controller-manager-ds
[3].with_items[3].file = external-openstack-cloud-controller-manager-ds.yml
[3].register = external_openstack_manifests
[3].when = inventory_hostname == groups['kube_control_plane'][0]
[3].tags = external-openstack
[4].name = External OpenStack Cloud Controller | Apply Manifests
[4].kube.kubectl = {{ bin_dir }}/kubectl
[4].kube.filename = {{ kube_config_dir }}/{{ item.item.file }}
[4].kube.state = latest
[4].with_items[0] = {{ external_openstack_manifests.results }}
[4].when[0] = inventory_hostname == groups['kube_control_plane'][0]
[4].when[1] = not item is skipped
[4].loop_control.label = {{ item.item.file }}
[4].tags = external-openstack
