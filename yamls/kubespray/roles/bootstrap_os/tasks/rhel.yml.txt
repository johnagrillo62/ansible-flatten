[0].name = Gather host facts to get ansible_distribution_version ansible_distribution_major_version
[0].setup.gather_subset = !all
[0].setup.filter = ansible_distribution_*version
[1].name = Add proxy to yum.conf or dnf.conf if http_proxy is defined
[1]["community.general.ini_file"].path = {{ ((ansible_distribution_major_version | int) < 8) | ternary('/etc/yum.conf', '/etc/dnf/dnf.conf') }}
[1]["community.general.ini_file"].section = main
[1]["community.general.ini_file"].option = proxy
[1]["community.general.ini_file"].value = {{ http_proxy | default(omit) }}
[1]["community.general.ini_file"].state = {{ http_proxy | default(False) | ternary('present', 'absent') }}
[1]["community.general.ini_file"].no_extra_spaces = true
[1]["community.general.ini_file"].mode = 0644
[1].become = true
[1].when = not skip_http_proxy_on_os_packages
[2].name = Add proxy to RHEL subscription-manager if http_proxy is defined
[2].command = /sbin/subscription-manager config --server.proxy_hostname={{ http_proxy | regex_replace(':\d+$') | regex_replace('^.*://') }} --server.proxy_port={{ http_proxy | regex_replace('^.*:') }}
[2].become = true
[2].when[0] = not skip_http_proxy_on_os_packages
[2].when[1] = http_proxy is defined
[3].name = Check RHEL subscription-manager status
[3].command = /sbin/subscription-manager status
[3].register = rh_subscription_status
[3].changed_when = rh_subscription_status.rc != 0
[3].ignore_errors = true
[3].timeout = {{ rh_subscription_check_timeout }}
[3].become = true
[4].name = RHEL subscription Organization ID/Activation Key registration
[4]["community.general.redhat_subscription"].state = present
[4]["community.general.redhat_subscription"].org_id = {{ rh_subscription_org_id }}
[4]["community.general.redhat_subscription"].activationkey = {{ rh_subscription_activation_key }}
[4]["community.general.redhat_subscription"].force_register = true
[4].notify = RHEL auto-attach subscription
[4].become = true
[4].when[0] = rh_subscription_org_id is defined
[4].when[1] = rh_subscription_status.changed
[5].name = RHEL subscription Username/Password registration
[5]["community.general.redhat_subscription"].state = present
[5]["community.general.redhat_subscription"].username = {{ rh_subscription_username }}
[5]["community.general.redhat_subscription"].password = {{ rh_subscription_password }}
[5]["community.general.redhat_subscription"].auto_attach = true
[5]["community.general.redhat_subscription"].force_register = true
[5]["community.general.redhat_subscription"].syspurpose.usage = {{ rh_subscription_usage }}
[5]["community.general.redhat_subscription"].syspurpose.role = {{ rh_subscription_role }}
[5]["community.general.redhat_subscription"].syspurpose.service_level_agreement = {{ rh_subscription_sla }}
[5]["community.general.redhat_subscription"].syspurpose.sync = true
[5].notify = RHEL auto-attach subscription
[5].become = true
[5].no_log = {{ not (unsafe_show_logs | bool) }}
[5].when[0] = rh_subscription_username is defined
[5].when[1] = rh_subscription_status.changed
[6].name = Enable RHEL 8 repos
[6]["community.general.rhsm_repository"].name[0] = rhel-8-for-*-baseos-rpms
[6]["community.general.rhsm_repository"].name[1] = rhel-8-for-*-appstream-rpms
[6]["community.general.rhsm_repository"].state = {{ 'enabled' if (rhel_enable_repos | default(True) | bool) else 'disabled' }}
[6].when[0] = ansible_distribution_major_version == "8"
[6].when[1] = (not rh_subscription_status.changed) or (rh_subscription_username is defined) or (rh_subscription_org_id is defined)
[7].name = Check presence of fastestmirror.conf
[7].stat.path = /etc/yum/pluginconf.d/fastestmirror.conf
[7].stat.get_attributes = false
[7].stat.get_checksum = false
[7].stat.get_mime = false
[7].register = fastestmirror
[8].name = Disable fastestmirror plugin if requested
[8].lineinfile.dest = /etc/yum/pluginconf.d/fastestmirror.conf
[8].lineinfile.regexp = ^enabled=.*
[8].lineinfile.line = enabled=0
[8].lineinfile.state = present
[8].become = true
[8].when[0] = fastestmirror.stat.exists
[8].when[1] = not centos_fastestmirror_enabled
