[0].name = Import custom Ansible plugins
[0]["ansible.builtin.import_role"].name = ansible_plugins
[1].name = Import DebOps global handlers
[1]["ansible.builtin.import_role"].name = global_handlers
[2].name = Import DebOps secret role
[2]["ansible.builtin.import_role"].name = secret
[3].name = Configure pam-mkhomedir to create home directories
[3]["ansible.builtin.template"].src = usr/share/pam-configs/mkhomedir.j2
[3]["ansible.builtin.template"].dest = /usr/share/pam-configs/mkhomedir
[3]["ansible.builtin.template"].mode = 0644
[3].register = nslcd__register_mkhomedir
[4].name = Enable mkhomedir PAM module
[4]["ansible.builtin.shell"] = pam-auth-update --package --remove mkhomedir 2>/dev/null && pam-auth-update --package --enable mkhomedir 2>/dev/null
[4].register = nslcd__register_pam_update
[4].changed_when = nslcd__register_pam_update.changed | bool
[4].when = nslcd__register_mkhomedir is changed
[5].name = Install packages for nslcd support
[5]["ansible.builtin.package"].name = {{ q("flattened", nslcd__base_packages + nslcd__packages) }}
[5]["ansible.builtin.package"].state = present
[5].register = nslcd__register_packages
[5].until = nslcd__register_packages is succeeded
[6].name = Generate nslcd configuration
[6]["ansible.builtin.template"].src = etc/nslcd.conf.j2
[6]["ansible.builtin.template"].dest = /etc/nslcd.conf
[6]["ansible.builtin.template"].group = {{ nslcd__group }}
[6]["ansible.builtin.template"].mode = 0640
[6].register = nslcd__register_config
[6].when = nslcd__ldap_base_dn | d()
[7].name = Restart nslcd if its configuration was modified
[7]["ansible.builtin.service"].name = nslcd
[7]["ansible.builtin.service"].state = restarted
[7].when = nslcd__register_config is changed
[8].name = Make sure that Ansible local facts directory exists
[8]["ansible.builtin.file"].path = /etc/ansible/facts.d
[8]["ansible.builtin.file"].state = directory
[8]["ansible.builtin.file"].mode = 0755
[9].name = Save nslcd local facts
[9]["ansible.builtin.template"].src = etc/ansible/facts.d/nslcd.fact.j2
[9]["ansible.builtin.template"].dest = /etc/ansible/facts.d/nslcd.fact
[9]["ansible.builtin.template"].mode = 0755
[9].notify[0] = Refresh host facts
[9].tags[0] = meta::facts
[10].name = Update Ansible facts if they were modified
[10]["ansible.builtin.meta"] = flush_handlers
