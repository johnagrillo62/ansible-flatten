rabbitmq_server__base_packages[0] = rabbitmq-server
rabbitmq_server__user = rabbitmq
rabbitmq_server__group = rabbitmq
rabbitmq_server__append_groups = {{ ["ssl-cert"] if rabbitmq_server__pki | bool else [] }}
rabbitmq_server__home = /var/lib/rabbitmq
rabbitmq_server__relative_disk_free_limit = 2.0
rabbitmq_server__erlang_cookie_path = {{ rabbitmq_server__home + "/.erlang.cookie" }}
rabbitmq_server__erlang_cookie_password = {{ lookup("password", secret
                                             + "/rabbitmq_server/cluster/erlang_cookie "
                                             + "length=64") }}
rabbitmq_server__combined_environment = {{ rabbitmq_server__environment
                                           | combine(rabbitmq_server__group_environment,
                                                     rabbitmq_server__host_environment) }}
rabbitmq_server__default_config[0].name = ssl
rabbitmq_server__default_config[0].state = {{ "present" if rabbitmq_server__pki | bool else "ignore" }}
rabbitmq_server__default_config[0].options[0].name = versions
rabbitmq_server__default_config[0].options[0].value[0] = tlsv1.2
rabbitmq_server__default_config[0].options[0].value[1] = tlsv1.1
rabbitmq_server__default_config[0].options[0].type = atom
rabbitmq_server__default_config[0].options[1].name = ciphers
rabbitmq_server__default_config[0].options[1].value = [
  {{ rabbitmq_server__ssl_ciphers | indent(2) }}
]

rabbitmq_server__default_config[0].options[1].type = raw
rabbitmq_server__default_config[0].options[1].state = {{ "present"
                   if rabbitmq_server__ssl_ciphers
                   else "ignore" }}
rabbitmq_server__default_config[0].options[2].client_renegotiation = False
rabbitmq_server__default_config[0].options[3].secure_renegotiate = True
rabbitmq_server__default_config[0].options[4].reuse_sessions = True
rabbitmq_server__default_config[0].options[5].honor_cipher_order = True
rabbitmq_server__default_config[0].options[6].honor_ecc_order = True
rabbitmq_server__default_config[1].name = rabbit
rabbitmq_server__default_config[1].state = {{ "present" if rabbitmq_server__pki | bool else "ignore" }}
rabbitmq_server__default_config[1].options[0].name = tcp_listeners
rabbitmq_server__default_config[1].options[0].comment = Listen for TCP connections only on the 'localhost' interface
when the TLS support is enabled

rabbitmq_server__default_config[1].options[0].value = [{"127.0.0.1", 5672},
 {"::1",       5672}]

rabbitmq_server__default_config[1].options[0].type = raw
rabbitmq_server__default_config[1].options[0].state = {{ "ignore" if rabbitmq_server__amqp_allow else "present" }}
rabbitmq_server__default_config[1].options[1].ssl_listeners[0] = 5671
rabbitmq_server__default_config[1].options[2].name = ssl_options
rabbitmq_server__default_config[1].options[2].value = [{cacertfile,           "{{ rabbitmq_server__cacertfile }}"},
 {certfile,             "{{ rabbitmq_server__certfile }}"},
 {keyfile,              "{{ rabbitmq_server__keyfile }}"},
 {% if rabbitmq_server__ssl_dhparam %}
{dhfile,               "{{ rabbitmq_server__ssl_dhparam }}"},
 {% endif -%}
 {versions,             ['tlsv1.2', 'tlsv1.1']},
 {depth,                2},
 {% if rabbitmq_server__ssl_ciphers %}
{ciphers,              [
                          {{ rabbitmq_server__ssl_ciphers | indent(26) }}
                        ]},
 {% endif -%}
 {honor_cipher_order,   true},
 {honor_ecc_order,      true},
 {client_renegotiation, false},
 {secure_renegotiate,   true},
 {reuse_sessions,       true},
 {verify,               verify_peer},
 {fail_if_no_peer_cert, false}]

rabbitmq_server__default_config[1].options[2].type = raw
rabbitmq_server__default_config[2].name = rabbit
rabbitmq_server__default_config[2].options[0].name = disk_free_limit
rabbitmq_server__default_config[2].options[0].value = {mem_relative, {{ rabbitmq_server__relative_disk_free_limit }}{{ "}" }}
rabbitmq_server__default_config[2].options[0].type = raw
rabbitmq_server__dependent_role = 
rabbitmq_server__dependent_state = present
rabbitmq_server__dependent_config_filter = {{ lookup("template",
                                              "lookup/rabbitmq_server__dependent_config_filter.j2")
                                              | from_yaml }}
rabbitmq_server__combined_config = {{ rabbitmq_server__default_config
                                      + rabbitmq_server__dependent_config_filter
                                      + rabbitmq_server__config
                                      + rabbitmq_server__group_config
                                      + rabbitmq_server__host_config }}
rabbitmq_server__default_plugins[0].name = rabbitmq_management_agent
rabbitmq_server__combined_plugins = {{ rabbitmq_server__default_plugins
                                       + rabbitmq_server__plugins
                                       + rabbitmq_server__group_plugins
                                       + rabbitmq_server__host_plugins }}
rabbitmq_server__parameters_vhosts = {{ lookup("template",
                                        "lookup/rabbitmq_server__parameters_vhosts.j2") }}
rabbitmq_server__policies_vhosts = {{ lookup("template",
                                      "lookup/rabbitmq_server__policies_vhosts.j2") }}
rabbitmq_server__accounts_vhosts = {{ lookup("template",
                                      "lookup/rabbitmq_server__accounts_vhosts.j2") }}
rabbitmq_server__combined_vhosts = {{ rabbitmq_server__vhosts
                                      + rabbitmq_server__group_vhosts
                                      + rabbitmq_server__host_vhosts
                                      + rabbitmq_server__parameters_vhosts
                                      + rabbitmq_server__policies_vhosts
                                      + rabbitmq_server__accounts_vhosts }}
rabbitmq_server__combined_vhost_limits = {{ rabbitmq_server__vhost_limits
                                          + rabbitmq_server__group_vhost_limits
                                          + rabbitmq_server__host_vhost_limits }}
rabbitmq_server__combined_parameters = {{ rabbitmq_server__parameters
                                          + rabbitmq_server__group_parameters
                                          + rabbitmq_server__host_parameters }}
rabbitmq_server__combined_policies = {{ rabbitmq_server__policies
                                        + rabbitmq_server__group_policies
                                        + rabbitmq_server__host_policies }}
rabbitmq_server__admin_accounts = {{ lookup("template",
                                     "lookup/rabbitmq_server__admin_accounts.j2") }}
rabbitmq_server__default_accounts[0].name = guest
rabbitmq_server__default_accounts[0].state = absent
rabbitmq_server__combined_accounts = {{ rabbitmq_server__admin_accounts
                                        + rabbitmq_server__default_accounts
                                        + rabbitmq_server__accounts
                                        + rabbitmq_server__group_accounts
                                        + rabbitmq_server__host_accounts }}
rabbitmq_server__admin_default_vhost = /
rabbitmq_server__account_password_length = 32
rabbitmq_server__combined_user_limits = {{ rabbitmq_server__user_limits
                                           + rabbitmq_server__group_user_limits
                                           + rabbitmq_server__host_user_limits }}
rabbitmq_server__combined_exchanges = {{ rabbitmq_server__exchanges
                                         + rabbitmq_server__group_exchanges
                                         + rabbitmq_server__host_exchanges }}
rabbitmq_server__combined_queues = {{ rabbitmq_server__queues
                                      + rabbitmq_server__group_queues
                                      + rabbitmq_server__host_queues }}
rabbitmq_server__combined_bindings = {{ rabbitmq_server__bindings
                                        + rabbitmq_server__group_bindings
                                        + rabbitmq_server__host_bindings }}
rabbitmq_server__combined_feature_flags = {{ rabbitmq_server__feature_flags
                                             + rabbitmq_server__group_feature_flags
                                             + rabbitmq_server__host_feature_flags }}
rabbitmq_server__combined_global_parameters = {{ rabbitmq_server__global_parameters
                                                 + rabbitmq_server__group_global_parameters
                                                 + rabbitmq_server__host_global_parameters }}
rabbitmq_server__pki = {{ True
                          if (ansible_local.pki.enabled | d() and
                              ansible_local.pki.enabled | bool) else False }}
rabbitmq_server__pki_path = {{ ansible_local.pki.path | d("/etc/pki/realms") }}
rabbitmq_server__pki_realm = {{ ansible_local.pki.realm | d("domain") }}
rabbitmq_server__pki_ca = {{ ansible_local.pki.ca | d("CA.crt") }}
rabbitmq_server__pki_crt = {{ ansible_local.pki.crt | d("default.crt") }}
rabbitmq_server__pki_key = {{ ansible_local.pki.key | d("default.key") }}
rabbitmq_server__cacertfile = {{ rabbitmq_server__pki_path
                                 + "/" + rabbitmq_server__pki_realm
                                 + "/" + rabbitmq_server__pki_ca }}
rabbitmq_server__certfile = {{ rabbitmq_server__pki_path
                               + "/" + rabbitmq_server__pki_realm
                               + "/" + rabbitmq_server__pki_crt }}
rabbitmq_server__keyfile = {{ rabbitmq_server__pki_path
                              + "/" + rabbitmq_server__pki_realm
                              + "/" + rabbitmq_server__pki_key }}
rabbitmq_server__ssl_versions[0] = tlsv1.2
rabbitmq_server__ssl_versions[1] = tlsv1.1
rabbitmq_server__ssl_ciphers = {{ ansible_local.rabbitmq_server.raw_erlang_ssl_ciphers | d("") }}
rabbitmq_server__ssl_dhparam = {{ (ansible_local.dhparam[rabbitmq_server__ssl_dhparam_set]
                                   if (ansible_local | d() and ansible_local.dhparam | d() and
                                       ansible_local.dhparam[rabbitmq_server__ssl_dhparam_set] | d())
                                   else "") }}
rabbitmq_server__ssl_dhparam_set = default
rabbitmq_server__etc_services__dependent_list[0].name = einc
rabbitmq_server__etc_services__dependent_list[0].port = 25672
rabbitmq_server__etc_services__dependent_list[0].comment = Erlang Inter-Node Communication (RabbitMQ)
rabbitmq_server__ferm__dependent_rules[0].name = rabbitmq-amqp
rabbitmq_server__ferm__dependent_rules[0].type = accept
rabbitmq_server__ferm__dependent_rules[0].saddr = {{ rabbitmq_server__amqp_allow }}
rabbitmq_server__ferm__dependent_rules[0].dport[0] = amqp
rabbitmq_server__ferm__dependent_rules[0].accept_any = {{ False if rabbitmq_server__pki | bool else True }}
rabbitmq_server__ferm__dependent_rules[1].name = rabbitmq-amqps
rabbitmq_server__ferm__dependent_rules[1].type = accept
rabbitmq_server__ferm__dependent_rules[1].saddr = {{ rabbitmq_server__amqps_allow }}
rabbitmq_server__ferm__dependent_rules[1].dport[0] = amqps
rabbitmq_server__ferm__dependent_rules[1].accept_any = True
rabbitmq_server__ferm__dependent_rules[1].rule_state = {{ "present" if rabbitmq_server__pki | bool else "absent" }}
rabbitmq_server__ferm__dependent_rules[2].name = rabbitmq-cluster
rabbitmq_server__ferm__dependent_rules[2].type = accept
rabbitmq_server__ferm__dependent_rules[2].saddr = {{ rabbitmq_server__cluster_allow }}
rabbitmq_server__ferm__dependent_rules[2].dport[0] = epmd
rabbitmq_server__ferm__dependent_rules[2].dport[1] = einc
rabbitmq_server__ferm__dependent_rules[2].accept_any = False
