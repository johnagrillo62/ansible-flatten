[0].name = Import custom Ansible plugins
[0]["ansible.builtin.import_role"].name = ansible_plugins
[1].name = Import DebOps global handlers
[1]["ansible.builtin.import_role"].name = global_handlers
[2].name = Install imapproxy packages
[2]["ansible.builtin.package"].name = {{ q("flattened", (imapproxy__base_packages
                              + imapproxy__packages)) }} 
[2]["ansible.builtin.package"].state = present
[2].register = imapproxy__register_packages
[2].until = imapproxy__register_packages is succeeded
[2].tags[0] = role::imapproxy:pkg
[3].name = Make sure that Ansible local facts directory exists
[3]["ansible.builtin.file"].path = /etc/ansible/facts.d
[3]["ansible.builtin.file"].state = directory
[3]["ansible.builtin.file"].mode = 0755
[4].name = Save imapproxy local facts
[4]["ansible.builtin.template"].src = etc/ansible/facts.d/imapproxy.fact.j2
[4]["ansible.builtin.template"].dest = /etc/ansible/facts.d/imapproxy.fact
[4]["ansible.builtin.template"].mode = 0755
[4].notify[0] = Refresh host facts
[4].tags[0] = meta::facts
[5].name = Update Ansible facts if they were modified
[5]["ansible.builtin.meta"] = flush_handlers
[6].name = Divert original imapproxy configuration file
[6]["debops.debops.dpkg_divert"].path = /etc/imapproxy.conf
[6].notify[0] = Restart imapproxy
[6].tags[0] = role::imapproxy:config
[7].name = Generate imapproxy configuration
[7]["ansible.builtin.template"].src = etc/imapproxy.conf.j2
[7]["ansible.builtin.template"].dest = /etc/imapproxy.conf
[7]["ansible.builtin.template"].owner = root
[7]["ansible.builtin.template"].group = root
[7]["ansible.builtin.template"].mode = 0644
[7].notify[0] = Restart imapproxy
[7].tags[0] = role::imapproxy:config
[8].name = Make sure that PKI hook directory exists
[8]["ansible.builtin.file"].path = {{ imapproxy__pki_hook_path }}
[8]["ansible.builtin.file"].state = directory
[8]["ansible.builtin.file"].owner = root
[8]["ansible.builtin.file"].group = root
[8]["ansible.builtin.file"].mode = 0755
[8].when = imapproxy__pki | bool
[9].name = Manage PKI imapproxy hook
[9]["ansible.builtin.template"].src = etc/pki/hooks/imapproxy.j2
[9]["ansible.builtin.template"].dest = {{ imapproxy__pki_hook_path + "/" + imapproxy__pki_hook_name }}
[9]["ansible.builtin.template"].owner = root
[9]["ansible.builtin.template"].group = root
[9]["ansible.builtin.template"].mode = 0755
[9].when = imapproxy__pki | bool
[10].name = Ensure the PKI imapproxy hook is absent
[10]["ansible.builtin.file"].path = {{ imapproxy__pki_hook_path + "/" + imapproxy__pki_hook_name }}
[10]["ansible.builtin.file"].state = absent
[10].when = not (imapproxy__pki | bool)
