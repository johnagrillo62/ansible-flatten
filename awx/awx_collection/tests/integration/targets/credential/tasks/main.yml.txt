~d0.name = Generate a random string for test
~d1.set_fact = 
~d2.test_id = "{{ lookup('password', '/dev/null chars=ascii_letters length=16') }}"
~d1.when = test_id is not defined
~d0.name = Generate names
~d1.set_fact = 
~d2.ssh_cred_name1 = "AWX-Collection-tests-credential-ssh-cred1-{{ test_id }}"
~d2.ssh_cred_name2 = "AWX-Collection-tests-credential-ssh-cred2-{{ test_id }}"
~d2.ssh_cred_name3 = "AWX-Collection-tests-credential-ssh-cred-lookup-source-{{ test_id }}"
~d2.ssh_cred_name4 = "AWX-Collection-tests-credential-ssh-cred-file-source-{{ test_id }}"
~d2.vault_cred_name1 = "AWX-Collection-tests-credential-vault-cred1-{{ test_id }}"
~d2.vault_cred_name2 = "AWX-Collection-tests-credential-vault-ssh-cred1-{{ test_id }}"
~d2.net_cred_name1 = "AWX-Collection-tests-credential-net-cred1-{{ test_id }}"
~d2.scm_cred_name1 = "AWX-Collection-tests-credential-scm-cred1-{{ test_id }}"
~d2.aws_cred_name1 = "AWX-Collection-tests-credential-aws-cred1-{{ test_id }}"
~d2.vmware_cred_name1 = "AWX-Collection-tests-credential-vmware-cred1-{{ test_id }}"
~d2.sat6_cred_name1 = "AWX-Collection-tests-credential-sat6-cred1-{{ test_id }}"
~d2.gce_cred_name1 = "AWX-Collection-tests-credential-gce-cred1-{{ test_id }}"
~d2.azurerm_cred_name1 = "AWX-Collection-tests-credential-azurerm-cred1-{{ test_id }}"
~d2.openstack_cred_name1 = "AWX-Collection-tests-credential-openstack-cred1-{{ test_id }}"
~d2.rhv_cred_name1 = "AWX-Collection-tests-credential-rhv-cred1-{{ test_id }}"
~d2.insights_cred_name1 = "AWX-Collection-tests-credential-insights-cred1-{{ test_id }}"
~d2.insights_cred_name2 = "AWX-Collection-tests-credential-insights-cred2-{{ test_id }}"
~d2.tower_cred_name1 = "AWX-Collection-tests-credential-tower-cred1-{{ test_id }}"
~d0.name = Get current Credential Types available
~d1.ansible.builtin.set_fact = 
~d2.credentials = "{{ lookup('awx.awx.controller_api', 'credential_types') }}"
~d0.name = Register Credentials found
~d1.set_fact = 
~d2.aws_found = "{{ 'Amazon Web Services' in credentials | map(attribute='name') | list }}"
~d2.vmware_found = "{{ 'VMware vCenter' in credentials | map(attribute='name') | list }}"
~d2.azure_found = "{{ 'Microsoft Azure Resource Manager' in credentials | map(attribute='name') | list }}"
~d2.gce_found = "{{ 'Google Compute Engine' in credentials | map(attribute='name') | list }}"
~d2.insights_found = "{{ 'Red Hat Insights' in credentials | map(attribute='name') | list }}"
~d2.satellite_found = "{{ 'Red Hat Satellite 6' in credentials | map(attribute='name') | list }}"
~d2.openstack_found = "{{ 'OpenStack' in credentials | map(attribute='name') | list }}"
~d2.rhv_found = "{{ 'Red Hat Virtualization' in credentials | map(attribute='name') | list }}"
~d0.name = create a tempdir for an SSH key
~d1.local_action = shell mktemp -d
~d1.register = tempdir
~d0.name = Generate a local SSH key
~d1.local_action = "shell ssh-keygen -b 2048 -t rsa -f {{ tempdir.stdout }}/id_rsa -q -N 'passphrase'"
~d0.name = Read the generated key
~d1.set_fact = 
~d2.ssh_key_data = "{{ lookup('file', tempdir.stdout + '/id_rsa') }}"
~d0.name = Create an Org-specific credential with an ID
~d1.credential = 
~d2.name = "{{ ssh_cred_name1 }}"
~d2.organization = Default
~d2.credential_type = Machine
~d2.state = present
~d1.register = result
~d0.assert = 
~d2.that = 
~d0.name = Create an Org-specific credential with an ID with exists
~d1.credential = 
~d2.name = "{{ ssh_cred_name1 }}"
~d2.organization = Default
~d2.credential_type = Machine
~d2.state = exists
~d1.register = result
~d0.assert = 
~d2.that = 
~d0.name = Delete an Org-specific credential with an ID
~d1.credential = 
~d2.name = "{{ ssh_cred_name1 }}"
~d2.organization = Default
~d2.credential_type = Machine
~d2.state = absent
~d1.register = result
~d0.assert = 
~d2.that = 
~d0.name = Delete a credential without credential_type
~d1.credential = 
~d2.name = "{{ ssh_cred_name1 }}"
~d2.organization = Default
~d2.state = absent
~d1.register = result
~d1.ignore_errors = yes
~d0.assert = 
~d2.that = 
~d0.name = Create an Org-specific credential with an ID with exists
~d1.credential = 
~d2.name = "{{ ssh_cred_name1 }}"
~d2.organization = Default
~d2.credential_type = Machine
~d2.state = exists
~d1.register = result
~d0.assert = 
~d2.that = 
~d0.name = Delete a Org-specific credential
~d1.credential = 
~d2.name = "{{ ssh_cred_name1 }}"
~d2.organization = Default
~d2.state = absent
~d2.credential_type = Machine
~d1.register = result
~d0.assert = 
~d2.that = 
~d0.name = Create the User-specific credential
~d1.credential = 
~d2.name = "{{ ssh_cred_name1 }}"
~d2.user = admin
~d2.credential_type = 'Machine'
~d2.state = present
~d1.register = result
~d0.assert = 
~d2.that = 
~d0.name = Delete a User-specific credential
~d1.credential = 
~d2.name = "{{ ssh_cred_name1 }}"
~d2.user = admin
~d2.state = absent
~d2.credential_type = 'Machine'
~d1.register = result
~d0.assert = 
~d2.that = 
~d0.name = Create a valid SSH credential
~d1.credential = 
~d2.name = "{{ ssh_cred_name2 }}"
~d2.organization = Default
~d2.state = present
~d2.credential_type = Machine
~d2.description = An example SSH credential
~d2.inputs = 
~d3.username = joe
~d3.password = secret
~d3.become_method = sudo
~d3.become_username = superuser
~d3.become_password = supersecret
~d3.ssh_key_data = "{{ ssh_key_data }}"
~d3.ssh_key_unlock = "passphrase"
~d1.register = result
~d0.assert = 
~d2.that = 
~d0.name = Create a valid SSH credential
~d1.credential = 
~d2.name = "{{ ssh_cred_name2 }}"
~d2.organization = Default
~d2.state = present
~d2.credential_type = Machine
~d2.description = An example SSH credential
~d2.inputs = 
~d3.username = joe
~d3.become_method = sudo
~d3.become_username = superuser
~d1.register = result
~d0.assert = 
~d2.that = 
~d0.name = Check for inputs idempotency (when "inputs" is blank)
~d1.credential = 
~d2.name = "{{ ssh_cred_name2 }}"
~d2.organization = Default
~d2.state = present
~d2.credential_type = Machine
~d2.description = An example SSH credential
~d1.register = result
~d0.assert = 
~d2.that = 
~d0.name = Copy ssh Credential
~d1.credential = 
~d2.name = "copy_{{ ssh_cred_name2 }}"
~d2.copy_from = "{{ ssh_cred_name2 }}"
~d2.credential_type = Machine
~d1.register = result
~d0.assert = 
~d2.that = 
~d0.name = Delete an SSH credential
~d1.credential = 
~d2.name = "copy_{{ ssh_cred_name2 }}"
~d2.organization = Default
~d2.state = absent
~d2.credential_type = Machine
~d1.register = result
~d0.assert = 
~d2.that = 
~d0.name = Create a valid SSH credential from lookup source
~d1.credential = 
~d2.name = "{{ ssh_cred_name3 }}"
~d2.organization = Default
~d2.state = present
~d2.credential_type = Machine
~d2.description = An example SSH credential from lookup source
~d2.inputs = 
~d3.username = joe
~d3.password = secret
~d3.become_method = sudo
~d3.become_username = superuser
~d3.become_password = supersecret
~d3.ssh_key_data = "{{ lookup('file', tempdir.stdout + '/id_rsa') }}"
~d3.ssh_key_unlock = "passphrase"
~d1.register = result
~d0.assert = 
~d2.that = 
~d0.name = Delete an SSH credential
~d1.credential = 
~d2.name = "{{ ssh_cred_name2 }}"
~d2.organization = Default
~d2.state = absent
~d2.credential_type = Machine
~d1.register = result
~d0.assert = 
~d2.that = 
~d0.name = Ensure existence of SSH credential
~d1.credential = 
~d2.name = "{{ ssh_cred_name2 }}"
~d2.organization = Default
~d2.state = exists
~d2.credential_type = Machine
~d2.description = An example SSH awx.awx.credential
~d2.inputs = 
~d3.username = joe
~d3.password = secret
~d3.become_method = sudo
~d3.become_username = superuser
~d3.become_password = supersecret
~d3.ssh_key_data = "{{ ssh_key_data }}"
~d3.ssh_key_unlock = "passphrase"
~d1.register = result
~d0.assert = 
~d2.that = 
~d0.name = Ensure existence of SSH credential, not updating any inputs
~d1.credential = 
~d2.name = "{{ ssh_cred_name2 }}"
~d2.organization = Default
~d2.state = exists
~d2.credential_type = Machine
~d2.description = An example SSH awx.awx.credential
~d2.inputs = 
~d3.username = joe
~d3.password = no-update-secret
~d3.become_method = sudo
~d3.become_username = some-other-superuser
~d3.become_password = some-other-secret
~d3.ssh_key_data = "{{ ssh_key_data }}"
~d3.ssh_key_unlock = "another-pass-phrase"
~d1.register = result
~d0.assert = 
~d2.that = 
~d0.name = Create an invalid SSH credential (passphrase required)
~d1.credential = 
~d2.name = SSH Credential
~d2.organization = Default
~d2.state = present
~d2.credential_type = Machine
~d2.inputs = 
~d3.username = joe
~d3.ssh_key_data = "{{ ssh_key_data }}"
~d1.ignore_errors = yes
~d1.register = result
~d0.assert = 
~d2.that = 
~d0.name = Create an invalid SSH credential (Organization not found)
~d1.credential = 
~d2.name = SSH Credential
~d2.organization = Missing_Organization
~d2.state = present
~d2.credential_type = Machine
~d2.inputs = 
~d3.username = joe
~d1.ignore_errors = yes
~d1.register = result
~d0.assert = 
~d2.that = 
~d0.name = Delete an SSH credential
~d1.credential = 
~d2.name = "{{ ssh_cred_name2 }}"
~d2.organization = Default
~d2.state = absent
~d2.credential_type = Machine
~d1.register = result
~d0.assert = 
~d2.that = 
~d0.name = Delete an SSH credential
~d1.credential = 
~d2.name = "{{ ssh_cred_name3 }}"
~d2.organization = Default
~d2.state = absent
~d2.credential_type = Machine
~d1.register = result
~d0.assert = 
~d2.that = 
~d0.name = Delete an SSH credential
~d1.credential = 
~d2.name = "{{ ssh_cred_name4 }}"
~d2.organization = Default
~d2.state = absent
~d2.credential_type = Machine
~d1.register = result
~d0.assert = 
~d2.that = 
~d0.name = Create a valid Vault credential
~d1.credential = 
~d2.name = "{{ vault_cred_name1 }}"
~d2.organization = Default
~d2.state = present
~d2.credential_type = Vault
~d2.description = An example Vault credential
~d2.inputs = 
~d3.vault_id = bar
~d3.vault_password = secret-vault
~d1.register = result
~d0.assert = 
~d2.that = 
~d0.name = Delete a Vault credential
~d1.credential = 
~d2.name = "{{ vault_cred_name1 }}"
~d2.organization = Default
~d2.state = absent
~d2.credential_type = Vault
~d1.register = result
~d0.assert = 
~d2.that = 
~d0.name = Delete a Vault credential
~d1.credential = 
~d2.name = "{{ vault_cred_name2 }}"
~d2.organization = Default
~d2.state = absent
~d2.credential_type = Vault
~d1.register = result
~d0.assert = 
~d2.that = 
~d0.name = Create a valid Network credential
~d1.credential = 
~d2.name = "{{ net_cred_name1 }}"
~d2.organization = Default
~d2.state = present
~d2.credential_type = Network
~d2.inputs = 
~d3.username = joe
~d3.password = secret
~d3.authorize = true
~d3.authorize_password = authorize-me
~d1.register = result
~d0.assert = 
~d2.that = 
~d0.name = Delete a Network credential
~d1.credential = 
~d2.name = "{{ net_cred_name1 }}"
~d2.organization = Default
~d2.state = absent
~d2.credential_type = Network
~d1.register = result
~d0.assert = 
~d2.that = 
~d0.name = Create a valid SCM credential
~d1.credential = 
~d2.name = "{{ scm_cred_name1 }}"
~d2.organization = Default
~d2.state = present
~d2.credential_type = Source Control
~d2.inputs = 
~d3.username = joe
~d3.password = secret
~d3.ssh_key_data = "{{ ssh_key_data }}"
~d3.ssh_key_unlock = "passphrase"
~d1.register = result
~d0.assert = 
~d2.that = 
~d0.name = Delete an SCM credential
~d1.credential = 
~d2.name = "{{ scm_cred_name1 }}"
~d2.organization = Default
~d2.state = absent
~d2.credential_type = Source Control
~d1.register = result
~d0.assert = 
~d2.that = 
~d0.name = Create a valid AWS credential
~d1.credential = 
~d2.name = "{{ aws_cred_name1 }}"
~d2.organization = Default
~d2.state = present
~d2.credential_type = Amazon Web Services
~d2.inputs = 
~d3.username = joe
~d3.password = secret
~d3.security_token = aws-token
~d1.register = result
~d1.when = aws_found
~d0.assert = 
~d2.that = 
~d1.when = aws_found
~d0.name = Delete an AWS credential
~d1.credential = 
~d2.name = "{{ aws_cred_name1 }}"
~d2.organization = Default
~d2.state = absent
~d2.credential_type = Amazon Web Services
~d1.register = result
~d1.when = aws_found
~d0.assert = 
~d2.that = 
~d1.when = aws_found
~d0.name = Create a valid VMWare credential
~d1.credential = 
~d2.name = "{{ vmware_cred_name1 }}"
~d2.organization = Default
~d2.state = present
~d2.credential_type = VMware vCenter
~d2.inputs = 
~d3.host = https://example.org
~d3.username = joe
~d3.password = secret
~d1.register = result
~d1.when = vmware_found
~d0.assert = 
~d2.that = 
~d1.when = vmware_found
~d0.name = Delete an VMWare credential
~d1.credential = 
~d2.name = "{{ vmware_cred_name1 }}"
~d2.organization = Default
~d2.state = absent
~d2.credential_type = VMware vCenter
~d1.register = result
~d1.when = vmware_found
~d0.assert = 
~d2.that = 
~d1.when = vmware_found
~d0.name = Create a valid Satellite6 credential
~d1.credential = 
~d2.name = "{{ sat6_cred_name1 }}"
~d2.organization = Default
~d2.state = present
~d2.credential_type = Red Hat Satellite 6
~d2.inputs = 
~d3.host = https://example.org
~d3.username = joe
~d3.password = secret
~d1.register = result
~d1.when = satellite_found
~d0.assert = 
~d2.that = 
~d1.when = satellite_found
~d0.name = Delete a Satellite6 credential
~d1.credential = 
~d2.name = "{{ sat6_cred_name1 }}"
~d2.organization = Default
~d2.state = absent
~d2.credential_type = Red Hat Satellite 6
~d1.register = result
~d1.when = satellite_found
~d0.assert = 
~d2.that = 
~d1.when = satellite_found
~d0.name = Create a valid GCE credential
~d1.credential = 
~d2.name = "{{ gce_cred_name1 }}"
~d2.organization = Default
~d2.state = present
~d2.credential_type = Google Compute Engine
~d2.inputs = 
~d3.username = joe
~d3.project = ABC123
~d3.ssh_key_data = "{{ ssh_key_data }}"
~d1.register = result
~d1.when = gce_found
~d0.assert = 
~d2.that = 
~d1.when = gce_found
~d0.name = Delete a GCE credential
~d1.credential = 
~d2.name = "{{ gce_cred_name1 }}"
~d2.organization = Default
~d2.state = absent
~d2.credential_type = Google Compute Engine
~d1.register = result
~d1.when = gce_found
~d0.assert = 
~d2.that = 
~d1.when = gce_found
~d0.name = Create a valid AzureRM credential
~d1.credential = 
~d2.name = "{{ azurerm_cred_name1 }}"
~d2.organization = Default
~d2.state = present
~d2.credential_type = Microsoft Azure Resource Manager
~d2.inputs = 
~d3.username = joe
~d3.password = secret
~d3.subscription = some-subscription
~d1.register = result
~d1.when = azure_found
~d0.assert = 
~d2.that = 
~d1.when = azure_found
~d0.name = Create a valid AzureRM credential with a tenant
~d1.credential = 
~d2.name = "{{ azurerm_cred_name1 }}"
~d2.organization = Default
~d2.state = present
~d2.credential_type = Microsoft Azure Resource Manager
~d2.inputs = 
~d3.client = some-client
~d3.secret = some-secret
~d3.tenant = some-tenant
~d3.subscription = some-subscription
~d1.register = result
~d1.when = azure_found
~d0.assert = 
~d2.that = 
~d1.when = azure_found
~d0.name = Delete an AzureRM credential
~d1.credential = 
~d2.name = "{{ azurerm_cred_name1 }}"
~d2.organization = Default
~d2.state = absent
~d2.credential_type = Microsoft Azure Resource Manager
~d1.register = result
~d1.when = azure_found
~d0.assert = 
~d2.that = 
~d1.when = azure_found
~d0.name = Create a valid OpenStack credential
~d1.credential = 
~d2.name = "{{ openstack_cred_name1 }}"
~d2.organization = Default
~d2.state = present
~d2.credential_type = OpenStack
~d2.inputs = 
~d3.host = https://keystone.example.org
~d3.username = joe
~d3.password = secret
~d3.project = tenant123
~d3.domain = some-domain
~d1.register = result
~d1.when = openstack_found
~d0.assert = 
~d2.that = 
~d1.when = openstack_found
~d0.name = Delete a OpenStack credential
~d1.credential = 
~d2.name = "{{ openstack_cred_name1 }}"
~d2.organization = Default
~d2.state = absent
~d2.credential_type = OpenStack
~d1.register = result
~d1.when = openstack_found
~d0.assert = 
~d2.that = 
~d1.when = openstack_found
~d0.name = Create a valid RHV credential
~d1.credential = 
~d2.name = "{{ rhv_cred_name1 }}"
~d2.organization = Default
~d2.state = present
~d2.credential_type = Red Hat Virtualization
~d2.inputs = 
~d3.host = https://example.org
~d3.username = joe
~d3.password = secret
~d1.register = result
~d1.when = rhv_found
~d0.assert = 
~d2.that = 
~d1.when = rhv_found
~d0.name = Delete an RHV credential
~d1.credential = 
~d2.name = "{{ rhv_cred_name1 }}"
~d2.organization = Default
~d2.state = absent
~d2.credential_type = Red Hat Virtualization
~d1.register = result
~d1.when = rhv_found
~d0.assert = 
~d2.that = 
~d1.when = rhv_found
~d0.name = Create a valid Insights credential
~d1.credential = 
~d2.name = "{{ insights_cred_name1 }}"
~d2.organization = Default
~d2.state = present
~d2.credential_type = Insights
~d2.inputs = 
~d3.username = joe
~d3.password = secret
~d1.register = result
~d1.when = insights_found
~d0.assert = 
~d2.that = 
~d1.when = insights_found
~d0.name = Delete an Insights credential
~d1.credential = 
~d2.name = "{{ insights_cred_name1 }}"
~d2.organization = Default
~d2.state = absent
~d2.credential_type = Insights
~d1.register = result
~d1.when = insights_found
~d0.assert = 
~d2.that = 
~d1.when = insights_found
~d0.name = Create a valid Insights token credential
~d1.credential = 
~d2.name = "{{ insights_cred_name2 }}"
~d2.organization = Default
~d2.state = present
~d2.credential_type = Insights
~d2.inputs = 
~d3.client_id = joe
~d3.client_secret = secret
~d1.register = result
~d1.when = insights_found
~d0.assert = 
~d2.that = 
~d1.when = insights_found
~d0.name = Delete an Insights token credential
~d1.credential = 
~d2.name = "{{ insights_cred_name2 }}"
~d2.organization = Default
~d2.state = absent
~d2.credential_type = Insights
~d1.register = result
~d1.when = insights_found
~d0.assert = 
~d2.that = 
~d1.when = insights_found
~d0.name = Create a valid Tower-to-Tower credential
~d1.credential = 
~d2.name = "{{ tower_cred_name1 }}"
~d2.organization = Default
~d2.state = present
~d2.credential_type = Red Hat Ansible Automation Platform
~d2.inputs = 
~d3.host = https://controller.example.org
~d3.username = joe
~d3.password = secret
~d1.register = result
~d0.assert = 
~d2.that = 
~d0.name = Delete a Tower-to-Tower credential
~d1.credential = 
~d2.name = "{{ tower_cred_name1 }}"
~d2.organization = Default
~d2.state = absent
~d2.credential_type = Red Hat Ansible Automation Platform
~d1.register = result
~d0.assert = 
~d2.that = 
~d0.name = Check module fails with correct msg
~d1.credential = 
~d2.name = test-credential
~d2.description = Credential Description
~d2.credential_type = Machine
~d2.organization = test-non-existing-org
~d2.state = present
~d1.register = result
~d1.ignore_errors = yes
~d0.assert = 
~d2.that = 
