[0].name = Import custom Ansible plugins
[0]["ansible.builtin.import_role"].name = ansible_plugins
[1].name = Import DebOps global handlers
[1]["ansible.builtin.import_role"].name = global_handlers
[2].name = Create a fact that knows the Ansible connection type
[2]["ansible.builtin.set_fact"].unbound__fact_ansible_connection = {{ ansible_connection }}
[3].name = Create Unbound configuration directory
[3]["ansible.builtin.file"].path = /etc/unbound/unbound.conf.d
[3]["ansible.builtin.file"].state = directory
[3]["ansible.builtin.file"].owner = root
[3]["ansible.builtin.file"].group = root
[3]["ansible.builtin.file"].mode = 0755
[4].name = Remove Unbound server configuration
[4]["ansible.builtin.file"].path = /etc/unbound/unbound.conf.d/ansible-server.conf
[4]["ansible.builtin.file"].state = absent
[4].notify[0] = Check unbound configuration and reload
[4].when = not unbound__combined_server | d()
[5].name = Remove Unbound remote control configuration
[5]["ansible.builtin.file"].path = /etc/unbound/unbound.conf.d/ansible-remote-control.conf
[5]["ansible.builtin.file"].state = absent
[5].notify[0] = Check unbound configuration and reload
[5].when = not unbound__combined_remote_control | d()
[6].name = Generate Unbound server configuration
[6]["ansible.builtin.template"].src = etc/unbound/unbound.conf.d/ansible-server.conf.j2
[6]["ansible.builtin.template"].dest = /etc/unbound/unbound.conf.d/ansible-server.conf
[6]["ansible.builtin.template"].owner = root
[6]["ansible.builtin.template"].group = root
[6]["ansible.builtin.template"].mode = 0644
[6].notify[0] = Check unbound configuration and reload
[6].when = unbound__combined_server | d()
[7].name = Generate Unbound remote control configuration
[7]["ansible.builtin.template"].src = etc/unbound/unbound.conf.d/ansible-remote-control.conf.j2
[7]["ansible.builtin.template"].dest = /etc/unbound/unbound.conf.d/ansible-remote-control.conf
[7]["ansible.builtin.template"].owner = root
[7]["ansible.builtin.template"].group = root
[7]["ansible.builtin.template"].mode = 0644
[7].notify[0] = Check unbound configuration and reload
[7].when = unbound__combined_remote_control | d()
[8].name = Remove DNS zones if requested
[8]["ansible.builtin.file"].path = /etc/unbound/unbound.conf.d/zone_{{ item.name }}.conf
[8]["ansible.builtin.file"].state = absent
[8].loop = {{ q("flattened", unbound__parsed_zones) }}
[8].notify[0] = Check unbound configuration and reload
[8].when = item.name | d() and item.state | d('present') == 'absent'
[9].name = Configure DNS zones
[9]["ansible.builtin.template"].src = etc/unbound/unbound.conf.d/zone.conf.j2
[9]["ansible.builtin.template"].dest = /etc/unbound/unbound.conf.d/zone_{{ item.name }}.conf
[9]["ansible.builtin.template"].owner = root
[9]["ansible.builtin.template"].group = root
[9]["ansible.builtin.template"].mode = 0644
[9].loop = {{ q("flattened", unbound__parsed_zones) }}
[9].notify[0] = Check unbound configuration and reload
[9].when = item.name | d() and item.state | d('present') != 'absent'
[10].name = Install unbound APT packages
[10]["ansible.builtin.package"].name = {{ q("flattened", (unbound__base_packages
                              + unbound__packages)) }}
[10]["ansible.builtin.package"].state = present
[10].register = unbound__register_packages
[10].until = unbound__register_packages is succeeded
[11].name = Make sure that Ansible local facts directory exists
[11]["ansible.builtin.file"].path = /etc/ansible/facts.d
[11]["ansible.builtin.file"].state = directory
[11]["ansible.builtin.file"].owner = root
[11]["ansible.builtin.file"].group = root
[11]["ansible.builtin.file"].mode = 0755
[12].name = Save Unbound local facts
[12]["ansible.builtin.template"].src = etc/ansible/facts.d/unbound.fact.j2
[12]["ansible.builtin.template"].dest = /etc/ansible/facts.d/unbound.fact
[12]["ansible.builtin.template"].owner = root
[12]["ansible.builtin.template"].group = root
[12]["ansible.builtin.template"].mode = 0755
[12].notify[0] = Refresh host facts
[12].tags[0] = meta::facts
[13].name = Update Ansible facts if they were modified
[13]["ansible.builtin.meta"] = flush_handlers
