~d0.name = Import custom Ansible plugins
~d1.ansible.builtin.import_role = 
~d2.name = 'ansible_plugins'
~d0.name = Import DebOps global handlers
~d1.ansible.builtin.import_role = 
~d2.name = 'global_handlers'
~d0.name = Import DebOps secret role
~d1.ansible.builtin.import_role = 
~d2.name = 'secret'
~d0.name = Restart database server on first install (influx bug)
~d1.ansible.builtin.service = 
~d2.name = 'influxdb'
~d2.state = 'restarted'
~d1.when = not (ansible_local.influxdb_server.installed | d(false) | bool)
~d0.name = Wait for HTTP endpoint port to become open on the host on first install
~d1.ansible.builtin.wait_for = 
~d2.port = '{{ influxdb_server__port }}'
~d1.when = not (ansible_local.influxdb_server.installed | d(false) | bool)
~d0.name = Create default admin user on first install
~d1.community.general.influxdb_user = 
~d2.user_name = 'root'
~d2.user_password = '{{ influxdb_server__root_password }}'
~d2.state = 'present'
~d2.admin = 'yes'
~d2.proxies = 
~d3.http = 
~d3.https = 
~d1.when = not (ansible_local.influxdb_server.installed | d(false) | bool)
~d1.no_log = '{{ debops__no_log | d(True) }}'
~d0.name = Stop database server on first install
~d1.ansible.builtin.service = 
~d2.name = 'influxdb'
~d2.state = 'stopped'
~d1.when = not (ansible_local.influxdb_server.installed | d(false) | bool)
~d0.name = Add InfluxDB server user to specified groups
~d1.ansible.builtin.user = 
~d2.name = 'influxdb'
~d2.groups = '{{ influxdb_server__append_groups | join(",") | default(omit) }}'
~d2.append = True
~d2.createhome = False
~d1.when = influxdb_server__pki | bool
~d0.name = Ensure InfluxDB server directory exists
~d1.ansible.builtin.file = 
~d2.path = '{{ influxdb_server__directory }}'
~d2.state = 'directory'
~d2.owner = 'influxdb'
~d2.group = 'influxdb'
~d2.mode = '0750'
~d0.name = Move InfluxDB data files to data directory
~d1.ansible.builtin.shell = 
~d1.register = influxdb_server__register_move
~d1.changed_when = influxdb_server__register_move.changed | bool
~d1.when = (not (ansible_local.influxdb_server.installed | d(false) | bool) and
~d0.name = Divert the original influxdb configuration file
~d1.debops.debops.dpkg_divert = 
~d2.path = '/etc/influxdb/influxdb.conf'
~d2.state = 'present'
~d2.delete = True
~d1.tags = [ 'role::influxdb_server:config' ]
~d0.name = Configure InfluxDB server
~d1.ansible.builtin.template = 
~d2.src = 'etc/influxdb/influxdb.conf.j2'
~d2.dest = '/etc/influxdb/influxdb.conf'
~d2.owner = 'root'
~d2.group = 'root'
~d2.mode = '0644'
~d1.tags = [ 'role::influxdb_server:config' ]
~d1.notify = [ 'Restart influxdb' ]
~d0.name = Start database server on first install
~d1.ansible.builtin.service = 
~d2.name = 'influxdb'
~d2.state = 'started'
~d1.when = not (ansible_local.influxdb_server.installed | d(false) | bool)
~d0.name = Configure autoinfluxdbbackup
~d1.ansible.builtin.include_tasks = 'autoinfluxdbbackup.yml'
~d1.when = influxdb_server__backup | bool
~d1.tags = [ 'role::influxdb_server:autoinfluxdbbackup' ]
~d0.name = Make sure that Ansible local facts directory exists
~d1.ansible.builtin.file = 
~d2.path = '/etc/ansible/facts.d'
~d2.state = 'directory'
~d2.mode = '0755'
~d0.name = Save InfluxDB server local facts
~d1.ansible.builtin.template = 
~d2.src = 'etc/ansible/facts.d/influxdb_server.fact.j2'
~d2.dest = '/etc/ansible/facts.d/influxdb_server.fact'
~d2.owner = 'root'
~d2.group = 'root'
~d2.mode = '0755'
~d1.notify = [ 'Refresh host facts' ]
~d1.tags = [ 'meta::facts' ]
~d0.name = Save InfluxDB local facts
~d1.ansible.builtin.template = 
~d2.src = 'etc/ansible/facts.d/influxdb.fact.j2'
~d2.dest = '/etc/ansible/facts.d/influxdb.fact'
~d2.owner = 'root'
~d2.group = 'root'
~d2.mode = '0644'
~d1.notify = [ 'Refresh host facts' ]
~d0.name = Re-read local facts if they have been modified
~d1.ansible.builtin.meta = 'flush_handlers'
