[0].name = Import DebOps global handlers
[0]["ansible.builtin.import_role"].name = global_handlers
[1].name = Import DebOps secret role
[1]["ansible.builtin.import_role"].name = secret
[2].name = Check if database server is installed
[2].environment.LC_MESSAGES = C
[2]["ansible.builtin.shell"] = set -o nounset -o pipefail -o errexit && dpkg-query -W -f='${Version}\n' 'influxdb' | grep -v '^$'
[2].args.executable = bash
[2].register = influxdb__register_version
[2].changed_when = False
[2].failed_when = False
[2].check_mode = False
[3].name = Override configuration if local server is detected
[3]["ansible.builtin.set_fact"].influxdb__server = {{ ansible_fqdn if influxdb__pki else "localhost" }}
[3].when = (influxdb__register_version.stdout | d(False))
[4].name = Make sure that local fact directory exists
[4]["ansible.builtin.file"].dest = /etc/ansible/facts.d
[4]["ansible.builtin.file"].state = directory
[4]["ansible.builtin.file"].owner = root
[4]["ansible.builtin.file"].group = root
[4]["ansible.builtin.file"].mode = 0755
[5].name = Save InfluxDB local facts
[5]["ansible.builtin.template"].src = etc/ansible/facts.d/influxdb.fact.j2
[5]["ansible.builtin.template"].dest = /etc/ansible/facts.d/influxdb.fact
[5]["ansible.builtin.template"].owner = root
[5]["ansible.builtin.template"].group = root
[5]["ansible.builtin.template"].mode = 0644
[5].notify[0] = Refresh host facts
[5].tags[0] = meta::facts
[6].name = Re-read local facts if they have been modified
[6]["ansible.builtin.meta"] = flush_handlers
[7].name = Manage database contents
[7]["ansible.builtin.include_tasks"] = manage_contents.yml
[7].when = (influxdb__server | d(False) and influxdb__delegate_to)
[7].tags[0] = role::influxdb:contents
