[0].name = Generate a test ID
[0].set_fact.test_id = {{ lookup('password', '/dev/null chars=ascii_letters length=16') }}
[0].when = test_id is not defined
[1].name = Generate names
[1].set_fact.project_name = AWX-Collection-tests-inventory_source_update-project-{{ test_id }}
[1].set_fact.inv_name = AWX-Collection-tests-inventory_source_update-inv-{{ test_id }}
[1].set_fact.inv_source1 = AWX-Collection-tests-inventory_source_update-source1-{{ test_id }}
[1].set_fact.inv_source2 = AWX-Collection-tests-inventory_source_update-source2-{{ test_id }}
[1].set_fact.inv_source3 = AWX-Collection-tests-inventory_source_update-source3-{{ test_id }}
[1].set_fact.org_name = AWX-Collection-tests-inventory_source_update-org-{{ test_id }}
[2].block[0].name = Create a new organization
[2].block[0].organization.name = {{ org_name }}
[2].block[0].register = created_org
[2].block[1].name = Create a git project without credentials
[2].block[1].project.name = {{ project_name }}
[2].block[1].project.organization = {{ org_name }}
[2].block[1].project.scm_type = git
[2].block[1].project.scm_url = https://github.com/ansible/ansible-tower-samples
[2].block[1].project.wait = true
[2].block[2].name = Create a git project with same name, different org
[2].block[2].project.name = {{ project_name }}
[2].block[2].project.organization = Default
[2].block[2].project.scm_type = git
[2].block[2].project.scm_url = https://github.com/ansible/test-playbooks
[2].block[2].project.wait = true
[2].block[3].name = Create an Inventory
[2].block[3].inventory.name = {{ inv_name }}
[2].block[3].inventory.organization = {{ org_name }}
[2].block[3].inventory.state = present
[2].block[4].name = Create another inventory w/ same name, different org
[2].block[4].inventory.name = {{ inv_name }}
[2].block[4].inventory.organization = Default
[2].block[4].inventory.state = present
[2].block[4].register = created_inventory
[2].block[5].name = Create an Inventory Source (specifically connected to the randomly generated org)
[2].block[5].inventory_source.name = {{ inv_source1 }}
[2].block[5].inventory_source.source = scm
[2].block[5].inventory_source.source_project = {{ project_name }}
[2].block[5].inventory_source.source_path = inventories/inventory.ini
[2].block[5].inventory_source.description = Source for Test inventory
[2].block[5].inventory_source.organization = {{ created_org.id }}
[2].block[5].inventory_source.inventory = {{ inv_name }}
[2].block[6].name = Create Another Inventory Source
[2].block[6].inventory_source.name = {{ inv_source2 }}
[2].block[6].inventory_source.source = scm
[2].block[6].inventory_source.source_project = {{ project_name }}
[2].block[6].inventory_source.source_path = inventories/create_10_hosts.ini
[2].block[6].inventory_source.description = Source for Test inventory
[2].block[6].inventory_source.organization = Default
[2].block[6].inventory_source.inventory = {{ inv_name }}
[2].block[7].name = Create Yet Another Inventory Source (to make lookup plugin find multiple inv sources)
[2].block[7].inventory_source.name = {{ inv_source3 }}
[2].block[7].inventory_source.source = scm
[2].block[7].inventory_source.source_project = {{ project_name }}
[2].block[7].inventory_source.source_path = inventories/create_100_hosts.ini
[2].block[7].inventory_source.description = Source for Test inventory
[2].block[7].inventory_source.organization = Default
[2].block[7].inventory_source.inventory = {{ inv_name }}
[2].block[8].name = Test Inventory Source Update
[2].block[8].inventory_source_update.name = {{ inv_source2 }}
[2].block[8].inventory_source_update.inventory = {{ inv_name }}
[2].block[8].inventory_source_update.organization = Default
[2].block[8].register = result
[2].block[9].assert.that[0] = result is changed
[2].block[10].name = Test Inventory Source Update for All Sources
[2].block[10].inventory_source_update.name = {{ item.name }}
[2].block[10].inventory_source_update.inventory = {{ inv_name }}
[2].block[10].inventory_source_update.organization = Default
[2].block[10].inventory_source_update.wait = true
[2].block[10].loop = {{ query('awx.awx.controller_api', 'inventory_sources', query_params={ 'inventory': created_inventory.id }, expect_objects=True, return_objects=True) }}
[2].block[10].loop_control.label = {{ item.name }}
[2].block[10].register = result
[2].block[11].assert.that[0] = result is changed
[2].block[12].name = Test Inventory Source Update for All Sources (using inventory_source as alias for name)
[2].block[12].inventory_source_update.inventory_source = {{ item.name }}
[2].block[12].inventory_source_update.inventory = {{ inv_name }}
[2].block[12].inventory_source_update.organization = Default
[2].block[12].inventory_source_update.wait = true
[2].block[12].loop = {{ query('awx.awx.controller_api', 'inventory_sources', query_params={ 'inventory': created_inventory.id }, expect_objects=True, return_objects=True) }}
[2].block[12].loop_control.label = {{ item.name }}
[2].block[12].register = result
[2].block[13].assert.that[0] = result is changed
[2].block[14].name = Attempt to delete an inventory source from an inventory that does not exist
[2].block[14].inventory_source.name = {{ inv_source3 }}
[2].block[14].inventory_source.source = scm
[2].block[14].inventory_source.state = absent
[2].block[14].inventory_source.source_project = {{ project_name }}
[2].block[14].inventory_source.source_path = inventories/create_100_hosts.ini
[2].block[14].inventory_source.description = Source for Test inventory
[2].block[14].inventory_source.organization = Default
[2].block[14].inventory_source.inventory = Does not exist
[2].block[14].register = result
[2].block[15].assert.that[0] = result is not changed
[2].always[0].name = Delete Inventory
[2].always[0].inventory.name = {{ inv_name }}
[2].always[0].inventory.organization = Default
[2].always[0].inventory.state = absent
[2].always[1].name = Delete Project
[2].always[1].project.name = {{ project_name }}
[2].always[1].project.organization = Default
[2].always[1].project.state = absent
[2].always[2].name = Remove the organization
[2].always[2].organization.name = {{ org_name }}
[2].always[2].organization.state = absent
