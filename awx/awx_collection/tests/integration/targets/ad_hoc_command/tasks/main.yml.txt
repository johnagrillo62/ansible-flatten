[0].name = Generate a random string for test
[0].set_fact.test_id = {{ lookup('password', '/dev/null chars=ascii_letters length=16') }}
[0].when = test_id is not defined
[1].name = Generate names
[1].set_fact.inv_name = AWX-Collection-tests-ad_hoc_command-inventory-{{ test_id }}
[1].set_fact.ssh_cred_name = AWX-Collection-tests-ad_hoc_command-ssh-cred-{{ test_id }}
[1].set_fact.org_name = AWX-Collection-tests-ad_hoc_command-org-{{ test_id }}
[1].set_fact.ee_name = AWX-Collection-tests-ad_hoc_command-ee-{{ test_id }}
[2].name = Create a New Organization
[2].organization.name = {{ org_name }}
[3].name = Create an Inventory
[3].inventory.name = {{ inv_name }}
[3].inventory.organization = {{ org_name }}
[3].inventory.state = present
[4].name = Add localhost to the Inventory
[4].host.name = localhost
[4].host.inventory = {{ inv_name }}
[4].host.variables.ansible_connection = local
[5].name = Create a Credential
[5].credential.name = {{ ssh_cred_name }}
[5].credential.organization = {{ org_name }}
[5].credential.credential_type = Machine
[5].credential.state = present
[6].name = Create an Execution Environment
[6].execution_environment.name = {{ ee_name }}
[6].execution_environment.organization = {{ org_name }}
[6].execution_environment.description = EE for Testing
[6].execution_environment.image = quay.io/ansible/awx-ee
[6].execution_environment.pull = always
[6].execution_environment.state = present
[6].register = result_ee
[7].name = Launch an Ad Hoc Command waiting for it to finish
[7].ad_hoc_command.inventory = {{ inv_name }}
[7].ad_hoc_command.credential = {{ ssh_cred_name }}
[7].ad_hoc_command.module_name = command
[7].ad_hoc_command.module_args = echo I <3 Ansible
[7].ad_hoc_command.wait = true
[7].register = result
[8].assert.that[0] = result is changed
[8].assert.that[1] = result.status == 'successful'
[9].name = Launch an Ad Hoc Command without module argument
[9].ad_hoc_command.inventory = Demo Inventory
[9].ad_hoc_command.credential = {{ ssh_cred_name }}
[9].ad_hoc_command.module_name = ping
[9].ad_hoc_command.wait = true
[9].register = result
[10].assert.that[0] = result is changed
[10].assert.that[1] = result.status == 'successful'
[11].name = Launch an Ad Hoc Command with extra_vars
[11].ad_hoc_command.inventory = Demo Inventory
[11].ad_hoc_command.credential = {{ ssh_cred_name }}
[11].ad_hoc_command.module_name = ping
[11].ad_hoc_command.extra_vars.var1 = test var
[11].ad_hoc_command.wait = true
[11].register = result
[12].assert.that[0] = result is changed
[12].assert.that[1] = result.status == 'successful'
[13].name = Launch an Ad Hoc Command with Execution Environment specified
[13].ad_hoc_command.inventory = Demo Inventory
[13].ad_hoc_command.credential = {{ ssh_cred_name }}
[13].ad_hoc_command.execution_environment = {{ ee_name }}
[13].ad_hoc_command.module_name = ping
[13].ad_hoc_command.wait = true
[13].register = result
[14].assert.that[0] = result is changed
[14].assert.that[1] = result.status == 'successful'
[14].assert.that[2] = lookup('awx.awx.controller_api', 'ad_hoc_commands/' ~  result.id)['execution_environment'] == result_ee.id
[15].name = Check module fails with correct msg
[15].ad_hoc_command.inventory = {{ inv_name }}
[15].ad_hoc_command.credential = {{ ssh_cred_name }}
[15].ad_hoc_command.module_name = Does not exist
[15].register = result
[15].ignore_errors = yes
[16].assert.that[0] = result is failed
[16].assert.that[1] = result is not changed
[16].assert.that[2] = 'Does not exist' in result.response['json']['module_name'][0]
[17].name = Delete the Execution Environment
[17].execution_environment.name = {{ ee_name }}
[17].execution_environment.organization = {{ org_name }}
[17].execution_environment.image = quay.io/ansible/awx-ee
[17].execution_environment.state = absent
[18].name = Delete the Credential
[18].credential.name = {{ ssh_cred_name }}
[18].credential.organization = {{ org_name }}
[18].credential.credential_type = Machine
[18].credential.state = absent
[19].name = Delete the Inventory
[19].inventory.name = {{ inv_name }}
[19].inventory.organization = {{ org_name }}
[19].inventory.state = absent
[20].name = Remove the Organization
[20].organization.name = {{ org_name }}
[20].organization.state = absent
