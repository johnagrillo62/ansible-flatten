[0].name = Install cgit dependencies
[0].apt = pkg={{ item }} state=present
[0].with_items[0] = groff
[0].with_items[1] = libssl-dev
[0].with_items[2] = python3-pip
[0].tags[0] = dependencies
[1].name = Install cgit pip dependencies python 3
[1].pip.name = {{ item }}
[1].pip.executable = pip3
[1].with_items[0] = docutils
[1].with_items[1] = pygments
[1].with_items[2] = markdown
[2].name = Download cgit release
[2].get_url = url=http://git.zx2c4.com/cgit/snapshot/cgit-{{ cgit_version }}.tar.xz dest=/root/cgit-{{ cgit_version }}.tar.xz
[3].name = Decompress cgit source
[3].unarchive = src=/root/cgit-{{ cgit_version }}.tar.xz dest=/root copy=no creates=/root/cgit-{{ cgit_version }}/configure
[4].name = Build and install cgit
[4].shell = make get-git ; make ; make install executable=/bin/bash chdir=/root/cgit-{{ cgit_version }} creates=/var/www/htdocs/cgit/cgit.cgi
[5].name = Copy cgitrc
[5].template = src=etc_cgitrc.j2 dest=/etc/cgitrc group=www-data owner=root
[6].name = Rename existing Apache cgit virtualhost
[6].command = mv /etc/apache2/sites-available/cgit /etc/apache2/sites-available/cgit.conf removes=/etc/apache2/sites-available/cgit
[7].name = Remove old sites-enabled/cgit symlink (new one will be created by a2ensite)
[7].file = path=/etc/apache2/sites-enabled/cgit state=absent
[8].name = Configure the Apache HTTP server for cgit
[8].template = src=etc_apache2_sites-available_cgit.j2 dest=/etc/apache2/sites-available/cgit.conf group=root owner=root
[9].name = Enable Apache CGI module
[9].command = a2enmod cgi creates=/etc/apache2/mods-enabled/cgi.load
[9].notify = restart apache
[10].name = Enable Apache rewrite module
[10].command = a2enmod rewrite creates=/etc/apache2/mods-enabled/rewrite.load
[10].notify = restart apache
[11].name = Enable cgit site
[11].command = a2ensite cgit.conf creates=/etc/apache2/sites-enabled/cgit.conf
[11].notify = restart apache
