[0].name = Ensure specified packages are in there desired state
[0]["ansible.builtin.package"].name = {{ q("flattened", (dropbear_initramfs__base_packages
                              + dropbear_initramfs__packages)) }}
[0]["ansible.builtin.package"].state = {{ "present" if (dropbear_initramfs__deploy_state == "present") else "absent" }}
[0].register = dropbear_initramfs__register_packages
[0].until = dropbear_initramfs__register_packages is succeeded
[0].tags[0] = role::dropbear_initramfs:pkgs
[1].name = Configure network in initramfs using kernel command line
[1]["ansible.builtin.template"].src = etc/initramfs-tools/conf.d/role.conf.j2
[1]["ansible.builtin.template"].dest = /etc/initramfs-tools/conf.d/50_debops.dropbear_initramfs.conf
[1]["ansible.builtin.template"].mode = 0644
[1].when = (dropbear_initramfs__deploy_state == "present")
[1].notify[0] = Update initramfs
[2].name = Configure dropbear options
[2]["ansible.builtin.template"].src = etc/dropbear/initramfs/dropbear.conf.j2
[2]["ansible.builtin.template"].dest = {{ dropbear_initramfs__config_file }}
[2]["ansible.builtin.template"].mode = 0644
[2].when = (dropbear_initramfs__deploy_state == "present")
[2].notify[0] = Update initramfs
[3].name = Configure to bring up additional interfaces/addresses in initramfs
[3]["ansible.builtin.template"].src = etc/initramfs-tools/scripts/local-top/debops_dropbear_initramfs.j2
[3]["ansible.builtin.template"].dest = /etc/initramfs-tools/scripts/local-top/debops_dropbear_initramfs
[3]["ansible.builtin.template"].mode = 0755
[3].when = (dropbear_initramfs__deploy_state == "present")
[3].notify[0] = Update initramfs
[4].name = Configure to bring down additional interfaces/addresses in initramfs
[4]["ansible.builtin.template"].src = etc/initramfs-tools/scripts/local-bottom/debops_dropbear_initramfs.j2
[4]["ansible.builtin.template"].dest = /etc/initramfs-tools/scripts/local-bottom/debops_dropbear_initramfs
[4]["ansible.builtin.template"].mode = 0755
[4].when = (dropbear_initramfs__deploy_state == "present")
[4].notify[0] = Update initramfs
[5].name = Configure authorized ssh keys
[5]["ansible.posix.authorized_key"].key = {{ (item.key
              if item.key is string
              else (item.key | unique | join('\n') | string))
             if item.key | d() else '' }}
[5]["ansible.posix.authorized_key"].user = {{ item.user | d("root") }}
[5]["ansible.posix.authorized_key"].path = {{ "/etc/initramfs-tools/root/.ssh/authorized_keys"
              if ("dropbear" in dropbear_initramfs__base_packages)
              else dropbear_initramfs__config_path + "/authorized_keys" }}
[5]["ansible.posix.authorized_key"].key_options = {{ (item.key_options if item.key_options is string else item.key_options | join(","))
                       if item.key_options is defined
                       else ((dropbear_initramfs__authorized_keys_key_options
                              if dropbear_initramfs__authorized_keys_key_options is string
                              else dropbear_initramfs__authorized_keys_key_options | join(","))
                             if dropbear_initramfs__authorized_keys_key_options != omit else "")
                     }}
[5]["ansible.posix.authorized_key"].state = {{ (item.state | d("present")) if (dropbear_initramfs__deploy_state == "present") else "absent" }}
[5]["ansible.posix.authorized_key"].exclusive = {{ item.exclusive | d(omit) }}
[5]["ansible.posix.authorized_key"].comment = {{ item.comment | d(omit) }}
[5]["ansible.posix.authorized_key"].manage_dir = False
[5].notify[0] = Update initramfs
[5].loop = {{ q("flattened", dropbear_initramfs__combined_authorized_keys) }}
[5].loop_control.label = {{ {"key": item.key} }}
[6].name = Remove files in deploy state absent
[6]["ansible.builtin.file"].path = {{ item }}
[6]["ansible.builtin.file"].state = absent
[6].when = (dropbear_initramfs__deploy_state == 'absent')
[6].notify[0] = Update initramfs
[6].with_items[0] = /etc/initramfs-tools/conf.d/50_debops.dropbear_initramfs.conf
[6].with_items[1] = /etc/initramfs-tools/scripts/local-top/debops_dropbear_initramfs
[6].with_items[2] = /etc/initramfs-tools/scripts/local-bottom/debops_dropbear_initramfs
