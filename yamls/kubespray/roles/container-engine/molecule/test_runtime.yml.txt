[0].name = Test container runtime
[0].hosts = all
[0].gather_facts = false
[0].become = true
[0].roles[0].role = ../../kubespray_defaults
[0].tasks[0].name = Copy test container files
[0].tasks[0].template.src = {{ item }}.j2
[0].tasks[0].template.dest = /tmp/{{ item }}
[0].tasks[0].template.owner = root
[0].tasks[0].template.mode = 0644
[0].tasks[0].loop[0] = container.json
[0].tasks[0].loop[1] = sandbox.json
[0].tasks[1].name = Check running a container with runtime {{ container_runtime }}
[0].tasks[1].block[0].name = Run container
[0].tasks[1].block[0].command.argv[0] = {{ bin_dir }}/crictl
[0].tasks[1].block[0].command.argv[1] = run
[0].tasks[1].block[0].command.argv[2] = --with-pull
[0].tasks[1].block[0].command.argv[3] = --runtime
[0].tasks[1].block[0].command.argv[4] = {{ container_runtime }}
[0].tasks[1].block[0].command.argv[5] = /tmp/container.json
[0].tasks[1].block[0].command.argv[6] = /tmp/sandbox.json
[0].tasks[1].block[1].name = Check log file
[0].tasks[1].block[1].slurp.src = /tmp/{{ container_runtime }}1.0.log
[0].tasks[1].block[1].register = log_file
[0].tasks[1].block[1].failed_when = log_file is failed or 'Hello from Docker' not in (log_file.content | b64decode)

[0].tasks[1].rescue[0].name = Display container manager config on error
[0].tasks[1].rescue[0].command = {{ bin_dir }}/crictl info
[0].tasks[1].rescue[1].name = Check container manager logs
[0].tasks[1].rescue[1].command = journalctl -u {{ container_manager }}
[0].tasks[1].rescue[1].failed_when = true
