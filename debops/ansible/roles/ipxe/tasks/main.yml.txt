[0].name = Import custom Ansible plugins
[0]["ansible.builtin.import_role"].name = ansible_plugins
[1].name = Install required packages
[1]["ansible.builtin.package"].name = {{ q("flattened", (ipxe__base_packages + ipxe__packages)) }}
[1]["ansible.builtin.package"].state = present
[1].register = ipxe__register_packages
[1].until = ipxe__register_packages is succeeded
[2].name = Ensure that iPXE script directories exist
[2]["ansible.builtin.file"].path = {{ ipxe__tftp_root + "/" + (((item.name | regex_replace("\.ipxe$", "")) + ".ipxe") | dirname) }}
[2]["ansible.builtin.file"].state = directory
[2]["ansible.builtin.file"].mode = 0755
[2].loop = {{ ipxe__combined_scripts | debops.debops.parse_kv_items }}
[2].loop_control.label = {{ {"name": item.name,
                "path": (ipxe__tftp_root + "/" + ((item.name | regex_replace("\.ipxe$", "") + ".ipxe") | dirname)),
                "state": item.state | d("present")} }}
[2].when = item.name | d() and item.state | d('present') not in ['absent', 'ignore', 'init']
[3].name = Generate iPXE scripts
[3]["ansible.builtin.template"].src = srv/tftp/template.ipxe.j2
[3]["ansible.builtin.template"].dest = {{ ipxe__tftp_root + "/" + (item.name | regex_replace("\.ipxe$", "")) + ".ipxe" }}
[3]["ansible.builtin.template"].mode = 0644
[3].loop = {{ ipxe__combined_scripts | debops.debops.parse_kv_items }}
[3].loop_control.label = {{ {"name": item.name,
                "state": item.state | d("present")} }}
[3].when = item.name | d() and item.state | d('present') not in ['absent', 'ignore', 'init']
[4].name = Remove iPXE scripts if requested
[4]["ansible.builtin.file"].path = {{ ipxe__tftp_root + "/" + (item.name | regex_replace("\.ipxe$", "")) + ".ipxe" }}
[4]["ansible.builtin.file"].state = absent
[4].loop = {{ ipxe__combined_scripts | debops.debops.parse_kv_items }}
[4].loop_control.label = {{ {"name": item.name,
                "state": item.state | d("present")} }}
[4].when = item.name | d() and item.state | d('present') == 'absent'
[5].name = Install bootloader files in the TFTP root directory
[5]["ansible.builtin.copy"].src = {{ item }}
[5]["ansible.builtin.copy"].dest = {{ ipxe__tftp_root + "/" + (item | basename) }}
[5]["ansible.builtin.copy"].remote_src = True
[5]["ansible.builtin.copy"].mode = 0644
[5].loop = {{ ipxe__bootloaders }}
[6].name = Configure Debian netboot installers
[6]["ansible.builtin.include_tasks"] = debian_netboot.yml
[6].when = ipxe__debian_netboot_enabled | bool
[7].name = Make sure that Ansible local facts directory exists
[7]["ansible.builtin.file"].path = /etc/ansible/facts.d
[7]["ansible.builtin.file"].state = directory
[7]["ansible.builtin.file"].mode = 0755
[8].name = Save iPXE local facts
[8]["ansible.builtin.template"].src = etc/ansible/facts.d/ipxe.fact.j2
[8]["ansible.builtin.template"].dest = /etc/ansible/facts.d/ipxe.fact
[8]["ansible.builtin.template"].mode = 0755
[8].tags[0] = meta::facts
