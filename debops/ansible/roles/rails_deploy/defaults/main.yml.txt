rails_deploy_dependencies[0] = database
rails_deploy_dependencies[1] = redis
rails_deploy_dependencies[2] = nginx
rails_deploy_dependencies[3] = ruby
rails_deploy_dependencies[4] = monit
rails_deploy_packages[0] = {{ rails_deploy_database_package }}
rails_deploy_user_sshkey = {{ lookup('file', '~/.ssh/id_rsa.pub') }}
rails_deploy_hosts_group = debops_rails_deploy
rails_deploy_hosts_master = {{ groups[rails_deploy_hosts_group][0] }}
rails_deploy_git_location = 
rails_deploy_git_version = master
rails_deploy_git_remote = origin
rails_deploy_git_access_token = False
rails_deploy_service = {{ rails_deploy_git_location | basename | replace('.git', '') }}
rails_deploy_home = /var/local/{{ rails_deploy_service }}
rails_deploy_src = {{ rails_deploy_home }}/{{ rails_deploy_nginx_domains[0] }}/{{ rails_deploy_service }}/src
rails_deploy_system_env = production
rails_deploy_bundle_without[0] = development
rails_deploy_bundle_without[1] = staging
rails_deploy_bundle_without[2] = production
rails_deploy_bundle_without[3] = test
rails_deploy_service_timeout = 60
rails_deploy_backend = unicorn
rails_deploy_backend_bind = {{ rails_deploy_service_socket }}
rails_deploy_backend_state = started
rails_deploy_backend_enabled = True
rails_deploy_backend_always_restart = False
rails_deploy_database_create = True
rails_deploy_database_prepare = True
rails_deploy_database_migrate = True
rails_deploy_database_force_migrate = False
rails_deploy_database_adapter = postgresql
rails_deploy_postgresql_cluster = 9.1/main
rails_deploy_database_host = {{ ansible_fqdn }}
rails_deploy_database_port = 5432
rails_deploy_postgresql_super_username = postgres
rails_deploy_mysql_super_username = mysql
rails_deploy_database_user_role_attrs = 
rails_deploy_database_pool = 25
rails_deploy_database_timeout = 5000
rails_deploy_worker_enabled = False
rails_deploy_worker_state = started
rails_deploy_worker = sidekiq
rails_deploy_worker_host = {{ ansible_fqdn }}
rails_deploy_worker_port = 6379
rails_deploy_worker_url = redis://{{ rails_deploy_worker_host }}:{{ rails_deploy_worker_port }}/0
rails_deploy_post_migrate_shell_commands[0] = bundle exec rake assets:precompile
rails_deploy_post_migrate_shell_commands[1] = rm -rf tmp/cache
rails_deploy_logrotate_interval = weekly
rails_deploy_logrotate_rotation = 24
rails_deploy_default_env.RAILS_ENV = {{ rails_deploy_system_env }}
rails_deploy_default_env.DATABASE_URL = {{ rails_deploy_database_adapter }}://{{ rails_deploy_service }}:{{ rails_deploy_database_user_password }}@{{ rails_deploy_database_host }}:{{ rails_deploy_database_port }}/{{ rails_deploy_service }}_{{ rails_deploy_system_env }}?pool={{ rails_deploy_database_pool }}&timeout={{ rails_deploy_database_timeout }}
rails_deploy_default_env.SERVICE = {{ rails_deploy_service }}
rails_deploy_default_env.LOG_FILE = {{ rails_deploy_log }}/{{ rails_deploy_service }}.log
rails_deploy_default_env.RUN_STATE_PATH = {{ rails_deploy_run }}
rails_deploy_default_env.LISTEN_ON = {{ rails_deploy_backend_bind }}
rails_deploy_default_env.THREADS_MIN = 0
rails_deploy_default_env.THREADS_MAX = 16
rails_deploy_default_env.WORKERS = 2
rails_deploy_default_env.BACKGROUND_URL = {{ rails_deploy_worker_url }}
rails_deploy_default_env.BACKGROUND_THREADS = {{ rails_deploy_database_pool }}
rails_deploy_nginx_server_enabled = True
rails_deploy_nginx_domains[0] = {{ ansible_fqdn }}
rails_deploy_nginx_upstream.enabled = {{ rails_deploy_nginx_server_enabled }}
rails_deploy_nginx_upstream.name = {{ rails_deploy_service }}
rails_deploy_nginx_upstream.server = {{ 'unix:' + rails_deploy_backend_bind if not ':' in rails_deploy_backend_bind else rails_deploy_backend_bind }}
rails_deploy_nginx_server.enabled = {{ rails_deploy_nginx_server_enabled }}
rails_deploy_nginx_server.name = {{ rails_deploy_nginx_domains }}
rails_deploy_nginx_server.root = {{ rails_deploy_src }}/public
rails_deploy_nginx_server.webroot_create = False
rails_deploy_nginx_server.error_pages.404 = /404.html
rails_deploy_nginx_server.error_pages.422 = /422.html
rails_deploy_nginx_server.error_pages.500 = /500.html
rails_deploy_nginx_server.error_pages["502 503 504"] = /502.html
rails_deploy_nginx_server.location_list[0].pattern = /
rails_deploy_nginx_server.location_list[0].options = try_files $uri $uri/index.html $uri.html @{{ rails_deploy_nginx_upstream.name }};

rails_deploy_nginx_server.location_list[1].pattern = ~ ^/(assets|system)/
rails_deploy_nginx_server.location_list[1].options = gzip_static on;
expires max;
add_header Cache-Control public;
add_header Last-Modified "";
add_header ETag "";

rails_deploy_nginx_server.location_list[2].pattern = @{{ rails_deploy_nginx_upstream.name }}
rails_deploy_nginx_server.location_list[2].options = gzip off;
proxy_set_header   X-Forwarded-Proto $scheme;
proxy_set_header   Host              $http_host;
proxy_set_header   X-Real-IP         $remote_addr;
proxy_set_header   X-Forwarded-For   $proxy_add_x_forwarded_for;
proxy_redirect     off;
proxy_pass         http://{{ rails_deploy_nginx_upstream.name }};

