[0].name = Installs necessary packages
[0].apt.pkg[0] = apache2
[0].apt.pkg[1] = libapache2-mod-php
[0].apt.pkg[2] = git
[0].apt.state = latest
[0].apt.update_cache = true
[0].tags[0] = apache
[1].name = Push future default virtual host configuration
[1].copy.src = files/awesome-app
[1].copy.dest = /etc/apache2/sites-available/awesome-app.conf
[1].copy.mode = 0640
[2].name = Activates our virtualhost
[2].command = a2ensite awesome-app
[3].name = Check that our config is valid
[3].command = apache2ctl configtest
[3].register = result
[3].ignore_errors = true
[4].name = Rolling back - Restoring old default virtualhost
[4].command = a2ensite 000-default
[4].when = result is failed
[5].name = Rolling back - Removing out virtualhost
[5].command = a2dissite awesome-app
[5].when = result is failed
[6].name = Rolling back - Ending playbook
[6].fail.msg = Configuration file is not valid. Please check that before re-running the playbook.
[6].when = result is failed
[7].name = Deploy our awesome application
[7].git.repo = https://github.com/leucos/ansible-tuto-demosite.git
[7].git.dest = /var/www/awesome-app
[7].tags = deploy
[8].name = Deactivates the default virtualhost
[8].command = a2dissite 000-default
[9].name = Deactivates the default ssl virtualhost
[9].command = a2dissite default-ssl
[9].notify[0] = restart apache
