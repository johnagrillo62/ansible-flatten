[0].name = Import DebOps global handlers
[0]["ansible.builtin.import_role"].name = global_handlers
[1].name = Import DebOps secret role
[1]["ansible.builtin.import_role"].name = secret
[2].name = Check if database server is installed
[2].environment.LC_MESSAGES = C
[2]["ansible.builtin.shell"] = set -o nounset -o pipefail -o errexit && dpkg-query -W -f='${Version}\n' 'mariadb-server' 'mysql-server' 'percona-server-server' 'mysql-wsrep-server-5.6' | grep -v '^$'
[2].args.executable = bash
[2].register = mariadb_server__register_version
[2].check_mode = False
[2].changed_when = False
[2].failed_when = False
[3].name = Install database server packages
[3]["ansible.builtin.package"].name = {{ q("flattened", (mariadb_server__base_packages
                              + mariadb_server__packages_map[mariadb_server__flavor]
                              + mariadb_server__packages
                              + (["automysqlbackup"]
                                 if mariadb_server__backup | bool
                                 else []))) }}
[3]["ansible.builtin.package"].state = present
[3].register = mariadb_server__register_install_status
[3].until = mariadb_server__register_install_status is succeeded
[4].name = Stop database server on first install
[4]["ansible.builtin.service"].name = mysql
[4]["ansible.builtin.service"].state = stopped
[4].when = ((mariadb_server__register_version | d() and not mariadb_server__register_version.stdout) and (mariadb_server__register_install_status | d() and mariadb_server__register_install_status is changed))
[5].name = Add database server user to specified groups
[5]["ansible.builtin.user"].name = mysql
[5]["ansible.builtin.user"].groups = {{ mariadb_server__append_groups | join(",") | default(omit) }}
[5]["ansible.builtin.user"].append = True
[5]["ansible.builtin.user"].createhome = False
[5].when = mariadb_server__pki | bool
[6].name = Check if MariaDB config directory exists
[6]["ansible.builtin.stat"].path = /etc/mysql/mariadb.conf.d
[6].register = mariadb_server__register_confd
[7].name = Ensure MariaDB data directory exists
[7]["ansible.builtin.file"].path = {{ mariadb_server__datadir }}
[7]["ansible.builtin.file"].state = directory
[7]["ansible.builtin.file"].owner = mysql
[7]["ansible.builtin.file"].group = mysql
[7]["ansible.builtin.file"].mode = 0755
[8].name = Move MariaDB data files to data directory
[8]["ansible.builtin.shell"] = mv {{ mariadb_server__default_datadir }}/* {{ mariadb_server__datadir }}
[8].register = mariadb_server__register_move
[8].changed_when = mariadb_server__register_move.changed | bool
[8].when = ((mariadb_server__register_version | d() and not mariadb_server__register_version.stdout) and (mariadb_server__register_install_status | d() and mariadb_server__register_install_status is changed) and (mariadb_server__datadir != mariadb_server__default_datadir))
[9].name = Configure database client on first install
[9]["ansible.builtin.template"].src = etc/mysql/conf.d/client.cnf.j2
[9]["ansible.builtin.template"].dest = {{ mariadb_server__client_cnf_file }}
[9]["ansible.builtin.template"].owner = root
[9]["ansible.builtin.template"].group = root
[9]["ansible.builtin.template"].mode = 0644
[9].when = (mariadb_server__register_version | d() and not mariadb_server__register_version.stdout)
[10].name = Configure database server
[10]["ansible.builtin.include_tasks"] = configure_server.yml
[10].tags[0] = role::mariadb_server:configure
[11].name = Start database server on first install
[11]["ansible.builtin.service"].name = mysql
[11]["ansible.builtin.service"].state = started
[11].when = ((mariadb_server__register_version | d() and not mariadb_server__register_version.stdout) and (mariadb_server__register_install_status | d() and mariadb_server__register_install_status is changed))
[12].name = Secure database server
[12]["ansible.builtin.include_tasks"] = secure_installation.yml
[12].tags[0] = role::mariadb_server:secure
[13].name = Make sure that local fact directory exists
[13]["ansible.builtin.file"].dest = /etc/ansible/facts.d
[13]["ansible.builtin.file"].state = directory
[13]["ansible.builtin.file"].owner = root
[13]["ansible.builtin.file"].group = root
[13]["ansible.builtin.file"].mode = 0755
[14].name = Save MariaDB local facts
[14]["ansible.builtin.template"].src = etc/ansible/facts.d/mariadb.fact.j2
[14]["ansible.builtin.template"].dest = /etc/ansible/facts.d/mariadb.fact
[14]["ansible.builtin.template"].owner = root
[14]["ansible.builtin.template"].group = root
[14]["ansible.builtin.template"].mode = 0644
[14].notify[0] = Refresh host facts
[14].tags[0] = meta::facts
[15].name = Re-read local facts if they have been modified
[15]["ansible.builtin.meta"] = flush_handlers
