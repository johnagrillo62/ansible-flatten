[0].name = Import DebOps global handlers
[0]["ansible.builtin.import_role"].name = global_handlers
[1].name = Install SKS Keyserver
[1]["ansible.builtin.apt"].name = sks
[1]["ansible.builtin.apt"].state = present
[1]["ansible.builtin.apt"].install_recommends = no
[1].register = sks__register_packages
[1].until = sks__register_packages is succeeded
[2].name = Configure firewall for SKS Keyserver
[2]["ansible.builtin.template"].src = etc/ferm/filter-input.d/sks.conf.j2
[2]["ansible.builtin.template"].dest = /etc/ferm/filter-input.d/sks.conf
[2]["ansible.builtin.template"].owner = root
[2]["ansible.builtin.template"].group = adm
[2]["ansible.builtin.template"].mode = 0644
[2].notify[0] = Restart ferm
[3].name = Check if SKS Keyserver database exists
[3]["ansible.builtin.stat"].path = /var/lib/sks/DB/key
[3].register = sks_register_database_pre_build
[4].name = Configure SKS Keyserver without database
[4]["ansible.builtin.template"].src = {{ item }}.j2
[4]["ansible.builtin.template"].dest = /{{ item }}
[4]["ansible.builtin.template"].owner = root
[4]["ansible.builtin.template"].group = root
[4]["ansible.builtin.template"].mode = 0644
[4].with_items[0] = etc/sks/sksconf
[4].with_items[1] = etc/sks/mailsync
[4].with_items[2] = etc/sks/membership
[4].when = sks_register_database_pre_build is defined and not sks_register_database_pre_build.stat.exists
[5].name = Build SKS Keyserver database
[5].become = True
[5].become_user = debian-sks
[5]["ansible.builtin.command"] = /usr/sbin/sks build
[5].args.chdir = /var/lib/sks
[5].args.creates = /var/lib/sks/DB/key
[5].when = sks_autoinit is defined and sks_autoinit
[6].name = Check if SKS Keyserver database exists
[6]["ansible.builtin.stat"].path = /var/lib/sks/DB/key
[6].register = sks_register_database_post_build
[7].name = Configure SKS Keyserver with database
[7]["ansible.builtin.template"].src = {{ item }}.j2
[7]["ansible.builtin.template"].dest = /{{ item }}
[7]["ansible.builtin.template"].owner = root
[7]["ansible.builtin.template"].group = root
[7]["ansible.builtin.template"].mode = 0644
[7].notify[0] = Restart sks
[7].with_items[0] = etc/default/sks
[7].with_items[1] = etc/sks/sksconf
[7].with_items[2] = etc/sks/mailsync
[7].with_items[3] = etc/sks/membership
[7].when = sks_register_database_post_build is defined and sks_register_database_post_build.stat.exists
[8].name = Configure frontend webserver
[8]["ansible.builtin.include_tasks"] = sks_frontend.yml
[8].when = sks_frontends is defined and inventory_hostname in sks_frontends
