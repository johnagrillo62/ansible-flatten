[0].name = Stop snmpd before admin account initialization
[0]["ansible.builtin.service"].name = snmpd
[0]["ansible.builtin.service"].state = stopped
[1].name = Prepare admin account
[1]["ansible.builtin.lineinfile"].dest = /var/lib/snmp/snmpd.conf
[1]["ansible.builtin.lineinfile"].regexp = ^createUser {{ snmpd_fact_account_admin_username }}
[1]["ansible.builtin.lineinfile"].line = createUser {{ snmpd_fact_account_admin_username }} SHA "{{ snmpd_fact_account_admin_password }}" AES
[1]["ansible.builtin.lineinfile"].state = present
[1]["ansible.builtin.lineinfile"].mode = 0600
[1].no_log = {{ debops__no_log | d(True) }}
[2].name = Start snmpd to initialize admin account
[2]["ansible.builtin.service"].name = snmpd
[2]["ansible.builtin.service"].state = started
[3].name = Create read-only agent account
[3]["ansible.builtin.command"] = snmpusm -u {{ snmpd_fact_account_admin_username }} -l authPriv -a SHA -x AES -A "{{ snmpd_fact_account_admin_password }}" -X "{{ snmpd_fact_account_admin_password }}" localhost create {{ snmpd_fact_account_agent_username }} {{ snmpd_fact_account_admin_username }}
[3].changed_when = False
[3].no_log = {{ debops__no_log | d(True) }}
[4].name = Change agent account password
[4]["ansible.builtin.command"] = snmpusm -u {{ snmpd_fact_account_admin_username }} -l authPriv -a SHA -x AES -A "{{ snmpd_fact_account_admin_password }}" -X "{{ snmpd_fact_account_admin_password }}" localhost passwd "{{ snmpd_fact_account_admin_password }}" "{{ snmpd_fact_account_agent_password }}" {{ snmpd_fact_account_agent_username }}
[4].changed_when = False
[4].no_log = {{ debops__no_log | d(True) }}
[5].name = Create read-only local account
[5]["ansible.builtin.command"] = snmpusm -u {{ snmpd_fact_account_admin_username }} -l authPriv -a SHA -x AES -A "{{ snmpd_fact_account_admin_password }}" -X "{{ snmpd_fact_account_admin_password }}" localhost create {{ snmpd_account_local_username }} {{ snmpd_fact_account_admin_username }}
[5].changed_when = False
[5].no_log = {{ debops__no_log | d(True) }}
[6].name = Change local account password
[6]["ansible.builtin.command"] = snmpusm -u {{ snmpd_fact_account_admin_username }} -l authPriv -a SHA -x AES -A "{{ snmpd_fact_account_admin_password }}" -X "{{ snmpd_fact_account_admin_password }}" localhost passwd "{{ snmpd_fact_account_admin_password }}" "{{ snmpd_account_local_password }}" {{ snmpd_account_local_username }}
[6].changed_when = False
[6].no_log = {{ debops__no_log | d(True) }}
[7].name = Remove admin account from snmpd.conf
[7]["ansible.builtin.lineinfile"].dest = /etc/snmp/snmpd.conf
[7]["ansible.builtin.lineinfile"].regexp = ^rwuser\s+{{ snmpd_fact_account_admin_username }}\s+priv
[7]["ansible.builtin.lineinfile"].state = absent
[7].no_log = {{ debops__no_log | d(True) }}
