[0].hosts = localhost
[0].connection = local
[0].gather_facts = False
[0].vars_files[0] = group_vars/all
[0].tasks[0].name = Launch webserver instances
[0].tasks[0].ec2 = access_key="{{ ec2_access_key }}" secret_key="{{ ec2_secret_key }}" keypair="{{ ec2_keypair }}" group="{{ ec2_security_group }}" type="{{ ec2_instance_type }}" image="ami-0d789266" region="{{ ec2_region }}" instance_tags="{'ansible_group':'windows_webservers', 'type':'{{ ec2_instance_type }}', 'group':'{{ ec2_security_group }}', 'Name':'demo_''{{ tower_user_name }}'}" count="{{ ec2_instance_count }}" wait=true

[0].tasks[0].register = ec2
[0].tasks[0].tags[0] = web
[0].tasks[1].name = Launch database instance
[0].tasks[1].ec2 = access_key="{{ ec2_access_key }}" secret_key="{{ ec2_secret_key }}" keypair="{{ ec2_keypair }}" group="{{ ec2_security_group }}" type="{{ ec2_instance_type }}" image="ami-17d66f7c" region="{{ ec2_region }}" instance_tags="{'ansible_group':'windows_dbservers', 'type':'{{ ec2_instance_type }}', 'group':'{{ ec2_security_group }}', 'Name':'demo_''{{ tower_user_name }}'}" count="1" wait=true

[0].tasks[1].register = ec2
[0].tasks[1].tags[0] = db
[0].tasks[2].name = Wait for WinRM to come up
[0].tasks[2].local_action = wait_for host={{ item.public_dns_name }} port=5986 delay=60 timeout=320 state=started
[0].tasks[2].with_items = ec2.instances
[0].tasks[2].tags[0] = web
[0].tasks[2].tags[1] = db
