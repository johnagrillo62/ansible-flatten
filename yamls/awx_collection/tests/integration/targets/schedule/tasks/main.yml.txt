[0].name = Generate a random string for test
[0]["ansible.builtin.set_fact"].test_id = {{ lookup('password', '/dev/null chars=ascii_letters length=16') }}
[0].when = test_id is not defined
[1].name = Generate random string for schedule
[1]["ansible.builtin.set_fact"].org_name = AWX-Collection-tests-organization-org-{{ test_id }}
[1]["ansible.builtin.set_fact"].sched1 = AWX-Collection-tests-schedule-sched1-{{ test_id }}
[1]["ansible.builtin.set_fact"].sched2 = AWX-Collection-tests-schedule-sched2-{{ test_id }}
[1]["ansible.builtin.set_fact"].cred1 = AWX-Collection-tests-schedule-cred1-{{ test_id }}
[1]["ansible.builtin.set_fact"].proj1 = AWX-Collection-tests-schedule-proj1-{{ test_id }}
[1]["ansible.builtin.set_fact"].proj2 = AWX-Collection-tests-schedule-proj2-{{ test_id }}
[1]["ansible.builtin.set_fact"].jt1 = AWX-Collection-tests-schedule-jt1-{{ test_id }}
[1]["ansible.builtin.set_fact"].jt2 = AWX-Collection-tests-schedule-jt1-{{ test_id }}
[1]["ansible.builtin.set_fact"].ee1 = AWX-Collection-tests-schedule-ee1-{{ test_id }}
[1]["ansible.builtin.set_fact"].label1 = AWX-Collection-tests-schedule-l1-{{ test_id }}
[1]["ansible.builtin.set_fact"].label2 = AWX-Collection-tests-schedule-l2-{{ test_id }}
[1]["ansible.builtin.set_fact"].ig1 = AWX-Collection-tests-schedule-ig1-{{ test_id }}
[1]["ansible.builtin.set_fact"].ig2 = AWX-Collection-tests-schedule-ig2-{{ test_id }}
[1]["ansible.builtin.set_fact"].slice_inventory = AWX-Collection-tests-schedule-slice-inv-{{ test_id }}
[1]["ansible.builtin.set_fact"].host_name = AWX-Collection-tests-schedule-host-{{ test_id }}
[1]["ansible.builtin.set_fact"].slice_num = 10
[2].name = Assert blocks
[2].block[0].name = Try to create without an rrule
[2].block[0].schedule.name = {{ sched1 }}
[2].block[0].schedule.state = present
[2].block[0].schedule.unified_job_template = Demo Job Template
[2].block[0].schedule.enabled = true
[2].block[0].register = result
[2].block[0].ignore_errors = true
[2].block[1].name = Assert result is failed
[2].block[1]["ansible.builtin.assert"].that[0] = result is failed
[2].block[1]["ansible.builtin.assert"].that[1] = 'Unable to create schedule '~ sched1 in result.msg
[2].block[2].name = Create with options that the JT does not support
[2].block[2].schedule.name = {{ sched1 }}
[2].block[2].schedule.state = present
[2].block[2].schedule.unified_job_template = Demo Job Template
[2].block[2].schedule.rrule = DTSTART:20191219T130551Z RRULE:FREQ=WEEKLY;INTERVAL=1;COUNT=1
[2].block[2].schedule.description = This hopefully will not work
[2].block[2].schedule.extra_data.some = var
[2].block[2].schedule.inventory = Demo Inventory
[2].block[2].schedule.scm_branch = asdf1234
[2].block[2].schedule.job_type = run
[2].block[2].schedule.job_tags = other_tags
[2].block[2].schedule.skip_tags = some_tags
[2].block[2].schedule.limit = node1
[2].block[2].schedule.diff_mode = true
[2].block[2].schedule.verbosity = 4
[2].block[2].schedule.enabled = true
[2].block[2].register = result
[2].block[2].ignore_errors = true
[2].block[3].name = Unable to create schedule
[2].block[3]["ansible.builtin.assert"].that[0] = result is failed
[2].block[3]["ansible.builtin.assert"].that[1] = 'Unable to create schedule '~ sched1 in result.msg
[2].block[4].name = Build a real schedule
[2].block[4].schedule.name = {{ sched1 }}
[2].block[4].schedule.state = present
[2].block[4].schedule.unified_job_template = Demo Job Template
[2].block[4].schedule.rrule = DTSTART:20191219T130551Z RRULE:FREQ=WEEKLY;INTERVAL=1;COUNT=1
[2].block[4].register = result
[2].block[5].name = Assert result is changed
[2].block[5]["ansible.builtin.assert"].that[0] = result is changed
[2].block[6].name = Use lookup to check that schedules was enabled
[2].block[6]["ansible.builtin.set_fact"].schedules_enabled_test = {{lookup('awx.awx.controller_api', 'schedules/{{result.id}}/').enabled | bool}}
[2].block[7].name = Newly created schedules should have API default value for enabled
[2].block[7]["ansible.builtin.assert"].that[0] = schedules_enabled_test
[2].block[8].name = Build a real schedule with exists
[2].block[8].schedule.name = {{ sched1 }}
[2].block[8].schedule.state = exists
[2].block[8].schedule.unified_job_template = Demo Job Template
[2].block[8].schedule.rrule = DTSTART:20191219T130551Z RRULE:FREQ=WEEKLY;INTERVAL=1;COUNT=1
[2].block[8].register = result
[2].block[9].name = Assert result did not change
[2].block[9]["ansible.builtin.assert"].that[0] = result is not changed
[2].block[10].name = Delete a real schedule
[2].block[10].schedule.name = {{ sched1 }}
[2].block[10].schedule.state = absent
[2].block[10].schedule.unified_job_template = Demo Job Template
[2].block[10].schedule.rrule = DTSTART:20191219T130551Z RRULE:FREQ=WEEKLY;INTERVAL=1;COUNT=1
[2].block[10].register = result
[2].block[11].name = Assert result changed
[2].block[11]["ansible.builtin.assert"].that[0] = result is changed
[2].block[12].name = Build a real schedule with exists
[2].block[12].schedule.name = {{ sched1 }}
[2].block[12].schedule.state = exists
[2].block[12].schedule.unified_job_template = Demo Job Template
[2].block[12].schedule.rrule = DTSTART:20191219T130551Z RRULE:FREQ=WEEKLY;INTERVAL=1;COUNT=1
[2].block[12].register = result
[2].block[13].name = Assert result changed
[2].block[13]["ansible.builtin.assert"].that[0] = result is changed
[2].block[14].name = Rebuild the same schedule
[2].block[14].schedule.name = {{ sched1 }}
[2].block[14].schedule.state = present
[2].block[14].schedule.unified_job_template = Demo Job Template
[2].block[14].schedule.rrule = DTSTART:20191219T130551Z RRULE:FREQ=WEEKLY;INTERVAL=1;COUNT=1
[2].block[14].register = result
[2].block[15].name = Assert result changed
[2].block[15]["ansible.builtin.assert"].that[0] = result is not changed
[2].block[16].name = Create a Demo Project
[2].block[16].project.name = {{ proj1 }}
[2].block[16].project.organization = Default
[2].block[16].project.allow_override = true
[2].block[16].project.state = present
[2].block[16].project.scm_type = git
[2].block[16].project.scm_url = https://github.com/ansible/ansible-tower-samples.git
[2].block[17].name = Create a new organization
[2].block[17].organization.name = {{ org_name }}
[2].block[18].name = Create a Demo Project in another org
[2].block[18].project.name = {{ proj2 }}
[2].block[18].project.organization = {{ org_name }}
[2].block[18].project.allow_override = true
[2].block[18].project.state = present
[2].block[18].project.scm_type = git
[2].block[18].project.scm_url = https://github.com/ansible/ansible-tower-samples.git
[2].block[19].name = Create Credential1
[2].block[19].credential.name = {{ cred1 }}
[2].block[19].credential.organization = Default
[2].block[19].credential.credential_type = Red Hat Ansible Automation Platform
[2].block[19].register = cred1_result
[2].block[20].name = Create Job Template with all prompts
[2].block[20].job_template.name = {{ jt1 }}
[2].block[20].job_template.organization = Default
[2].block[20].job_template.project = {{ proj1 }}
[2].block[20].job_template.inventory = Demo Inventory
[2].block[20].job_template.playbook = hello_world.yml
[2].block[20].job_template.ask_variables_on_launch = true
[2].block[20].job_template.ask_inventory_on_launch = true
[2].block[20].job_template.ask_scm_branch_on_launch = true
[2].block[20].job_template.ask_credential_on_launch = true
[2].block[20].job_template.ask_job_type_on_launch = true
[2].block[20].job_template.ask_tags_on_launch = true
[2].block[20].job_template.ask_skip_tags_on_launch = true
[2].block[20].job_template.ask_limit_on_launch = true
[2].block[20].job_template.ask_diff_mode_on_launch = true
[2].block[20].job_template.ask_verbosity_on_launch = true
[2].block[20].job_template.ask_execution_environment_on_launch = true
[2].block[20].job_template.ask_forks_on_launch = true
[2].block[20].job_template.ask_instance_groups_on_launch = true
[2].block[20].job_template.ask_job_slice_count_on_launch = true
[2].block[20].job_template.ask_labels_on_launch = true
[2].block[20].job_template.ask_timeout_on_launch = true
[2].block[20].job_template.job_type = run
[2].block[20].job_template.state = present
[2].block[20].register = result
[2].block[21].name = Assert result changed
[2].block[21]["ansible.builtin.assert"].that[0] = result is changed
[2].block[22].name = Create labels
[2].block[22].label.name = {{ item }}
[2].block[22].label.organization = {{ org_name }}
[2].block[22].loop[0] = {{ label1 }}
[2].block[22].loop[1] = {{ label2 }}
[2].block[23].name = Create an execution environment
[2].block[23].execution_environment.name = {{ ee1 }}
[2].block[23].execution_environment.image = junk
[2].block[24].name = Create instance groups
[2].block[24].instance_group.name = {{ item }}
[2].block[24].loop[0] = {{ ig1 }}
[2].block[24].loop[1] = {{ ig2 }}
[2].block[25].name = Create proper inventory for slice count
[2].block[25].inventory.name = {{ slice_inventory }}
[2].block[25].inventory.organization = {{ org_name }}
[2].block[25].inventory.state = present
[2].block[25].register = result
[2].block[26].name = Create a Host
[2].block[26].host.name = {{ host_name }}-{{ item }}
[2].block[26].host.inventory = {{ slice_inventory }}
[2].block[26].host.state = present
[2].block[26].host.variables.ansible_connection = local
[2].block[26].loop = {{ range(slice_num)|list }}
[2].block[26].register = result
[2].block[27].name = Create with options that the JT does support
[2].block[27].schedule.name = {{ sched2 }}
[2].block[27].schedule.state = present
[2].block[27].schedule.organization = Default
[2].block[27].schedule.unified_job_template = {{ jt1 }}
[2].block[27].schedule.rrule = DTSTART:20191219T130551Z RRULE:FREQ=WEEKLY;INTERVAL=1;COUNT=1
[2].block[27].schedule.description = This hopefully will work
[2].block[27].schedule.extra_data.some = var
[2].block[27].schedule.inventory = {{ slice_inventory }}
[2].block[27].schedule.scm_branch = asdf1234
[2].block[27].schedule.credentials[0] = {{ cred1 }}
[2].block[27].schedule.job_type = run
[2].block[27].schedule.job_tags = other_tags
[2].block[27].schedule.skip_tags = some_tags
[2].block[27].schedule.limit = node1
[2].block[27].schedule.diff_mode = true
[2].block[27].schedule.verbosity = 4
[2].block[27].schedule.enabled = true
[2].block[27].schedule.execution_environment = {{ ee1 }}
[2].block[27].schedule.forks = 10
[2].block[27].schedule.instance_groups[0] = {{ ig1 }}
[2].block[27].schedule.instance_groups[1] = {{ ig2 }}
[2].block[27].schedule.job_slice_count = {{ slice_num }}
[2].block[27].schedule.labels[0] = {{ label1 }}
[2].block[27].schedule.labels[1] = {{ label2 }}
[2].block[27].schedule.timeout = 10
[2].block[27].register = result
[2].block[27].ignore_errors = true
[2].block[28].name = Assert result changed
[2].block[28]["ansible.builtin.assert"].that[0] = result is changed
[2].block[29].name = Reset some options
[2].block[29].schedule.name = {{ sched2 }}
[2].block[29].schedule.state = present
[2].block[29].schedule.execution_environment = 
[2].block[29].schedule.forks = 1
[2].block[29].schedule.job_slice_count = 1
[2].block[29].schedule.timeout = 60
[2].block[29].register = result
[2].block[29].ignore_errors = true
[2].block[30].name = Assert result changed
[2].block[30]["ansible.builtin.assert"].that[0] = result is changed
[2].block[31].name = Disable a schedule
[2].block[31].schedule.name = {{ sched1 }}
[2].block[31].schedule.unified_job_template = Demo Job Template
[2].block[31].schedule.state = present
[2].block[31].schedule.enabled = false
[2].block[31].register = result
[2].block[32].name = Assert result changed
[2].block[32]["ansible.builtin.assert"].that[0] = result is changed
[2].block[33].name = Create a second Job Template in new org
[2].block[33].job_template.name = {{ jt2 }}
[2].block[33].job_template.project = {{ proj2 }}
[2].block[33].job_template.inventory = Demo Inventory
[2].block[33].job_template.playbook = hello_world.yml
[2].block[33].job_template.job_type = run
[2].block[33].job_template.state = present
[2].block[34].name = Build a schedule with a job template's name in two orgs
[2].block[34].schedule.name = {{ sched1 }}
[2].block[34].schedule.state = present
[2].block[34].schedule.unified_job_template = {{ jt2 }}
[2].block[34].schedule.rrule = DTSTART:20191219T130551Z RRULE:FREQ=WEEKLY;INTERVAL=1;COUNT=1
[2].block[34].register = result
[2].block[35].name = Verify we can't find the schedule without the UJT lookup
[2].block[35].schedule.name = {{ sched1 }}
[2].block[35].schedule.state = present
[2].block[35].schedule.rrule = DTSTART:20201219T130551Z RRULE:FREQ=WEEKLY;INTERVAL=1;COUNT=1
[2].block[35].register = result
[2].block[35].ignore_errors = true
[2].block[36].name = Assert result failed
[2].block[36]["ansible.builtin.assert"].that[0] = result is failed
[2].block[37].name = Verify we can find the schedule with the UJT lookup and delete it
[2].block[37].schedule.name = {{ sched1 }}
[2].block[37].schedule.state = absent
[2].block[37].schedule.unified_job_template = {{ jt2 }}
[2].block[37].register = result
[2].block[38].name = Assert result changed
[2].block[38]["ansible.builtin.assert"].that[0] = result is changed
[2].always[0].name = Delete the schedules
[2].always[0].schedule.name = {{ item }}
[2].always[0].schedule.state = absent
[2].always[0].loop[0] = {{ sched1 }}
[2].always[0].loop[1] = {{ sched2 }}
[2].always[0].failed_when = false
[2].always[1].name = Delete the jt1
[2].always[1].job_template.name = {{ jt1 }}
[2].always[1].job_template.project = {{ proj1 }}
[2].always[1].job_template.playbook = hello_world.yml
[2].always[1].job_template.state = absent
[2].always[1].register = del_res
[2].always[1].until = del_res is succeeded
[2].always[1].retries = 5
[2].always[1].delay = 3
[2].always[2].name = Delete the jt2
[2].always[2].job_template.name = {{ jt2 }}
[2].always[2].job_template.project = {{ proj2 }}
[2].always[2].job_template.playbook = hello_world.yml
[2].always[2].job_template.state = absent
[2].always[2].register = del_res
[2].always[2].until = del_res is succeeded
[2].always[2].retries = 5
[2].always[2].delay = 3
[2].always[3].name = Delete the Project2
[2].always[3].project.name = {{ proj2 }}
[2].always[3].project.organization = {{ org_name }}
[2].always[3].project.state = absent
[2].always[3].project.scm_type = git
[2].always[3].project.scm_url = https://github.com/ansible/ansible-tower-samples.git
[2].always[3].register = del_res
[2].always[3].until = del_res is succeeded
[2].always[3].retries = 5
[2].always[3].delay = 3
[2].always[3].failed_when = false
[2].always[4].name = Delete the Project1
[2].always[4].project.name = {{ proj1 }}
[2].always[4].project.organization = Default
[2].always[4].project.state = absent
[2].always[4].project.scm_type = git
[2].always[4].project.scm_url = https://github.com/ansible/ansible-tower-samples.git
[2].always[4].register = del_res
[2].always[4].until = del_res is succeeded
[2].always[4].retries = 5
[2].always[4].delay = 3
[2].always[5].name = Delete Credential1
[2].always[5].credential.name = {{ cred1 }}
[2].always[5].credential.organization = Default
[2].always[5].credential.credential_type = Red Hat Ansible Automation Platform
[2].always[5].credential.state = absent
[2].always[5].failed_when = false
[2].always[6].name = Delete an execution environment
[2].always[6].execution_environment.name = {{ ee1 }}
[2].always[6].execution_environment.image = junk
[2].always[6].execution_environment.state = absent
[2].always[6].failed_when = false
[2].always[7].name = Delete instance groups
[2].always[7].instance_group.name = {{ item }}
[2].always[7].instance_group.state = absent
[2].always[7].loop[0] = {{ ig1 }}
[2].always[7].loop[1] = {{ ig2 }}
[2].always[7].failed_when = false
[2].always[8].name = Remove the organization
[2].always[8].organization.name = {{ org_name }}
[2].always[8].organization.state = absent
[2].always[8].failed_when = false
[2].always[9].name = Delete slice inventory
[2].always[9].inventory.name = {{ slice_inventory }}
[2].always[9].inventory.organization = {{ org_name }}
[2].always[9].inventory.state = absent
[2].always[9].failed_when = false
[2].always[10].name = Delete slice hosts
[2].always[10].host.name = {{ host_name }}-{{ item }}
[2].always[10].host.inventory = {{ slice_inventory }}
[2].always[10].host.state = absent
[2].always[10].loop = {{ range(slice_num)|list }}
[2].always[10].failed_when = false
