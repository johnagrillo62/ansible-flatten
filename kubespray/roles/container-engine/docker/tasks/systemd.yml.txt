[0].name = Create docker service systemd directory if it doesn't exist
[0].file.path = /etc/systemd/system/docker.service.d
[0].file.state = directory
[0].file.mode = 0755
[1].name = Write docker proxy drop-in
[1].template.src = http-proxy.conf.j2
[1].template.dest = /etc/systemd/system/docker.service.d/http-proxy.conf
[1].template.mode = 0644
[1].notify = Restart docker
[1].when = http_proxy is defined or https_proxy is defined
[2].name = Write docker.service systemd file
[2].template.src = docker.service.j2
[2].template.dest = /etc/systemd/system/docker.service
[2].template.mode = 0644
[2].register = docker_service_file
[2].notify = Restart docker
[2].when[0] = not ansible_os_family in ["Flatcar", "Flatcar Container Linux by Kinvolk"]
[2].when[1] = not is_fedora_coreos
[3].name = Write docker options systemd drop-in
[3].template.src = docker-options.conf.j2
[3].template.dest = /etc/systemd/system/docker.service.d/docker-options.conf
[3].template.mode = 0644
[3].notify = Restart docker
[4].name = Write docker dns systemd drop-in
[4].template.src = docker-dns.conf.j2
[4].template.dest = /etc/systemd/system/docker.service.d/docker-dns.conf
[4].template.mode = 0644
[4].notify = Restart docker
[4].when = dns_mode != 'none' and resolvconf_mode == 'docker_dns'
[5].name = Copy docker orphan clean up script to the node
[5].copy.src = cleanup-docker-orphans.sh
[5].copy.dest = {{ bin_dir }}/cleanup-docker-orphans.sh
[5].copy.mode = 0755
[5].when = docker_orphan_clean_up | bool
[6].name = Write docker orphan clean up systemd drop-in
[6].template.src = docker-orphan-cleanup.conf.j2
[6].template.dest = /etc/systemd/system/docker.service.d/docker-orphan-cleanup.conf
[6].template.mode = 0644
[6].notify = Restart docker
[6].when = docker_orphan_clean_up | bool
[7].name = Flush handlers
[7].meta = flush_handlers
