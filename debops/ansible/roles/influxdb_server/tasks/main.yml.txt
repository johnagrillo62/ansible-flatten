[0].name = Import custom Ansible plugins
[0]["ansible.builtin.import_role"].name = ansible_plugins
[1].name = Import DebOps global handlers
[1]["ansible.builtin.import_role"].name = global_handlers
[2].name = Import DebOps secret role
[2]["ansible.builtin.import_role"].name = secret
[3].name = Restart database server on first install (influx bug)
[3]["ansible.builtin.service"].name = influxdb
[3]["ansible.builtin.service"].state = restarted
[3].when = not (ansible_local.influxdb_server.installed | d(false) | bool)
[4].name = Wait for HTTP endpoint port to become open on the host on first install
[4]["ansible.builtin.wait_for"].port = {{ influxdb_server__port }}
[4].when = not (ansible_local.influxdb_server.installed | d(false) | bool)
[5].name = Create default admin user on first install
[5]["community.general.influxdb_user"].user_name = root
[5]["community.general.influxdb_user"].user_password = {{ influxdb_server__root_password }}
[5]["community.general.influxdb_user"].state = present
[5]["community.general.influxdb_user"].admin = yes
[5]["community.general.influxdb_user"].proxies.http = null
[5]["community.general.influxdb_user"].proxies.https = null
[5].when = not (ansible_local.influxdb_server.installed | d(false) | bool)
[5].no_log = {{ debops__no_log | d(True) }}
[6].name = Stop database server on first install
[6]["ansible.builtin.service"].name = influxdb
[6]["ansible.builtin.service"].state = stopped
[6].when = not (ansible_local.influxdb_server.installed | d(false) | bool)
[7].name = Add InfluxDB server user to specified groups
[7]["ansible.builtin.user"].name = influxdb
[7]["ansible.builtin.user"].groups = {{ influxdb_server__append_groups | join(",") | default(omit) }}
[7]["ansible.builtin.user"].append = True
[7]["ansible.builtin.user"].createhome = False
[7].when = influxdb_server__pki | bool
[8].name = Ensure InfluxDB server directory exists
[8]["ansible.builtin.file"].path = {{ influxdb_server__directory }}
[8]["ansible.builtin.file"].state = directory
[8]["ansible.builtin.file"].owner = influxdb
[8]["ansible.builtin.file"].group = influxdb
[8]["ansible.builtin.file"].mode = 0750
[9].name = Move InfluxDB data files to data directory
[9]["ansible.builtin.shell"] = mv {{ influxdb_server__default_directory }}/* {{ influxdb_server__directory }}
[9].register = influxdb_server__register_move
[9].changed_when = influxdb_server__register_move.changed | bool
[9].when = (not (ansible_local.influxdb_server.installed | d(false) | bool) and influxdb_server__directory != influxdb_server__default_directory)
[10].name = Divert the original influxdb configuration file
[10]["debops.debops.dpkg_divert"].path = /etc/influxdb/influxdb.conf
[10]["debops.debops.dpkg_divert"].state = present
[10]["debops.debops.dpkg_divert"].delete = True
[10].tags[0] = role::influxdb_server:config
[11].name = Configure InfluxDB server
[11]["ansible.builtin.template"].src = etc/influxdb/influxdb.conf.j2
[11]["ansible.builtin.template"].dest = /etc/influxdb/influxdb.conf
[11]["ansible.builtin.template"].owner = root
[11]["ansible.builtin.template"].group = root
[11]["ansible.builtin.template"].mode = 0644
[11].tags[0] = role::influxdb_server:config
[11].notify[0] = Restart influxdb
[12].name = Start database server on first install
[12]["ansible.builtin.service"].name = influxdb
[12]["ansible.builtin.service"].state = started
[12].when = not (ansible_local.influxdb_server.installed | d(false) | bool)
[13].name = Configure autoinfluxdbbackup
[13]["ansible.builtin.include_tasks"] = autoinfluxdbbackup.yml
[13].when = influxdb_server__backup | bool
[13].tags[0] = role::influxdb_server:autoinfluxdbbackup
[14].name = Make sure that Ansible local facts directory exists
[14]["ansible.builtin.file"].path = /etc/ansible/facts.d
[14]["ansible.builtin.file"].state = directory
[14]["ansible.builtin.file"].mode = 0755
[15].name = Save InfluxDB server local facts
[15]["ansible.builtin.template"].src = etc/ansible/facts.d/influxdb_server.fact.j2
[15]["ansible.builtin.template"].dest = /etc/ansible/facts.d/influxdb_server.fact
[15]["ansible.builtin.template"].owner = root
[15]["ansible.builtin.template"].group = root
[15]["ansible.builtin.template"].mode = 0755
[15].notify[0] = Refresh host facts
[15].tags[0] = meta::facts
[16].name = Save InfluxDB local facts
[16]["ansible.builtin.template"].src = etc/ansible/facts.d/influxdb.fact.j2
[16]["ansible.builtin.template"].dest = /etc/ansible/facts.d/influxdb.fact
[16]["ansible.builtin.template"].owner = root
[16]["ansible.builtin.template"].group = root
[16]["ansible.builtin.template"].mode = 0644
[16].notify[0] = Refresh host facts
[17].name = Re-read local facts if they have been modified
[17]["ansible.builtin.meta"] = flush_handlers
