[0].name = Import DebOps global handlers
[0]["ansible.builtin.import_role"].name = global_handlers
[1].name = Make sure that Ansible local facts directory exists
[1]["ansible.builtin.file"].path = /etc/ansible/facts.d
[1]["ansible.builtin.file"].state = directory
[1]["ansible.builtin.file"].mode = 0755
[2].name = Save networkd local facts
[2]["ansible.builtin.template"].src = etc/ansible/facts.d/networkd.fact.j2
[2]["ansible.builtin.template"].dest = /etc/ansible/facts.d/networkd.fact
[2]["ansible.builtin.template"].mode = 0755
[2].notify[0] = Refresh host facts
[2].tags[0] = meta::facts
[3].name = Update Ansible facts if they were modified
[3]["ansible.builtin.meta"] = flush_handlers
[4].name = Ensure that systemd-networkd service is enabled
[4]["ansible.builtin.systemd"].name = systemd-networkd.service
[4]["ansible.builtin.systemd"].enabled = True
[4].when = networkd__enabled | bool
[5].name = Remove systemd-networkd configuuration if requested
[5]["ansible.builtin.file"].path = /etc/systemd/networkd.conf.d/ansible.conf
[5]["ansible.builtin.file"].state = absent
[5].notify[0] = Restart systemd-networkd service
[5].when = networkd__enabled | bool and networkd__deploy_state == 'absent'
[6].name = Create systemd-networkd configuration directory
[6]["ansible.builtin.file"].path = /etc/systemd/networkd.conf.d
[6]["ansible.builtin.file"].state = directory
[6]["ansible.builtin.file"].mode = 0755
[6].when = networkd__enabled | bool and networkd__deploy_state != 'absent'
[7].name = Generate systemd-networkd configuration
[7]["ansible.builtin.template"].src = etc/systemd/networkd.conf.d/ansible.conf.j2
[7]["ansible.builtin.template"].dest = /etc/systemd/networkd.conf.d/ansible.conf
[7]["ansible.builtin.template"].mode = 0644
[7].notify[0] = Restart systemd-networkd service
[7].when = networkd__enabled | bool and networkd__deploy_state != 'absent'
[8].name = Remove network units if requested
[8]["ansible.builtin.file"].path = {{ "/etc/systemd/network/" + item.name }}
[8]["ansible.builtin.file"].state = absent
[8].loop = {{ networkd__combined_units | flatten | debops.debops.parse_kv_items }}
[8].loop_control.label = {{ {"name": item.name, "state": item.state | d("present")} }}
[8].notify[0] = Restart systemd-networkd service
[8].when = networkd__enabled | bool and item.state | d("present") == 'absent'
[9].name = Remove network unit overrides if requested
[9]["ansible.builtin.file"].path = {{ "/etc/systemd/network/" + item.name + ".d" }}
[9]["ansible.builtin.file"].state = absent
[9].loop = {{ networkd__combined_units | flatten | debops.debops.parse_kv_items }}
[9].loop_control.label = {{ {"name": item.name, "state": item.state | d("present")} }}
[9].notify[0] = Restart systemd-networkd service
[9].when = networkd__enabled | bool and item.state | d("present") == 'absent'
[10].name = Create directories for network units
[10]["ansible.builtin.file"].path = {{ "/etc/systemd/network/" + (item.name | dirname) }}
[10]["ansible.builtin.file"].state = directory
[10]["ansible.builtin.file"].mode = 0755
[10].loop = {{ networkd__combined_units | flatten | debops.debops.parse_kv_items }}
[10].loop_control.label = {{ {"name": item.name, "state": item.state | d("present")} }}
[10].when = networkd__enabled | bool and item.raw | d() and item.state | d("present") not in ['absent', 'ignore', 'init'] and (item.name | dirname).endswith('.d')
[11].name = Generate network units
[11]["ansible.builtin.template"].src = etc/systemd/network/template.j2
[11]["ansible.builtin.template"].dest = {{ "/etc/systemd/network/" + item.name }}
[11]["ansible.builtin.template"].mode = 0644
[11].loop = {{ networkd__combined_units | flatten | debops.debops.parse_kv_items }}
[11].loop_control.label = {{ {"name": item.name, "state": item.state | d("present")} }}
[11].notify[0] = Restart systemd-networkd service
[11].when = networkd__enabled | bool and item.raw | d() and item.state | d("present") not in ['absent', 'ignore', 'init']
[12].name = Flush handlers when needed
[12]["ansible.builtin.meta"] = flush_handlers
