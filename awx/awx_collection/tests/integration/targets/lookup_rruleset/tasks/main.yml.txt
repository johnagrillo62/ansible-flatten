~d0.name = Get our collection package
~d1.controller_meta = 
~d1.register = controller_meta
~d0.name = Generate the name of our plugin
~d1.set_fact = 
~d2.ruleset_plugin_name = "{{ controller_meta.prefix }}.schedule_rruleset"
~d2.rule_plugin_name = "{{ controller_meta.prefix }}.schedule_rrule"
~d0.name = Call ruleset with no rules
~d1.set_fact = 
~d2.complex_rule = "{{ lookup(ruleset_plugin_name | string, '2022-04-30 10:30:45') }}"
~d1.ignore_errors = True
~d1.register = results
~d0.assert = 
~d2.that = 
~d0.name = call ruleset with a missing frequency
~d1.set_fact = 
~d2.complex_rule = "{{ lookup(ruleset_plugin_name, '2022-04-30 10:30:45', rules=rrules ) }}"
~d1.ignore_errors = True
~d1.register = results
~d1.vars = 
~d2.rrules = 
~d3.frequency = 'day'
~d4.interval = 1
~d3.interval = 1
~d4.byweekday = 'sunday'
~d0.assert = 
~d2.that = 
~d0.name = call ruleset with a missing frequency
~d1.set_fact = 
~d2.complex_rule = "{{ lookup(ruleset_plugin_name, '2022-04-30 10:30:45', rules=rrules ) }}"
~d1.ignore_errors = True
~d1.register = results
~d1.vars = 
~d2.rrules = 
~d3.frequency = 'day'
~d4.interval = 1
~d3.interval = 1
~d4.byweekday = 'sunday'
~d0.assert = 
~d2.that = 
~d0.name = call rruleset with an invalid frequency
~d1.set_fact = 
~d2.complex_rule = "{{ lookup(ruleset_plugin_name, '2022-04-30 10:30:45', rules=rrules ) }}"
~d1.ignore_errors = True
~d1.register = results
~d1.vars = 
~d2.rrules = 
~d3.frequency = 'day'
~d4.interval = 1
~d3.frequency = 'asdf'
~d4.interval = 1
~d4.byweekday = 'sunday'
~d0.assert = 
~d2.that = 
~d0.name = call rruleset with an invalid end_on
~d1.set_fact = 
~d2.complex_rule = "{{ lookup(ruleset_plugin_name, '2022-04-30 10:30:45', rules=rrules ) }}"
~d1.ignore_errors = True
~d1.register = results
~d1.vars = 
~d2.rrules = 
~d3.frequency = 'day'
~d4.interval = 1
~d3.frequency = 'day'
~d4.interval = 1
~d4.byweekday = 'sunday'
~d4.end_on = 'a'
~d0.assert = 
~d2.that = 
~d3."'In rule 2 end_on must either be an integer or in the format YYYY-MM-DD [HH = MM:SS]' in results.msg"
~d0.name = Every Mondays
~d1.set_fact = 
~d2.complex_rule = "{{ lookup(ruleset_plugin_name, '2022-04-30 10:30:45', rules=rrules, timezone='UTC' ) }}"
~d1.ignore_errors = True
~d1.register = results
~d1.vars = 
~d2.rrules = 
~d3.frequency = 'day'
~d4.interval = 1
~d4.byweekday = 'monday'
~d0.assert = 
~d2.that = 
~d3."'DTSTART;TZID=UTC = 20220430T103045 RRULE:FREQ=DAILY;BYDAY=MO;INTERVAL=1' == complex_rule"
~d0.name = call rruleset with an invalid byweekday
~d1.set_fact = 
~d2.complex_rule = "{{ lookup(ruleset_plugin_name, '2022-04-30 10:30:45', rules=rrules ) }}"
~d1.ignore_errors = True
~d1.register = results
~d1.vars = 
~d2.rrules = 
~d3.frequency = 'day'
~d4.interval = 1
~d3.frequency = 'day'
~d4.interval = 1
~d4.byweekday = 'junk'
~d0.assert = 
~d2.that = 
~d0.name = call rruleset with a monthly rule with invalid bymonthday (a)
~d1.set_fact = 
~d2.complex_rule = "{{ lookup(ruleset_plugin_name, '2022-04-30 10:30:45', rules=rrules ) }}"
~d1.ignore_errors = True
~d1.register = results
~d1.vars = 
~d2.rrules = 
~d3.frequency = 'day'
~d4.interval = 1
~d3.frequency = 'month'
~d4.interval = 1
~d4.bymonthday = 'a'
~d0.assert = 
~d2.that = 
~d0.name = call rruleset with a monthly rule with invalid bymonthday (-1)
~d1.set_fact = 
~d2.complex_rule = "{{ lookup(ruleset_plugin_name, '2022-04-30 10:30:45', rules=rrules ) }}"
~d1.ignore_errors = True
~d1.register = results
~d1.vars = 
~d2.rrules = 
~d3.frequency = 'day'
~d4.interval = 1
~d3.frequency = 'month'
~d4.interval = 1
~d4.bymonthday = '-1'
~d0.assert = 
~d2.that = 
~d0.name = call rruleset with a monthly rule with invalid bymonthday (32)
~d1.set_fact = 
~d2.complex_rule = "{{ lookup(ruleset_plugin_name, '2022-04-30 10:30:45', rules=rrules ) }}"
~d1.ignore_errors = True
~d1.register = results
~d1.vars = 
~d2.rrules = 
~d3.frequency = 'day'
~d4.interval = 1
~d3.frequency = 'month'
~d4.interval = 1
~d4.bymonthday = 32
~d0.assert = 
~d2.that = 
~d0.name = call rruleset with a monthly rule with invalid bysetpos (junk)
~d1.set_fact = 
~d2.complex_rule = "{{ lookup(ruleset_plugin_name, '2022-04-30 10:30:45', rules=rrules ) }}"
~d1.ignore_errors = True
~d1.register = results
~d1.vars = 
~d2.rrules = 
~d3.frequency = 'day'
~d4.interval = 1
~d3.frequency = 'month'
~d4.interval = 1
~d4.bysetpos = 'junk'
~d0.assert = 
~d2.that = 
~d0.name = call rruleset with an invalid timezone
~d1.set_fact = 
~d2.complex_rule = "{{ lookup(ruleset_plugin_name, '2022-04-30 10:30:45', rules=rrules, timezone='junk' ) }}"
~d1.ignore_errors = True
~d1.register = results
~d1.vars = 
~d2.rrules = 
~d3.frequency = 'day'
~d4.interval = 1
~d3.frequency = 'day'
~d4.interval = 1
~d4.byweekday = 'sunday'
~d0.assert = 
~d2.that = 
~d0.name = call rruleset with only exclude rules
~d1.set_fact = 
~d2.complex_rule = "{{ lookup(ruleset_plugin_name, '2022-04-30 10:30:45', rules=rrules ) }}"
~d1.ignore_errors = True
~d1.register = results
~d1.vars = 
~d2.rrules = 
~d3.frequency = 'day'
~d4.interval = 1
~d4.include = False
~d3.frequency = 'day'
~d4.interval = 1
~d4.byweekday = 'sunday'
~d4.include = False
~d0.assert = 
~d2.that = 
~d0.name = Every day except for Sundays
~d1.set_fact = 
~d2.complex_rule = "{{ lookup(ruleset_plugin_name, '2022-04-30 10:30:45', rules=rrules, timezone='UTC' ) }}"
~d1.ignore_errors = True
~d1.register = results
~d1.vars = 
~d2.rrules = 
~d3.frequency = 'day'
~d4.interval = 1
~d3.frequency = 'day'
~d4.interval = 1
~d4.byweekday = 'sunday'
~d4.include = False
~d0.assert = 
~d2.that = 
~d3."'DTSTART;TZID=UTC = 20220430T103045 RRULE:FREQ=DAILY;INTERVAL=1 EXRULE:FREQ=DAILY;BYDAY=SU;INTERVAL=1' == complex_rule"
~d0.name = Every day except for April 30th
~d1.set_fact = 
~d2.complex_rule = "{{ lookup(ruleset_plugin_name, '2023-04-28 17:00:00', rules=rrules, timezone='UTC' ) }}"
~d1.ignore_errors = True
~d1.register = results
~d1.vars = 
~d2.rrules = 
~d3.frequency = 'day'
~d4.interval = 1
~d3.frequency = 'day'
~d4.interval = 1
~d4.bymonth = '4'
~d4.bymonthday = 30
~d4.include = False
~d0.assert = 
~d2.that = 
~d3."'DTSTART;TZID=UTC = 20230428T170000 RRULE:FREQ=DAILY;INTERVAL=1 EXRULE:FREQ=DAILY;BYMONTH=4;BYMONTHDAY=30;INTERVAL=1' == complex_rule"
~d0.name = Every 5 minutes but not on Mondays from 5-7pm
~d1.set_fact = 
~d2.complex_rule = "{{ lookup(ruleset_plugin_name, '2022-04-30 10:30:45', rules=rrules, timezone='UTC' ) }}"
~d1.ignore_errors = True
~d1.register = results
~d1.vars = 
~d2.rrules = 
~d3.frequency = 'minute'
~d4.interval = 5
~d3.frequency = 'minute'
~d4.interval = 5
~d4.byweekday = 'monday'
~d4.byhour = 
~d4.include = False
~d0.assert = 
~d2.that = 
~d3."'DTSTART;TZID=UTC = 20220430T103045 RRULE:FREQ=MINUTELY;INTERVAL=5 EXRULE:FREQ=MINUTELY;INTERVAL=5;BYDAY=MO;BYHOUR=17,18' == complex_rule"
~d0.name = Every 15 minutes Monday to Friday from 10:01am to 6:02pm (inclusive)
~d1.set_fact = 
~d2.complex_rule = "{{ lookup(ruleset_plugin_name, '2022-04-30 10:30:45', rules=rrules, timezone='UTC' ) }}"
~d1.ignore_errors = True
~d1.register = results
~d1.vars = 
~d2.rrules = 
~d3.frequency = 'minute'
~d4.byweekday = 
~d4.interval = 15
~d4.byhour = [10, 11, 12, 13, 14, 15, 16, 17, 18]
~d3.frequency = 'minute'
~d4.interval = 1
~d4.byweekday = "monday,tuesday,wednesday, thursday,friday"
~d4.byhour = 18
~d4.byminute = "{{ range(3, 60) | list }}"
~d4.include = False
~d0.assert = 
~d2.that = 
~d3."'DTSTART;TZID=UTC = 20220430T103045 RRULE:FREQ=MINUTELY;INTERVAL=15;BYDAY=MO,TU,WE,TH,FR;BYHOUR=10,11,12,13,14,15,16,17,18 EXRULE:FREQ=MINUTELY;BYDAY=MO,TU,WE,TH,FR;BYHOUR=18;BYMINUTE=3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59;INTERVAL=1' == complex_rule"
~d0.name = Any Saturday whose month day is between 12 and 18
~d1.set_fact = 
~d2.complex_rule = "{{ lookup(ruleset_plugin_name, '2022-04-30 10:30:45', rules=rrules, timezone='UTC' ) }}"
~d1.ignore_errors = True
~d1.register = results
~d1.vars = 
~d2.rrules = 
~d3.frequency = 'month'
~d4.interval = 1
~d4.byweekday = 'saturday'
~d4.bymonthday = "{{ range(12,19) | list }}"
~d0.assert = 
~d2.that = 
~d3."'DTSTART;TZID=UTC = 20220430T103045 RRULE:FREQ=MONTHLY;BYMONTHDAY=12,13,14,15,16,17,18;BYDAY=SA;INTERVAL=1' == complex_rule"
~d0.name = mondays, Tuesdays, and WEDNESDAY with case-insensitivity
~d1.set_fact = 
~d2.complex_rule = "{{ lookup(ruleset_plugin_name, '2022-04-30 10:30:45', rules=rrules, timezone='UTC' ) }}"
~d1.ignore_errors = True
~d1.register = results
~d1.vars = 
~d2.rrules = 
~d3.frequency = 'day'
~d4.interval = 1
~d4.byweekday = monday, Tuesday, WEDNESDAY
~d0.assert = 
~d2.that = 
~d3."'DTSTART;TZID=UTC = 20220430T103045 RRULE:FREQ=DAILY;BYDAY=MO,TU,WE;INTERVAL=1' == complex_rule"
