[0].name = Import custom Ansible plugins
[0]["ansible.builtin.import_role"].name = ansible_plugins
[1].name = Import DebOps global handlers
[1]["ansible.builtin.import_role"].name = global_handlers
[2].name = Add/remove diversion of PAM access control files
[2].vars.pam_access__var_access_conf = {{ "/etc/security/"
                                     + item.filename | d("access-" + (item.name | regex_replace("\.conf$", "")) + ".conf") }}
[2]["debops.debops.dpkg_divert"].path = {{ pam_access__var_access_conf }}
[2]["debops.debops.dpkg_divert"].state = {{ item.state | d("present") }}
[2]["debops.debops.dpkg_divert"].delete = True
[2].loop = {{ pam_access__combined_rules | debops.debops.parse_kv_items }}
[2].loop_control.label = {{ {"access_conf": pam_access__var_access_conf, "state": item.state | d("present")} }}
[2].when = (pam_access__enabled | bool and item.name | d() and item.divert | d(False) | bool and item.state | d('present') in ['present', 'absent'])
[3].name = Generate PAM access control files
[3].vars.pam_access__var_access_conf = {{ "/etc/security/"
                                     + item.filename | d("access-" + (item.name | regex_replace("\.conf$", "")) + ".conf") }}
[3]["ansible.builtin.template"].src = etc/security/access.conf.j2
[3]["ansible.builtin.template"].dest = /etc/security/{{ item.filename | d("access-" + (item.name | regex_replace("\.conf$", "")) + ".conf") }}
[3]["ansible.builtin.template"].mode = 0644
[3].loop = {{ pam_access__combined_rules | debops.debops.parse_kv_items }}
[3].loop_control.label = {{ {"access_conf": pam_access__var_access_conf, "state": item.state | d("present")} }}
[3].when = pam_access__enabled | bool and item.name | d() and item.options | d() and item.state | d('present') not in ['absent', 'init', 'ignore']
[4].name = Remove PAM access control files
[4].vars.pam_access__var_access_conf = {{ "/etc/security/"
                                     + item.filename | d("access-" + (item.name | regex_replace("\.conf$", "")) + ".conf") }}
[4]["ansible.builtin.file"].path = /etc/security/{{ item.filename | d("access-" + (item.name | regex_replace("\.conf$", "")) + ".conf") }}
[4]["ansible.builtin.file"].state = absent
[4].loop = {{ pam_access__combined_rules | debops.debops.parse_kv_items }}
[4].loop_control.label = {{ {"access_conf": pam_access__var_access_conf, "state": item.state | d("present")} }}
[4].when = pam_access__enabled | bool and item.name | d() and not item.divert | d(False) | bool and item.state | d('present') == 'absent'
[5].name = Make sure that Ansible local facts directory exists
[5]["ansible.builtin.file"].path = /etc/ansible/facts.d
[5]["ansible.builtin.file"].state = directory
[5]["ansible.builtin.file"].mode = 0755
[6].name = Save pam_access local facts
[6]["ansible.builtin.template"].src = etc/ansible/facts.d/pam_access.fact.j2
[6]["ansible.builtin.template"].dest = /etc/ansible/facts.d/pam_access.fact
[6]["ansible.builtin.template"].mode = 0755
[6].notify[0] = Refresh host facts
[6].tags[0] = meta::facts
[7].name = Update Ansible facts if they were modified
[7]["ansible.builtin.meta"] = flush_handlers
