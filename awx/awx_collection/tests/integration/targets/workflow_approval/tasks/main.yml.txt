[0].name = Generate a random string for names
[0]["ansible.builtin.set_fact"].test_id = {{ lookup('password', '/dev/null chars=ascii_letters length=16') }}
[0].when = test_id is not defined
[1].name = Generate random names for test objects
[1]["ansible.builtin.set_fact"].org_name = {{ test_prefix }}-org-{{ test_id }}
[1]["ansible.builtin.set_fact"].approval_node_name = {{ test_prefix }}-node-{{ test_id }}
[1]["ansible.builtin.set_fact"].wfjt_name = {{ test_prefix }}-wfjt-{{ test_id }}
[1].vars.test_prefix = AWX-Collection-tests-workflow_approval
[2].name = Task block
[2].block[0].name = Create a new organization for test isolation
[2].block[0].organization.name = {{ org_name }}
[2].block[1].name = Create a workflow job template
[2].block[1].workflow_job_template.name = {{ wfjt_name }}
[2].block[1].workflow_job_template.organization = {{ org_name }}
[2].block[2].name = Create approval node
[2].block[2].workflow_job_template_node.identifier = approval_test
[2].block[2].workflow_job_template_node.approval_node.name = {{ approval_node_name }}
[2].block[2].workflow_job_template_node.approval_node.timeout = 900
[2].block[2].workflow_job_template_node.workflow = {{ wfjt_name }}
[2].block[3].name = Launch the workflow
[2].block[3].workflow_launch.workflow_template = {{ wfjt_name }}
[2].block[3].workflow_launch.wait = false
[2].block[3].register = workflow_job
[2].block[4].name = Wait for approval node to activate and approve
[2].block[4].workflow_approval.workflow_job_id = {{ workflow_job.id }}
[2].block[4].workflow_approval.name = {{ approval_node_name }}
[2].block[4].workflow_approval.interval = 10
[2].block[4].workflow_approval.timeout = 20
[2].block[4].workflow_approval.action = approve
[2].block[4].register = result
[2].block[5].name = Assert result changed and did not fail
[2].block[5]["ansible.builtin.assert"].that[0] = result.changed
[2].block[5]["ansible.builtin.assert"].that[1] = not (result.failed)
[2].always[0].name = Delete the workflow job template
[2].always[0].workflow_job_template.name = {{ wfjt_name }}
[2].always[0].workflow_job_template.state = absent
[2].always[0].register = delete_result
[2].always[0].failed_when = delete_result.failed and "'not found' not in delete_result.msg"
