[0].name = Import custom Ansible plugins
[0]["ansible.builtin.import_role"].name = ansible_plugins
[1].name = Import DebOps secret role
[1]["ansible.builtin.import_role"].name = secret
[2].name = Remove configuration directories if requested
[2]["ansible.builtin.file"].path = {{ preseed__www + "/" + item.flavor + "/d-i/" + item.release }}
[2]["ansible.builtin.file"].state = absent
[2].loop = {{ preseed__combined_definitions | debops.debops.parse_kv_items }}
[2].loop_control.label = {{ {"name": item.name, "state": item.state, "flavor": item.flavor, "release": item.release} }}
[2].when = item.state | d('present') in ['absent']
[3].name = Create configuration directories
[3]["ansible.builtin.file"].path = {{ preseed__www + "/" + item.flavor + "/d-i/" + item.release }}
[3]["ansible.builtin.file"].state = directory
[3]["ansible.builtin.file"].mode = 0755
[3].loop = {{ preseed__combined_definitions | debops.debops.parse_kv_items }}
[3].loop_control.label = {{ {"name": item.name, "state": item.state, "flavor": item.flavor, "release": item.release} }}
[3].when = item.state | d('present') not in ['absent', 'ignore', 'init']
[4].name = Generate Preseed configuration files
[4]["ansible.builtin.template"].src = srv/www/sites/debian-preseed/public/preseed.cfg.j2
[4]["ansible.builtin.template"].dest = {{ preseed__www + "/" + item.flavor + "/d-i/"
              + item.release + "/preseed.cfg" }}
[4]["ansible.builtin.template"].owner = root
[4]["ansible.builtin.template"].group = www-data
[4]["ansible.builtin.template"].mode = 0640
[4].loop = {{ preseed__combined_definitions
            | debops.debops.parse_kv_items(defaults={"options": preseed__combined_configuration
                                                                | debops.debops.parse_kv_config}) }}
[4].loop_control.label = {{ {"name": item.name, "state": item.state, "flavor": item.flavor, "release": item.release} }}
[4].when = item.state | d('present') not in ['absent', 'ignore', 'init']
[5].name = Generate postinst scripts
[5]["ansible.builtin.template"].src = srv/www/sites/debian-preseed/public/postinst.sh.j2
[5]["ansible.builtin.template"].dest = {{ preseed__www + "/" + item.flavor + "/d-i/"
              + item.release + "/postinst.sh" }}
[5]["ansible.builtin.template"].owner = root
[5]["ansible.builtin.template"].group = www-data
[5]["ansible.builtin.template"].mode = 0640
[5].loop = {{ preseed__combined_definitions
            | debops.debops.parse_kv_items(defaults={"options": preseed__combined_configuration
                                                                | debops.debops.parse_kv_config}) }}
[5].loop_control.label = {{ {"name": item.name, "state": item.state, "flavor": item.flavor, "release": item.release} }}
[5].when = item.state | d('present') not in ['absent', 'ignore', 'init']
[6].name = Make sure that Ansible local facts directory exists
[6]["ansible.builtin.file"].path = /etc/ansible/facts.d
[6]["ansible.builtin.file"].state = directory
[6]["ansible.builtin.file"].mode = 0755
[7].name = Save Preseed local facts
[7]["ansible.builtin.template"].src = etc/ansible/facts.d/preseed.fact.j2
[7]["ansible.builtin.template"].dest = /etc/ansible/facts.d/preseed.fact
[7]["ansible.builtin.template"].mode = 0755
[7].notify[0] = Refresh host facts
[7].tags[0] = meta::facts
[8].name = Update Ansible facts if they were modified
[8]["ansible.builtin.meta"] = flush_handlers
