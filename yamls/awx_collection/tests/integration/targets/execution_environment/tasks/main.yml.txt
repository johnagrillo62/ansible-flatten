[0].name = Generate a random string for test
[0].set_fact.test_id = {{ lookup('password', '/dev/null chars=ascii_letters length=16') }}
[0].when = test_id is not defined
[1].name = Generate names
[1].set_fact.ee_name = AWX-Collection-tests-ee-{{ test_id }}
[2].block[0].name = Add an EE
[2].block[0].execution_environment.name = {{ ee_name }}
[2].block[0].execution_environment.description = EE for Testing
[2].block[0].execution_environment.image = quay.io/ansible/awx-ee
[2].block[0].execution_environment.pull = always
[2].block[0].execution_environment.organization = Default
[2].block[0].register = result
[2].block[1].assert.that[0] = result is changed
[2].block[2].name = Add an EE with exists
[2].block[2].execution_environment.name = {{ ee_name }}
[2].block[2].execution_environment.description = EE for Testing
[2].block[2].execution_environment.image = quay.io/ansible/awx-ee
[2].block[2].execution_environment.pull = always
[2].block[2].execution_environment.organization = Default
[2].block[2].execution_environment.state = exists
[2].block[2].register = result
[2].block[3].assert.that[0] = result is not changed
[2].block[4].name = Delete an EE
[2].block[4].execution_environment.name = {{ ee_name }}
[2].block[4].execution_environment.description = EE for Testing
[2].block[4].execution_environment.image = quay.io/ansible/awx-ee
[2].block[4].execution_environment.pull = always
[2].block[4].execution_environment.organization = Default
[2].block[4].execution_environment.state = absent
[2].block[4].register = result
[2].block[5].assert.that[0] = result is changed
[2].block[6].name = Add an EE with exists
[2].block[6].execution_environment.name = {{ ee_name }}
[2].block[6].execution_environment.description = EE for Testing
[2].block[6].execution_environment.image = quay.io/ansible/awx-ee
[2].block[6].execution_environment.pull = always
[2].block[6].execution_environment.organization = Default
[2].block[6].execution_environment.state = exists
[2].block[6].register = result
[2].block[7].assert.that[0] = result is changed
[2].block[8].name = Associate the Test EE with Default Org (this should fail)
[2].block[8].execution_environment.name = {{ ee_name }}
[2].block[8].execution_environment.organization = Some Org
[2].block[8].execution_environment.image = quay.io/ansible/awx-ee
[2].block[8].register = result
[2].block[8].ignore_errors = yes
[2].block[9].assert.that[0] = result is failed
[2].block[10].name = Rename the Test EEs
[2].block[10].execution_environment.name = {{ ee_name }}
[2].block[10].execution_environment.new_name = {{ ee_name }}a
[2].block[10].execution_environment.image = quay.io/ansible/awx-ee
[2].block[10].register = result
[2].block[11].assert.that[0] = result is changed
[2].always[0].name = Delete the Test EEs
[2].always[0].execution_environment.name = {{ item }}
[2].always[0].execution_environment.state = absent
[2].always[0].execution_environment.image = quay.io/ansible/awx-ee
[2].always[0].register = result
[2].always[0].loop[0] = {{ ee_name }}
[2].always[0].loop[1] = {{ ee_name }}a
[2].always[1].assert.that[0] = result is changed
