[0].name = Select supported release for current distribution
[0]["ansible.builtin.set_fact"].hwraid_register_release = {{ hwraid_release }}
[0].when = hwraid_release in hwraid_distribution_releases[hwraid_distribution]
[1].name = Select latest release for current distribution if no match found
[1]["ansible.builtin.set_fact"].hwraid_register_release = {{ hwraid_distribution_releases[hwraid_distribution][0] }}
[1].when = hwraid_register_release is undefined
[2].name = Configure HWRaid APT repository
[2]["ansible.builtin.apt_repository"].repo = deb http://hwraid.le-vert.net/{{ hwraid_distribution | lower }} {{ hwraid_register_release | lower }} main
[2]["ansible.builtin.apt_repository"].state = present
[2]["ansible.builtin.apt_repository"].update_cache = True
[2].when = hwraid_register_release is defined and hwraid_register_release
[3].name = Get list of active kernel modules
[3]["ansible.builtin.shell"] = set -o nounset -o pipefail -o errexit && lsmod | awk '{print $1}'
[3].args.executable = bash
[3].register = hwraid_register_modules
[3].changed_when = False
[4].name = Install packages for recognized RAID devices
[4]["ansible.builtin.apt"].name = {{ item.1 }}
[4]["ansible.builtin.apt"].state = present
[4]["ansible.builtin.apt"].install_recommends = False
[4].with_subelements[0] = {{ hwraid_device_database }}
[4].with_subelements[1] = packages
[4].register = hwraid__register_packages
[4].until = hwraid__register_packages is succeeded
[4].when = ((hwraid_register_release is defined and hwraid_register_release) and item.0.module not in hwraid_blacklist and item.0.module in hwraid_register_modules.stdout_lines)
[5].name = Make sure service starts at boot
[5]["ansible.builtin.service"].name = {{ item.1 }}
[5]["ansible.builtin.service"].state = started
[5]["ansible.builtin.service"].enabled = yes
[5].with_subelements[0] = {{ hwraid_device_database }}
[5].with_subelements[1] = daemons
[5].when = ((hwraid_register_release is defined and hwraid_register_release) and item.0.module not in hwraid_blacklist and item.0.module in hwraid_register_modules.stdout_lines)
