tinyproxy__base_packages[0] = tinyproxy
tinyproxy__port = 8888
tinyproxy__user = tinyproxy
tinyproxy__group = tinyproxy
tinyproxy__home = /run/tinyproxy
tinyproxy__configuration_file = {{ "/etc/tinyproxy.conf"
                                   if (ansible_distribution_release in
                                       ["trusty", "xenial"])
                                   else "/etc/tinyproxy/tinyproxy.conf" }}

tinyproxy__default_configuration[0].name = tinyproxy.conf
tinyproxy__default_configuration[0].options[0].name = User Group
tinyproxy__default_configuration[0].options[0].comment = User/Group: This allows you to set the user and group that will be
used for tinyproxy after the initial binding to the port has been done
as the root user. Either the user or group name or the UID or GID
number may be used.

tinyproxy__default_configuration[0].options[0].raw = User {{ tinyproxy__user }}
Group {{ tinyproxy__group }}

tinyproxy__default_configuration[0].options[0].state = present
tinyproxy__default_configuration[0].options[1].name = Port
tinyproxy__default_configuration[0].options[1].comment = Port: Specify the port which tinyproxy will listen on.  Please note
that should you choose to run on a port lower than 1024 you will need
to start tinyproxy using root.

tinyproxy__default_configuration[0].options[1].raw = Port {{ tinyproxy__port }}

tinyproxy__default_configuration[0].options[1].state = present
tinyproxy__default_configuration[0].options[2].name = Listen
tinyproxy__default_configuration[0].options[2].comment = Listen: If you have multiple interfaces this allows you to bind to
only one. If this is commented out, tinyproxy will bind to all
interfaces present.

tinyproxy__default_configuration[0].options[2].raw = Listen 192.168.0.1

tinyproxy__default_configuration[0].options[2].state = comment
tinyproxy__default_configuration[0].options[3].name = Bind
tinyproxy__default_configuration[0].options[3].comment = Bind: This allows you to specify which interface will be used for
outgoing connections.  This is useful for multi-home'd machines where
you want all traffic to appear outgoing from one particular interface.

tinyproxy__default_configuration[0].options[3].raw = Bind 192.168.0.1

tinyproxy__default_configuration[0].options[3].state = comment
tinyproxy__default_configuration[0].options[4].name = BindSame
tinyproxy__default_configuration[0].options[4].comment = BindSame: If enabled, tinyproxy will bind the outgoing connection to the
ip address of the incoming connection.

tinyproxy__default_configuration[0].options[4].raw = BindSame yes

tinyproxy__default_configuration[0].options[4].state = comment
tinyproxy__default_configuration[0].options[5].name = Timeout
tinyproxy__default_configuration[0].options[5].comment = Timeout: The maximum number of seconds of inactivity a connection is
allowed to have before it is closed by tinyproxy.

tinyproxy__default_configuration[0].options[5].raw = Timeout 600

tinyproxy__default_configuration[0].options[5].state = present
tinyproxy__default_configuration[0].options[6].name = ErrorFile
tinyproxy__default_configuration[0].options[6].comment = ErrorFile: Defines the HTML file to send when a given HTTP error
occurs.  You will probably need to customize the location to your
particular install.  The usual locations to check are:
  /usr/local/share/tinyproxy
  /usr/share/tinyproxy
  /etc/tinyproxy

tinyproxy__default_configuration[0].options[6].raw = ErrorFile 404 "/usr/share/tinyproxy/404.html"
ErrorFile 400 "/usr/share/tinyproxy/400.html"
ErrorFile 503 "/usr/share/tinyproxy/503.html"
ErrorFile 403 "/usr/share/tinyproxy/403.html"
ErrorFile 408 "/usr/share/tinyproxy/408.html"

tinyproxy__default_configuration[0].options[6].state = comment
tinyproxy__default_configuration[0].options[7].name = DefaultErrorFile
tinyproxy__default_configuration[0].options[7].comment = DefaultErrorFile: The HTML file that gets sent if there is no
HTML file defined with an ErrorFile keyword for the HTTP error
that has occurred.

tinyproxy__default_configuration[0].options[7].raw = DefaultErrorFile "/usr/share/tinyproxy/default.html"

tinyproxy__default_configuration[0].options[7].state = present
tinyproxy__default_configuration[0].options[8].name = StatHost
tinyproxy__default_configuration[0].options[8].comment = StatHost: This configures the host name or IP address that is treated
as the stat host: Whenever a request for this host is received,
Tinyproxy will return an internal statistics page instead of
forwarding the request to that host.  The default value of StatHost is
tinyproxy.stats.

tinyproxy__default_configuration[0].options[8].raw = StatHost "tinyproxy.stats"

tinyproxy__default_configuration[0].options[8].state = comment
tinyproxy__default_configuration[0].options[9].name = StatFile
tinyproxy__default_configuration[0].options[9].comment = StatFile: The HTML file that gets sent when a request is made
for the stathost.  If this file doesn't exist a basic page is
hardcoded in tinyproxy.

tinyproxy__default_configuration[0].options[9].raw = StatFile "/usr/share/tinyproxy/stats.html"

tinyproxy__default_configuration[0].options[9].state = present
tinyproxy__default_configuration[0].options[10].name = LogFile
tinyproxy__default_configuration[0].options[10].comment = Logfile: Allows you to specify the location where information should
be logged to.  If you would prefer to log to syslog, then disable this
and enable the Syslog directive.  These directives are mutually
exclusive.

tinyproxy__default_configuration[0].options[10].raw = Logfile "/var/log/tinyproxy/tinyproxy.log"

tinyproxy__default_configuration[0].options[10].state = present
tinyproxy__default_configuration[0].options[11].name = Syslog
tinyproxy__default_configuration[0].options[11].comment = Syslog: Tell tinyproxy to use syslog instead of a logfile.  This
option must not be enabled if the Logfile directive is being used.
These two directives are mutually exclusive.

tinyproxy__default_configuration[0].options[11].raw = Syslog On

tinyproxy__default_configuration[0].options[11].state = comment
tinyproxy__default_configuration[0].options[12].name = LogLevel
tinyproxy__default_configuration[0].options[12].comment = LogLevel:

Set the logging level. Allowed settings are:
Critical  (least verbose)
Error
Warning
Notice
Connect   (to log connections without Info's noise)
Info    (most verbose)

The LogLevel logs from the set level and above. For example, if the
LogLevel was set to Warning, then all log messages from Warning to
Critical would be output, but Notice and below would be suppressed.

tinyproxy__default_configuration[0].options[12].raw = LogLevel Info

tinyproxy__default_configuration[0].options[12].state = present
tinyproxy__default_configuration[0].options[13].name = PidFile
tinyproxy__default_configuration[0].options[13].comment = PidFile: Write the PID of the main tinyproxy thread to this file so it
can be used for signalling purposes.

tinyproxy__default_configuration[0].options[13].raw = PidFile "/run/tinyproxy/tinyproxy.pid"

tinyproxy__default_configuration[0].options[13].state = present
tinyproxy__default_configuration[0].options[14].name = XTinyproxy
tinyproxy__default_configuration[0].options[14].comment = XTinyproxy: Tell Tinyproxy to include the X-Tinyproxy header, which
contains the client's IP address.

tinyproxy__default_configuration[0].options[14].raw = XTinyproxy Yes

tinyproxy__default_configuration[0].options[14].state = comment
tinyproxy__default_configuration[0].options[15].name = upstream
tinyproxy__default_configuration[0].options[15].comment = Upstream:

Turns on upstream proxy support.

The upstream rules allow you to selectively route upstream connections
based on the host/domain of the site being accessed.

For example:
 # connection to test domain goes through testproxy
 upstream testproxy:8008 ".test.domain.invalid"
 upstream testproxy:8008 ".our_testbed.example.com"
 upstream testproxy:8008 "192.168.128.0/255.255.254.0"

 # no upstream proxy for internal websites and unqualified hosts
 no upstream ".internal.example.com"
 no upstream "www.example.com"
 no upstream "10.0.0.0/8"
 no upstream "192.168.0.0/255.255.254.0"
 no upstream "."

 # connection to these boxes go through their DMZ firewalls
 upstream cust1_firewall:8008 "testbed_for_cust1"
 upstream cust2_firewall:8008 "testbed_for_cust2"

 # default upstream is internet firewall
 upstream firewall.internal.example.com:80

The LAST matching rule wins the route decision.  As you can see, you
can use a host, or a domain:
 name     matches host exactly
 .name    matches any host in domain "name"
 .        matches any host with no domain (in 'empty' domain)
 IP/bits  matches network/mask
 IP/mask  matches network/mask

tinyproxy__default_configuration[0].options[15].raw = Upstream some.remote.proxy:port

tinyproxy__default_configuration[0].options[15].state = comment
tinyproxy__default_configuration[0].options[16].name = MaxClients
tinyproxy__default_configuration[0].options[16].comment = MaxClients: This is the absolute highest number of threads which will
be created. In other words, only MaxClients number of clients can be
connected at the same time.

tinyproxy__default_configuration[0].options[16].raw = MaxClients 100

tinyproxy__default_configuration[0].options[16].state = present
tinyproxy__default_configuration[0].options[17].name = MinSpareServers MaxSpareServers
tinyproxy__default_configuration[0].options[17].comment = MinSpareServers/MaxSpareServers: These settings set the upper and
lower limit for the number of spare servers which should be available.

If the number of spare servers falls below MinSpareServers then new
server processes will be spawned.  If the number of servers exceeds
MaxSpareServers then the extras will be killed off.

tinyproxy__default_configuration[0].options[17].raw = MinSpareServers 5
MaxSpareServers 20

tinyproxy__default_configuration[0].options[17].state = present
tinyproxy__default_configuration[0].options[18].name = StartServers
tinyproxy__default_configuration[0].options[18].comment = StartServers: The number of servers to start initially.

tinyproxy__default_configuration[0].options[18].raw = StartServers 10

tinyproxy__default_configuration[0].options[18].state = present
tinyproxy__default_configuration[0].options[19].name = MaxRequestsPerChild
tinyproxy__default_configuration[0].options[19].comment = MaxRequestsPerChild: The number of connections a thread will handle
before it is killed. In practise this should be set to 0, which
disables thread reaping. If you do notice problems with memory
leakage, then set this to something like 10000.

tinyproxy__default_configuration[0].options[19].raw = MaxRequestsPerChild 0

tinyproxy__default_configuration[0].options[19].state = present
tinyproxy__default_configuration[0].options[20].name = Allow
tinyproxy__default_configuration[0].options[20].comment = Allow: Customization of authorization controls. If there are any
access control keywords then the default action is to DENY. Otherwise,
the default action is ALLOW.

The order of the controls are important. All incoming connections are
tested against the controls based on order.

tinyproxy__default_configuration[0].options[20].raw = Allow 127.0.0.1
{% for item in tinyproxy__allow %}
Allow {{ item }}
{% endfor %}
#Allow 192.168.0.0/16
#Allow 172.16.0.0/12
#Allow 10.0.0.0/8

tinyproxy__default_configuration[0].options[20].state = present
tinyproxy__default_configuration[0].options[21].name = AddHeader
tinyproxy__default_configuration[0].options[21].comment = AddHeader: Adds the specified headers to outgoing HTTP requests that
Tinyproxy makes. Note that this option will not work for HTTPS
traffic, as Tinyproxy has no control over what headers are exchanged.

tinyproxy__default_configuration[0].options[21].raw = AddHeader "X-My-Header" "Powered by Tinyproxy"

tinyproxy__default_configuration[0].options[21].state = comment
tinyproxy__default_configuration[0].options[22].name = ViaProxyName
tinyproxy__default_configuration[0].options[22].comment = ViaProxyName: The "Via" header is required by the HTTP RFC, but using
the real host name is a security concern.  If the following directive
is enabled, the string supplied will be used as the host name in the
Via header; otherwise, the server's host name will be used.

tinyproxy__default_configuration[0].options[22].raw = ViaProxyName "tinyproxy"

tinyproxy__default_configuration[0].options[22].state = present
tinyproxy__default_configuration[0].options[23].name = DisableViaHeader
tinyproxy__default_configuration[0].options[23].comment = DisableViaHeader: When this is set to yes, Tinyproxy does NOT add
the Via header to the requests. This virtually puts Tinyproxy into
stealth mode. Note that RFC 2616 requires proxies to set the Via
header, so by enabling this option, you break compliance.
Don't disable the Via header unless you know what you are doing...

tinyproxy__default_configuration[0].options[23].raw = DisableViaHeader Yes

tinyproxy__default_configuration[0].options[23].state = comment
tinyproxy__default_configuration[0].options[24].name = Filter
tinyproxy__default_configuration[0].options[24].comment = Filter: This allows you to specify the location of the filter file.

tinyproxy__default_configuration[0].options[24].raw = Filter "/etc/tinyproxy/filter"

tinyproxy__default_configuration[0].options[24].state = comment
tinyproxy__default_configuration[0].options[25].name = FilterURLs
tinyproxy__default_configuration[0].options[25].comment = FilterURLs: Filter based on URLs rather than domains.

tinyproxy__default_configuration[0].options[25].raw = FilterURLs On

tinyproxy__default_configuration[0].options[25].state = comment
tinyproxy__default_configuration[0].options[26].name = FilterExtended
tinyproxy__default_configuration[0].options[26].comment = FilterExtended: Use POSIX Extended regular expressions rather than
basic.

tinyproxy__default_configuration[0].options[26].raw = FilterExtended On

tinyproxy__default_configuration[0].options[26].state = comment
tinyproxy__default_configuration[0].options[27].name = FilterCaseSensitive
tinyproxy__default_configuration[0].options[27].comment = FilterCaseSensitive: Use case sensitive regular expressions.

tinyproxy__default_configuration[0].options[27].raw = FilterCaseSensitive On

tinyproxy__default_configuration[0].options[27].state = comment
tinyproxy__default_configuration[0].options[28].name = FilterDefaultDeny
tinyproxy__default_configuration[0].options[28].comment = FilterDefaultDeny: Change the default policy of the filtering system.
If this directive is commented out, or is set to "No" then the default
policy is to allow everything which is not specifically denied by the
filter file.

However, by setting this directive to "Yes" the default policy becomes
to deny everything which is _not_ specifically allowed by the filter
file.

tinyproxy__default_configuration[0].options[28].raw = FilterDefaultDeny Yes

tinyproxy__default_configuration[0].options[28].state = comment
tinyproxy__default_configuration[0].options[29].name = Anonymous
tinyproxy__default_configuration[0].options[29].comment = Anonymous: If an Anonymous keyword is present, then anonymous proxying
is enabled.  The headers listed are allowed through, while all others
are denied. If no Anonymous keyword is present, then all headers are
allowed through.  You must include quotes around the headers.

Most sites require cookies to be enabled for them to work correctly, so
you will need to allow Cookies through if you access those sites.

tinyproxy__default_configuration[0].options[29].raw = Anonymous "Host"
Anonymous "Authorization"
Anonymous "Cookie"

tinyproxy__default_configuration[0].options[29].state = comment
tinyproxy__default_configuration[0].options[30].name = ConnectPort
tinyproxy__default_configuration[0].options[30].comment = ConnectPort: This is a list of ports allowed by tinyproxy when the
CONNECT method is used.  To disable the CONNECT method altogether, set
the value to 0.  If no ConnectPort line is found, all ports are
allowed (which is not very secure.)

The following two ports are used by SSL.

tinyproxy__default_configuration[0].options[30].raw = ConnectPort 443
ConnectPort 563

tinyproxy__default_configuration[0].options[30].state = present
tinyproxy__default_configuration[0].options[31].name = ReversePath
tinyproxy__default_configuration[0].options[31].comment = Configure one or more ReversePath directives to enable reverse proxy
support. With reverse proxying it's possible to make a number of
sites appear as if they were part of a single site.

If you uncomment the following two directives and run tinyproxy
on your own computer at port 8888, you can access Google using
http://localhost:8888/google/ and Wired News using
http://localhost:8888/wired/news/. Neither will actually work
until you uncomment ReverseMagic as they use absolute linking.

tinyproxy__default_configuration[0].options[31].raw = ReversePath "/google/" "https://www.google.com/"
ReversePath "/wired/"  "https://www.wired.com/"

tinyproxy__default_configuration[0].options[31].state = comment
tinyproxy__default_configuration[0].options[32].name = ReverseOnly
tinyproxy__default_configuration[0].options[32].comment = When using tinyproxy as a reverse proxy, it is STRONGLY recommended
that the normal proxy is turned off by uncommenting the next directive.

tinyproxy__default_configuration[0].options[32].raw = ReverseOnly Yes

tinyproxy__default_configuration[0].options[32].state = comment
tinyproxy__default_configuration[0].options[33].name = ReverseMagic
tinyproxy__default_configuration[0].options[33].comment = Use a cookie to track reverse proxy mappings. If you need to reverse
proxy sites which have absolute links you must uncomment this.

tinyproxy__default_configuration[0].options[33].raw = ReverseMagic Yes

tinyproxy__default_configuration[0].options[33].state = comment
tinyproxy__default_configuration[0].options[34].name = ReverseBaseURL
tinyproxy__default_configuration[0].options[34].comment = The URL that's used to access this reverse proxy. The URL is used to
rewrite HTTP redirects so that they won't escape the proxy. If you
have a chain of reverse proxies, you'll need to put the outermost
URL here (the address which the end user types into his/her browser).

If not set then no rewriting occurs.

tinyproxy__default_configuration[0].options[34].raw = ReverseBaseURL "http://localhost:8888/"

tinyproxy__default_configuration[0].options[34].state = comment
tinyproxy__combined_configuration = {{ tinyproxy__default_configuration + tinyproxy__configuration }}
tinyproxy__ferm__dependent_rules[0].type = accept
tinyproxy__ferm__dependent_rules[0].dport[0] = tinyproxy
tinyproxy__ferm__dependent_rules[0].saddr = {{ tinyproxy__allow }}
tinyproxy__ferm__dependent_rules[0].accept_any = False
tinyproxy__ferm__dependent_rules[0].weight = 40
tinyproxy__ferm__dependent_rules[0].role = tinyproxy
tinyproxy__etc_services__dependent_list[0].name = tinyproxy
tinyproxy__etc_services__dependent_list[0].port = {{ tinyproxy__port }}
