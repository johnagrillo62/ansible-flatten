[0].name = Import custom Ansible plugins
[0]["ansible.builtin.import_role"].name = ansible_plugins
[1].name = Import DebOps secret role
[1]["ansible.builtin.import_role"].name = secret
[2].name = Configure pam-mkhomedir to create home directories
[2]["ansible.builtin.template"].src = usr/share/pam-configs/mkhomedir.j2
[2]["ansible.builtin.template"].dest = /usr/share/pam-configs/mkhomedir
[2]["ansible.builtin.template"].mode = 0644
[2].register = sssd__register_mkhomedir
[3].name = Enable mkhomedir PAM module
[3]["ansible.builtin.shell"] = pam-auth-update --package --remove mkhomedir 2>/dev/null && pam-auth-update --package --enable mkhomedir 2>/dev/null
[3].register = sssd__register_pam_update
[3].changed_when = sssd__register_pam_update.changed | bool
[3].when = sssd__register_mkhomedir is changed
[4].name = Install packages for sssd support
[4]["ansible.builtin.package"].name = {{ q("flattened", sssd__base_packages + sssd__packages) }}
[4]["ansible.builtin.package"].state = present
[4].register = sssd__register_packages
[4].until = sssd__register_packages is succeeded
[5].name = Generate sssd configuration
[5]["ansible.builtin.template"].src = etc/sssd/sssd.conf.j2
[5]["ansible.builtin.template"].dest = /etc/sssd/sssd.conf
[5]["ansible.builtin.template"].mode = 0600
[5].register = sssd__register_config
[5].when = sssd__ldap_base_dn | d()
[6].name = Restart sssd if its configuration was modified
[6]["ansible.builtin.service"].name = sssd
[6]["ansible.builtin.service"].state = restarted
[6].when = sssd__register_config is changed
[7].name = Make sure that Ansible local facts directory exists
[7]["ansible.builtin.file"].path = /etc/ansible/facts.d
[7]["ansible.builtin.file"].state = directory
[7]["ansible.builtin.file"].mode = 0755
[8].name = Save sssd local facts
[8]["ansible.builtin.template"].src = etc/ansible/facts.d/sssd.fact.j2
[8]["ansible.builtin.template"].dest = /etc/ansible/facts.d/sssd.fact
[8]["ansible.builtin.template"].mode = 0755
[8].notify[0] = Refresh host facts
[8].tags[0] = meta::facts
[9].name = Update Ansible facts if they were modified
[9]["ansible.builtin.meta"] = flush_handlers
