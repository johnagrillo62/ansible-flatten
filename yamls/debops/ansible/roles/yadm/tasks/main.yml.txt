[0].name = Import custom Ansible plugins
[0]["ansible.builtin.import_role"].name = ansible_plugins
[1].name = Import DebOps global handlers
[1]["ansible.builtin.import_role"].name = global_handlers
[2].name = Install required APT packages
[2]["ansible.builtin.package"].name = {{ q("flattened", yadm__base_packages
                             + yadm__packages
                             + yadm__group_packages
                             + yadm__host_packages) }}
[2]["ansible.builtin.package"].state = present
[2].register = yadm__register_packages
[2].until = yadm__register_packages is succeeded
[2].when = yadm__enabled | bool
[3].name = Install yadm from upstream
[3]["ansible.builtin.include_tasks"] = upstream_yadm.yml
[3].when = yadm__enabled | bool and yadm__upstream_enabled | bool
[4].name = Ensure that the /root/.gnupg directory exists
[4]["ansible.builtin.file"].path = ~/.gnupg
[4]["ansible.builtin.file"].state = directory
[4]["ansible.builtin.file"].mode = 0700
[4].when = yadm__enabled | bool and yadm__dotfiles_enabled | bool
[5].name = Download custom dotfile repositories
[5]["ansible.builtin.include_tasks"] = manage_dotfiles.yml
[5].loop = {{ q("flattened", yadm__combined_dotfiles) | debops.debops.parse_kv_items }}
[5].loop_control.loop_var = dotfile
[5].loop_control.label = {{ dotfile.name }}
[5].when = yadm__enabled | bool and yadm__dotfiles_enabled | bool and dotfile.name | d()
[6].name = Make sure that Ansible local facts directory exists
[6]["ansible.builtin.file"].path = /etc/ansible/facts.d
[6]["ansible.builtin.file"].state = directory
[6]["ansible.builtin.file"].mode = 0755
[7].name = Save yadm local facts
[7]["ansible.builtin.template"].src = etc/ansible/facts.d/yadm.fact.j2
[7]["ansible.builtin.template"].dest = /etc/ansible/facts.d/yadm.fact
[7]["ansible.builtin.template"].mode = 0755
[7].notify[0] = Refresh host facts
[7].tags[0] = meta::facts
[8].name = Update Ansible facts if they were modified
[8]["ansible.builtin.meta"] = flush_handlers
